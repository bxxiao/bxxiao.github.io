<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Orelega One:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"mac"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="nothing">
<meta property="og:type" content="website">
<meta property="og:title" content="bxxiao">
<meta property="og:url" content="http://example.com/page/4/index.html">
<meta property="og:site_name" content="bxxiao">
<meta property="og:description" content="nothing">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="bxxiao">
<meta property="article:tag" content="bxxiao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/4/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>bxxiao</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="alternate" href="/atom.xml" title="bxxiao" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">bxxiao</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/04/%E6%A1%86%E6%9E%B6/SSM%E6%95%B4%E5%90%88Demo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="bxxiao">
      <meta itemprop="description" content="nothing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bxxiao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/%E6%A1%86%E6%9E%B6/SSM%E6%95%B4%E5%90%88Demo/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-04 19:15:09" itemprop="dateCreated datePublished" datetime="2020-11-04T19:15:09+08:00">2020-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-15 17:35:14" itemprop="dateModified" datetime="2021-03-15T17:35:14+08:00">2021-03-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><strong>本文只介绍项目中的配置文件</strong>，完整项目：<a href="https://github.com/bxxiao/SSMDemo" target="_blank">github</a>。</p>
<p>项目中使用了两张表（员工表、部门表，一个员工对应一个部门）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">create table dept</span><br><span class="line">(</span><br><span class="line">    dept_id   int auto_increment</span><br><span class="line">        primary key,</span><br><span class="line">    dept_name varchar(255) null</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">create table employees</span><br><span class="line">(</span><br><span class="line">    emp_id   int auto_increment</span><br><span class="line">        primary key,</span><br><span class="line">    emp_name varchar(30)  null,</span><br><span class="line">    gender   char         null,</span><br><span class="line">    email    varchar(255) null,</span><br><span class="line">    d_id     int          null,</span><br><span class="line">    constraint emp_fk_dept</span><br><span class="line">        foreign key (d_id) references dept (dept_id)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>该项目是idea的maven项目，总的目录结构：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20201016232015440.png" alt="image-20201016232015440" style="zoom:80%;" />

<p>&emsp;  </p>
<h2 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h2><p>pom.xml文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>SSMIntegration<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">packaging</span>&gt;</span>war<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>SSMIntegration Maven Webapp<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://www.example.com<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.7<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- spring单元测试 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.8.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- spring以及springMVC相关依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 事务相关配置所需依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.2.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- mybatis整合spring的jar包 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 数据库连接池以及数据库驱动 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.commons<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>commons-pool2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.22<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis逆向工程依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- mybatis分页插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 处理json数据的jar包 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- JSR303校验所需依赖 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.1.5.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 日志 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-slf4j-impl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.logging.log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j-jcl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.11.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">&lt;!-- servlet-api --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>javax.servlet<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javax.servlet-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>SSMIntegration<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">                <span class="comment">&lt;!-- mybatis逆向工程所需插件 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>若在关闭tomcat服务器时会报错，见： <a target="_blank" rel="noopener" href="https://www.cnblogs.com/bxiaoo/p/13828772.html">https://www.cnblogs.com/bxiaoo/p/13828772.html</a></p>
</blockquote>
<p>&emsp;  </p>
<h2 id="SpringMVC配置文件"><a href="#SpringMVC配置文件" class="headerlink" title="SpringMVC配置文件"></a>SpringMVC配置文件</h2><p>spring-mvc.xml（位于resources/ssm下）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd http://www.springframework.org/schema/mvc https://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 在该配置文件中只配置web组件相关的bean --&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!-- 扫描controller --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ssm.controller&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置视图解析器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/views/&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 两个常用配置 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 让springmvc处理不了的请求交给tomcat，如静态资源等 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 支持一些springmvc高级功能，如jsr303校验、快捷的Ajax、映射动态请求等 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<h2 id="Spring配置文件"><a href="#Spring配置文件" class="headerlink" title="Spring配置文件"></a>Spring配置文件</h2><p>spring配置文件中配置了service、dao等bean，也<strong>包括跟mybatis的整合配置</strong>。</p>
<h3 id="整合Mybatis"><a href="#整合Mybatis" class="headerlink" title="整合Mybatis"></a>整合Mybatis</h3><p>Spring整合Mybatis通过类<code>SqlSessionFactoryBean</code>，<strong>在该bean中可以进行与Mybatis主配置文件一样的配置，即可以省略Mybatis主配置文件</strong>。也可以通过<code>configLocation</code>属性来指定主配置文件的路径。</p>
<p>spring-mybatis.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 加载配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置数据库连接池，这里使用德鲁伊 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 最大连接池数量 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maxActive&quot;</span> <span class="attr">value</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 最小连接池 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;minIdle&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 连接超时时间 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;validationQueryTimeout&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ==========================spring和MyBatis完美整合=========================== --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- mybatis的主配置文件中的所有配置，都可以在SqlSessionFactoryBean中进行配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactory&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定数据源 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定映射文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mapper/*.xml&quot;</span> /&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定别名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;typeAliasesPackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.ssm.bean&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置分页插件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;plugins&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- SqlSessionTemplate是线程安全的 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span> <span class="attr">id</span>=<span class="string">&quot;sessionTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描dao接口，将dao接口的实现类添加到ioc容器（Root WebApplicationContext）中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basePackage&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.ssm.dao&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ========================================================================== --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>jdbc.properties：</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">url</span>=jdbc:mysql://locaohost:<span class="number">3306</span>/ssm?serverTimezone=UTC</span><br><span class="line"><span class="attr">user</span>=root</span><br><span class="line"><span class="attr">password</span>=admin</span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于SqlSessionTemplate：<a href="https://www.jianshu.com/p/7cb4777a539e" target="_blank">对于SqlSessionTemplate的理解</a> </p>
</blockquote>
<h3 id="整合spring事务管理"><a href="#整合spring事务管理" class="headerlink" title="整合spring事务管理"></a>整合spring事务管理</h3><p>关于spring中基于xml的声明式事务要注意的一个点：</p>
<p><strong><font color="red">在基于XML的声明式事务中，事务属性的tx: method是必须配置的，如果某个方法没有对应的tx: method配置，那么事务对这个方法就不生效，即不会使用默认值</font></strong> 。</p>
<p>spring-service.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span> <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag"></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">       https://www.springframework.org/schema/aop/spring-aop.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/tx/spring-tx.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置service层：扫描 service 包；配置事务管理 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 扫描service --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.ssm.service&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- =========配置事务管理========= --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定控制的数据源 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 也可以配置基于注解的声明式事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 使用 xml 配置事务管理 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务属性，即配置事务的传播行为，隔离级别等 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- advice默认指定id为transactionManager的事务管理器，所以若是配置的事务管理器id不是该值，则需显示指定</span></span><br><span class="line"><span class="comment">            事务管理器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- name属性指定当前method标签配置的事务属性要应用到哪些方法</span></span><br><span class="line"><span class="comment">                如第二个method标签指定对所有get开头的方法应用只读属性（只能查询）--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务的切入点 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;txPoint&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.ssm.service..*(..))&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPoint&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ===================================================== --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<h3 id="spring配置文件"><a href="#spring配置文件" class="headerlink" title="spring配置文件"></a>spring配置文件</h3><p>将 mybatis、service 整合进 spring Root ApplicationContext。</p>
<p>rootApplicationContext.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context https://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 导入整合mybatis的相关配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:ssm/spring-mybatis.xml&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 导入 service 相关配置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;classpath:ssm/spring-service.xml&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<h2 id="日志配置文件"><a href="#日志配置文件" class="headerlink" title="日志配置文件"></a>日志配置文件</h2><p>log4j2的配置文件（log4j2.xml），该配置主要打印sql语句执行日志：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Configuration</span> <span class="attr">status</span>=<span class="string">&quot;WARN&quot;</span> <span class="attr">monitorInterval</span>=<span class="string">&quot;30&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Properties</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;PATTERN&quot;</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%t-%L] %-5level</span><br><span class="line">            %logger&#123;36&#125; - %msg%n<span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">Appenders</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Console</span> <span class="attr">name</span>=<span class="string">&quot;consolePrint&quot;</span> <span class="attr">target</span>=<span class="string">&quot;SYSTEM_OUT&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">PatternLayout</span> <span class="attr">pattern</span>=<span class="string">&quot;%d&#123;HH:mm:ss&#125; [%t] %-5level %logger&#123;36&#125; - %msg%n&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">Console</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Appenders</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--然后定义logger，只有定义了logger并引入的appender，appender才会生效 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Loggers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.ssm.dao&quot;</span> <span class="attr">level</span>=<span class="string">&quot;DEBUG&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;consolePrint&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置日志的根节点 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;consolePrint&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Loggers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<h2 id="web-xml配置文件"><a href="#web-xml配置文件" class="headerlink" title="web.xml配置文件"></a>web.xml配置文件</h2><p>web.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">web-app</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;-//Sun Microsystems, Inc.//DTD Web Application 2.3//EN&quot;</span></span></span><br><span class="line"><span class="meta"> <span class="meta-string">&quot;http://java.sun.com/dtd/web-app_2_3.dtd&quot;</span> &gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">display-name</span>&gt;</span>Archetype Created Web Application<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring配置文件的位置 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:ssm/rootApplicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- log4j配置文件的位置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>log4jConfiguration<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:log4j2.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 防止Spring内存溢出监听器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.util.IntrospectorCleanupListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 通过配置ContextLoaderListener，让其创建Spring的应用上下文（Root ApplicationContext）--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 服务器关闭时关闭驱动的监听器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.ssm.listener.DriverMangerListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 配置DispatcherServlet --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:ssm/spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>dispatcher<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 过滤器配置 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 字符编码过滤器，该过滤器一般位于所有过滤器之前 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>encodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- HiddenHttpMethodFilter用于将post请求转换为指定请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>hiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 当客户端发送PUT、DELETE、PATCH请求时，该过滤器会将其中的参数信息进行处理，以</span></span><br><span class="line"><span class="comment">        便可以通过HttpRequest对象的getParameter方法获取到参数数据 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>FormContentFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.FormContentFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>FormContentFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<blockquote>
<p>web.xml中的FormContentFilter：</p>
<p>在前端，可以通过Ajax直接发送DELETE、PUT等post、get之外的请求，但tomcat对于post之外的请求，并不会将其中的参数数据封装进request对象，从而不能通过request的getParameter方法可以获取到这些参数。而springMVC是使用getParameter方法来获取数据封装进控制器方法的JavaBean形参，所以导致了封装不了JavaBean的信息。</p>
<p>FormContentFilter可以对DELETE、PUT请求中的参数数据进行处理，让springMVC可以正常封装JavaBean形参。</p>
<p>关于IntrospectorCleanupListener：<a href="https://www.cnblogs.com/qiankun-site/p/5886673.html" target="_blank">IntrospectorCleanupListener作用</a> </p>
</blockquote>
<p>&emsp; </p>
<h2 id="Mybatis-Generator"><a href="#Mybatis-Generator" class="headerlink" title="Mybatis-Generator"></a>Mybatis-Generator</h2><p>使用mybatis逆向工程身材mapper及其配置文件。</p>
<p>配置文件（generator/generatorConfig.xml）：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">&quot;mysql驱动包绝对路径&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;simple&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3Simple&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置生成的类不带注释 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置数据库连接信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://127.0.0.1:3306/ssm?serverTimezone=UTC&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--指定生成的JavaBean的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.ssm.bean&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定映射文件的生成位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定dao接口生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.ssm.dao&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定每个表的生成策略 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;employees&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Employee&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Department&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a href="https://www.cnblogs.com/DoubleEggs/p/6243216.html" target="_blank">【SSM】Eclipse使用Maven创建Web项目+整合SSM框架</a> </p>
<p><a href="https://www.cnblogs.com/zyw-205520/p/4771253.html" target="_blank">SSM框架——详细整合教程（Spring+SpringMVC+MyBatis）</a> </p>
<p><a href="https://blog.csdn.net/z69183787/article/details/52925567" target="_blank">使用Log4j2打印Mybatis SQL语句以及结果集</a> </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq598535550/article/details/51703190">手把手教你整合最优雅SSM框架</a> </p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/04/%E6%A1%86%E6%9E%B6/Mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="bxxiao">
      <meta itemprop="description" content="nothing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bxxiao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/%E6%A1%86%E6%9E%B6/Mybatis%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B/" class="post-title-link" itemprop="url">Mybatis逆向工程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-04 18:33:15" itemprop="dateCreated datePublished" datetime="2020-11-04T18:33:15+08:00">2020-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-07 18:04:44" itemprop="dateModified" datetime="2020-11-07T18:04:44+08:00">2020-11-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>Mybatis逆向工程（Mybatis Generator）用于根据配置文件自动生成数据表对应的JavaBean，以及dao接口和映射文件。</p>
<p>该示例以Maven的插件形式运行Mybatis逆向工程。（Maven项目）</p>
<h2 id="pom-xml中添加插件"><a href="#pom-xml中添加插件" class="headerlink" title="pom.xml中添加插件"></a>pom.xml中添加插件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.generator<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-generator-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">verbose</span>&gt;</span>true<span class="tag">&lt;/<span class="name">verbose</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">overwrite</span>&gt;</span>true<span class="tag">&lt;/<span class="name">overwrite</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<h2 id="数据表示例"><a href="#数据表示例" class="headerlink" title="数据表示例"></a>数据表示例</h2><p>以dept表（部门）和employees表（员工）为例。员工的d_id指向dept的主键。</p>
<p>dept：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200927200546234.png" alt="image-20200927200546234"></p>
<p>employees：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200927200613315.png" alt="image-20200927200613315"></p>
<p>&emsp;  </p>
<h2 id="创建配置文件"><a href="#创建配置文件" class="headerlink" title="创建配置文件"></a>创建配置文件</h2><p>创建连接数据库相关信息的<code>jdbc.properties</code>文件以及逆向工程的配置文件<code>generatorConfig.xml</code>。放在resource目录下。并将MySQL jdbc驱动包放在resource下（这里使用的是mysql-connector-java-5.1.47.jar）。</p>
<blockquote>
<p>PS：<strong>mybatis-generator插件默认在resource目录下查找<code>generatorConfig.xml</code>配置文件，所以这里的<code>generatorConfig.xml</code>配置文件要注意位置与命名</strong>。</p>
</blockquote>
<p>jdbc.properties：</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/ssm?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">user</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">admin</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p><code>generatorConfig.xml</code>：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span> <span class="meta-keyword">PUBLIC</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--导入properties配置文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--指定特定数据库的jdbc驱动jar包的位置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">classPathEntry</span> <span class="attr">location</span>=<span class="string">&quot;驱动包的绝对路径&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;default&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 配置生成的类不带注释（建议，因为生成的注释没啥用） --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--jdbc的数据库连接 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span></span></span><br><span class="line"><span class="tag">                <span class="attr">driverClass</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">connectionURL</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">userId</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span></span></span><br><span class="line"><span class="tag">                <span class="attr">password</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定生成的JavaBean的包位置,</span></span><br><span class="line"><span class="comment">                用来生成含有主键key的类，记录类 以及查询Example类</span></span><br><span class="line"><span class="comment">                不用事先创建好包结构，mybatis-generator会根据配置自动创建，sqlMapGenerator同</span></span><br><span class="line"><span class="comment">            targetPackage     指定生成的JavaBean生成所在的包名</span></span><br><span class="line"><span class="comment">            targetProject     指定在该项目下所在的路径</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.generator.bean&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">&lt;!-- 是否允许子包，即targetPackage.schemaName.tableName --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否对model添加 构造函数 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;constructorBased&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 建立的Model对象是否 不可改变  即生成的Model对象不会有 setter方法，只有构造方法 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;immutable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--Mapper映射文件生成所在的目录 为每一个数据库的表生成对应的SqlMap文件 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mapper&quot;</span> <span class="attr">targetProject</span>=<span class="string">&quot;src/main/resources&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定dao接口（mapper）的位置</span></span><br><span class="line"><span class="comment">                type=&quot;ANNOTATEDMAPPER&quot;,生成Java Model 和基于注解的Mapper对象</span></span><br><span class="line"><span class="comment">                type=&quot;MIXEDMAPPER&quot;,生成基于注解的Java Model 和相应的Mapper对象</span></span><br><span class="line"><span class="comment">                type=&quot;XMLMAPPER&quot;,生成SQLMap XML文件和独立的Mapper接口</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.generator.dao&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetProject</span>=<span class="string">&quot;src/main/java&quot;</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定每个表的生成策略</span></span><br><span class="line"><span class="comment">                配置数据表与JavaBean的名称映射，以及是否创建根据条件查询的sql语句等 --&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- tableName指定表名，domainObjectName指定表对应的JavaBean名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;dept&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Department&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;employees&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Employee&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableCountByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableUpdateByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">enableDeleteByExample</span>=<span class="string">&quot;false&quot;</span> <span class="attr">enableSelectByExample</span>=<span class="string">&quot;true&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">selectByExampleQueryId</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<h2 id="插件相关配置"><a href="#插件相关配置" class="headerlink" title="插件相关配置"></a>插件相关配置</h2><p>在maven窗口配置一个插件运行。</p>
<ol>
<li><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200927200743717.png" alt="image-20200927200743717" style="zoom:80%;" />
</li>
<li><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200927201004256.png" alt="image-20200927201004256" style="zoom:80%;" />
</li>
<li><p>分别填入项目的目录以及命令<code>mybatis-generator:generate -e</code>：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200927201321279.png" alt="image-20200927201321279" style="zoom:80%;" />
</li>
<li><p>OK。</p>
</li>
</ol>
<p>&emsp;  </p>
<h2 id="运行Generator"><a href="#运行Generator" class="headerlink" title="运行Generator"></a>运行Generator</h2><p>打开maven窗口可看到：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200927201451117.png" alt="image-20200927201451117"></p>
<p>&emsp;  </p>
<p>双击即可运行generator。</p>
<p>运行后的项目目录，可看到创建了JavaBean、dao以及映射文件：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200927201609898.png" alt="image-20200927201609898" style="zoom:80%;" />



<p>&emsp; </p>
<h2 id="XxxExample的使用"><a href="#XxxExample的使用" class="headerlink" title="XxxExample的使用"></a>XxxExample的使用</h2><p>通过逆向工程生成的JavaBean中可以看到有XxxExample的类，这些类的作用是用于设置查询条件。</p>
<p>简单的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEmployeeExample</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSession session = getSqlSession();<span class="comment">//获取SqlSession（方法具体实现省略）</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建一个example类</span></span><br><span class="line">    EmployeeExample example = <span class="keyword">new</span> EmployeeExample();</span><br><span class="line">    <span class="comment">//查询employees表中did为1的记录</span></span><br><span class="line">    example.or().andDIdEqualTo(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);</span><br><span class="line">    List&lt;Employee&gt; employees = mapper.selectByExample(example);</span><br><span class="line">    <span class="keyword">for</span>(Employee e : employees)&#123;</span><br><span class="line">        System.out.println(e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>又如：通过模糊查询，查询EmpName包含“三”的记录。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">EmployeeExample example = <span class="keyword">new</span> EmployeeExample();</span><br><span class="line">example.or().andEmpNameLike(<span class="string">&quot;%三%&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>其他的添加查询条件的方法：（来自<a target="_blank" rel="noopener" href="https://blog.csdn.net/biandous/article/details/65630783%EF%BC%89">https://blog.csdn.net/biandous/article/details/65630783）</a></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>example.setOrderByClause(“字段名 ASC”);</td>
<td>添加升序排列条件，DESC为降序</td>
</tr>
<tr>
<td>example.setDistinct(false)</td>
<td>去除重复，boolean型，true为选择不重复的记录。</td>
</tr>
<tr>
<td>criteria.andXxxIsNull</td>
<td>添加字段xxx为null的条件</td>
</tr>
<tr>
<td>criteria.andXxxIsNotNull</td>
<td>添加字段xxx不为null的条件</td>
</tr>
<tr>
<td>criteria.andXxxEqualTo(value)</td>
<td>添加xxx字段等于value条件</td>
</tr>
<tr>
<td>criteria.andXxxNotEqualTo(value)</td>
<td>添加xxx字段不等于value条件</td>
</tr>
<tr>
<td>criteria.andXxxGreaterThan(value)</td>
<td>添加xxx字段大于value条件</td>
</tr>
<tr>
<td>criteria.andXxxGreaterThanOrEqualTo(value)</td>
<td>添加xxx字段大于等于value条件</td>
</tr>
<tr>
<td>criteria.andXxxLessThan(value)</td>
<td>添加xxx字段小于value条件</td>
</tr>
<tr>
<td>criteria.andXxxLessThanOrEqualTo(value)</td>
<td>添加xxx字段小于等于value条件</td>
</tr>
<tr>
<td>criteria.andXxxIn(List&lt;？&gt;)</td>
<td>添加xxx字段值在List&lt;？&gt;条件</td>
</tr>
<tr>
<td>criteria.andXxxNotIn(List&lt;？&gt;)</td>
<td>添加xxx字段值不在List&lt;？&gt;条件</td>
</tr>
<tr>
<td>criteria.andXxxLike(“%”+value+”%”)</td>
<td>添加xxx字段值为value的模糊查询条件</td>
</tr>
<tr>
<td>criteria.andXxxNotLike(“%”+value+”%”)</td>
<td>添加xxx字段值不为value的模糊查询条件</td>
</tr>
<tr>
<td>criteria.andXxxBetween(value1,value2)</td>
<td>添加xxx字段值在value1和value2之间条件</td>
</tr>
<tr>
<td>criteria.andXxxNotBetween(value1,value2)</td>
<td>添加xxx字段值不在value1和value2之间条件</td>
</tr>
</tbody></table>
<p>&emsp;  </p>
<p><strong>以上方法都可以通过example类的<code>or()</code>方法调用（如示例），推荐使用这种方式</strong>。</p>
<p>使用<code>or()</code>方法添加多个条件时要注意：</p>
<ul>
<li><p><strong>若是要添加多个AND条件，应是这种方式：</strong> **<code>example.or().andXxx1(xx).andXxx2(xx).addXxx3(xx);</code>**。</p>
</li>
<li><p>若是使用以下方式，添加的多个条件将是OR条件：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">example.or().andXxx1(xx);</span><br><span class="line">example.or().andXxx2(xx);</span><br><span class="line">example.or().andXxx3(xx);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p>&emsp;  </p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/for_my_life/article/details/51228098">https://blog.csdn.net/for_my_life/article/details/51228098</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/biandous/article/details/65630783">https://blog.csdn.net/biandous/article/details/65630783</a></p>
</blockquote>
<p>&emsp;  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/04/%E6%A1%86%E6%9E%B6/Mybatis%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="bxxiao">
      <meta itemprop="description" content="nothing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bxxiao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/%E6%A1%86%E6%9E%B6/Mybatis%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Mybatis的使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-04 17:45:23" itemprop="dateCreated datePublished" datetime="2020-11-04T17:45:23+08:00">2020-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-11-15 14:31:27" itemprop="dateModified" datetime="2020-11-15T14:31:27+08:00">2020-11-15</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>中文文档： <a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/index.html">https://mybatis.org/mybatis-3/zh/index.html</a> </p>
<p>MyBatis 是支持<strong>定制化 SQL</strong>，存储过程和高级映射的优秀持久层框架。MyBatis 消除了几乎所有的JDBC代码和参数的手工设置以及结果集的检索。MyBatis 使用简单的 XML或注解用于配置和原始映射，将接口和 Java 的POJO映射成数据库中的记录。它<strong>内部封装了 jdbc</strong>，<strong><font color="red">使开发者能更专注于 SQL 代码</font></strong>， 而不需要花费精力去处理加载驱动、创建连接、创建 statement 等繁杂的过程。</p>
<h1 id="QuickStart"><a href="#QuickStart" class="headerlink" title="QuickStart"></a>QuickStart</h1><p>该示例基于IDEA的Maven项目。</p>
<h2 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h2><p>主要是导入mybatis和mysql jdbc驱动包依赖。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 两个必须导入的依赖 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>5.1.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.12<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<blockquote>
<p> 使用lombok可以通过使用<code>@Data</code>注解修饰entity类，从而使Lombok为该类自动生成getter、setter、constructor以及toString。</p>
<p>使用前需在idea中安装Lombok插件：【Settings】-》【Plugins】，搜索Lombok，安装即可。</p>
<p>若不使用Lombok则后述的User类注意添加getter、setter等。</p>
</blockquote>
<h2 id="创建实体类、数据表以及dao接口（Mapper）"><a href="#创建实体类、数据表以及dao接口（Mapper）" class="headerlink" title="创建实体类、数据表以及dao接口（Mapper）"></a>创建实体类、数据表以及dao接口（Mapper）</h2><p>包结构：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200914213616915.png" alt="image-20200914213616915" style="zoom: 80%;" />



<p>user表：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200913232633655.png" alt="image-20200913232633655"></p>
<p>User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>UserMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</span><br><span class="line">    <span class="function">User <span class="title">selectById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<blockquote>
<p>Mybatis中，把dao接口称为Mapper（映射器）。</p>
</blockquote>
<h2 id="创建映射文件"><a href="#创建映射文件" class="headerlink" title="创建映射文件"></a>创建映射文件</h2><p><strong>在resource目录下创建Mapper对应的xml配置文件，<span style="color:red">Mapper对应的xml文件在resource中的目录结构要与Mapper的包结构保持一致</span></strong>，如图：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200914213717783.png" alt="image-20200914213717783"></p>
<blockquote>
<p>PS：IDEA的Maven项目中，在resource目录下不能创建package，只能创建redirect，且创建目录时，需一层一层创建，这样在磁盘中才会有对应的目录结构，若在创建时使用 com.entity的命名方式，则在磁盘中只会创建一个名为com.entity的目录</p>
</blockquote>
<p>UserMapper.xml：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- #&#123;id&#125;将会接收UserMapper.selectById方法中的id参数 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.entity.User&quot;</span> &gt;</span></span><br><span class="line">        select * from user where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="创建主配置文件"><a href="#创建主配置文件" class="headerlink" title="创建主配置文件"></a>创建主配置文件</h2><p>主配置文件用于<strong>用于配置数据源，事务管理器，映射文件位置等其他全局设置</strong>。一般命名为<strong>SqlMapConfig.xml</strong>，放在resource目录下。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- default属性指定配置的environment中某一个的id --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 配置连接数据库的相关信息 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 事务管理器 --&gt;</span> </span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test?serverTimezone=UTC&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;admin&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 指定映射配置文件的路径，注意分隔符是 / 而不是 . --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;com/mapper/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="获取SqlSession，进行数据库操作"><a href="#获取SqlSession，进行数据库操作" class="headerlink" title="获取SqlSession，进行数据库操作"></a>获取SqlSession，进行数据库操作</h2><p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="comment">//获取主配置文件的输入流</span></span><br><span class="line">    InputStream in = Resources.getResourceAsStream(<span class="string">&quot;sqlMapConfig.xml&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建SqlSessionFactoryBuilder</span></span><br><span class="line">    SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过SqlSessionFactoryBuilder加载输入流，创建工厂</span></span><br><span class="line">    SqlSessionFactory factory = builder.build(in);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过工厂创建SqlSession对象</span></span><br><span class="line">    SqlSession sqlSession = factory.openSession();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过SqlSession对象获取Dao的代理对象</span></span><br><span class="line">    UserDao userDao = sqlSession.getMapper(UserDao.class);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//执行数据库操作</span></span><br><span class="line">    User user = userDao.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;user = &quot;</span> + user);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//关闭sqlSession</span></span><br><span class="line">    sqlSession.close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>执行test方法，输出：<code>user = User(id=1, username=张三, password= 123456)</code> </p>
<p>over.</p>
<h2 id="获取SqlSession步骤"><a href="#获取SqlSession步骤" class="headerlink" title="获取SqlSession步骤"></a>获取SqlSession步骤</h2><p>步骤如下：</p>
<ol>
<li><p><strong>读取配置文件</strong>。通过<strong>org.apache.ibatis.io.Resources</strong>类的<code>getResourceAsStream()</code><strong>静态方法</strong>获取主配置文件的输入流：</p>
<p><code>InputStream in = Resources.getResourceAsStream(&quot;SqlMapConfig.xml&quot;);</code></p>
</li>
<li><p><strong>创建SqlSessionFactory工厂</strong>。SqlSessionFactory不能直接通过构造器创建，需先创建一个<strong>SqlSessionFactoryBuilder</strong>，再通过builder加载上述创建的输入流，创建工厂对象：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">SqlSessionFactory factory = builder.builde(in);<span class="comment">//传入主配置文件的输入流</span></span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>通过工厂创建SqlSession对象</strong>。</p>
<p><code>SqlSession session = factory.openSession();</code> </p>
</li>
<li><p><strong>通过session获取dao接口的代理对象</strong>（<strong>也可以不使用代理对象，直接使用session对象的方法实现数据库操作，如selectAll()等</strong>）</p>
<p><code>XxxDao dao = session.getMapper(XxxDao.class);</code></p>
</li>
<li><p>使用该dao代理对象执行方法，进行数据库操作。</p>
</li>
</ol>
<h1 id="SqlSession简介"><a href="#SqlSession简介" class="headerlink" title="SqlSession简介"></a>SqlSession简介</h1><p>SqlSession对象是Mybatis中的一个主要接口，可以通过这个接口来执行命令，获取映射器示例和管理事务。</p>
<p>SqlSession提供了之间操作数据库的方法，如：<code>session.selectOne(&quot;org.mybatis.example.BlogMapper.selectBlog&quot;, 101)</code>。但一般不使用这些方法，而是通过配置Mapper（即dao接口）的映射文件，再通过SqlSession获取Mapper的代理对象。</p>
<p>SqlSession由SqlSessionFactory创建，SqlSessionFactory的<code>openSession</code>方法有一个重载形式：<code>openSession(boolean autoCommit)</code>，autoCommit指定是否自动提交（即是否开启事务），默认是false，即开启事务。所以默认情况下执行update、delte和insert语句时需要提交事务，即执行SqlSession的<code>commit()</code>方法，否则将造成事务回滚。也可以通过<code>openSession(true)</code>来获取关闭事务的SqlSession。</p>
<p>另外，SqlSession 对象不是线程安全的，所以每个线程都应该有它自己的 SqlSession 对象，且每次执行完数据库操作后，应关闭SqlSession：<code>session.close()</code>。</p>
<blockquote>
<p>最佳作用域</p>
<p><strong>SqlSessionFactoryBuilder</strong></p>
<p>创建了SqlSessionFactory后，就不再需要SqlSessionFactoryBuilder，所以其最佳作用域是方法作用域，即声明为局部变量。</p>
<p><strong>SqlSessionFactory</strong></p>
<p>SqlSessionFactory 一旦被创建就应该在应用的运行期间一直存在。因为SqlSession需要每次使用完都执行关闭操作，因此每一次进行数据库操作需通过SqlSessionFactory 获取SqlSession。</p>
<p><strong>因此 SqlSessionFactory 的最佳作用域是应用作用域</strong>。 最简单的就是使用单例模式或者静态单例模式。</p>
<p><strong>SqlSession</strong></p>
<p>SqlSession 对象不是线程安全的，每个线程都应该有它自己的 SqlSession 对象。所以SqlSession的最佳作用域是请求或方法作用域。</p>
<p>不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量。 也绝不能将 SqlSession 实例的引用放在任何类型的托管作用域中，比如 Servlet 框架中的 HttpSession。如果使用一种 Web 框架，可以将 SqlSession 放在一个和 HTTP 请求相似的作用域中。</p>
<p><strong>且每次使用完SqlSession，都应该执行关闭操作</strong>。</p>
</blockquote>
<h1 id="主配置文件"><a href="#主配置文件" class="headerlink" title="主配置文件"></a>主配置文件</h1><h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>主配置文件结构：（详细说明见官方文档：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html%EF%BC%89">https://mybatis.org/mybatis-3/zh/configuration.html）</a></p>
<p>configuration（配置）</p>
<ul>
<li><p>properties（属性)</p>
</li>
<li><p>settings（设置）</p>
</li>
<li><p>typeAliases（类型别名）</p>
</li>
<li><p>typeHandlers（类型处理器)</p>
</li>
<li><p>objectFactory（对象工厂）</p>
</li>
<li><p>plugins（插件）</p>
</li>
<li><p>environments（环境配置）</p>
<ul>
<li>environment（环境变量）<ul>
<li>transactionManager（事务管理器）</li>
<li>dataSource（数据源）</li>
</ul>
</li>
</ul>
</li>
<li><p>databaseIdProvider（数据库厂商标识）</p>
</li>
<li><p>mappers（映射器）</p>
</li>
</ul>
<p>以下介绍几个常用标签。其他标签的具体使用见官方文档。</p>
<h2 id="lt-properties-gt"><a href="#lt-properties-gt" class="headerlink" title="&lt;properties&gt;"></a><code>&lt;properties&gt;</code></h2><p>该标签的作用是配置连接数据库的相关参数信息。<strong>可以通过<code>&lt;property&gt;</code>子标签配置，也可以使用<code>resource</code>属性引用外部配置文件</strong>，两种方式<strong>可以混合使用</strong>。在配置<code>&lt;dataSource&gt;</code>时，<strong>通过<code>$&#123;paramName&#125;</code>的方式获取到配置的值</strong>。</p>
<p>如快速入门中主配置文件可改为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//...省略</span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">&quot;jdbc.properties&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line"></span><br><span class="line">//...省略</span><br></pre></td></tr></table></figure>



<p>jdbc.properties：（<strong>该文件放在resource目录下</strong>）</p>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">driver</span>=<span class="string">com.mysql.jdbc.Driver</span></span><br><span class="line"><span class="attr">url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/test?serverTimezone=UTC</span></span><br><span class="line"><span class="attr">username</span>=<span class="string">root</span></span><br><span class="line"><span class="attr">password</span>=<span class="string">admin</span></span><br></pre></td></tr></table></figure>



<p><strong>一般把属性信息都配置在properties文件中，不使用property标签配置</strong>。</p>
<h2 id="lt-settings-gt"><a href="#lt-settings-gt" class="headerlink" title="&lt;settings&gt;"></a><code>&lt;settings&gt;</code></h2><p><code>&lt;settings&gt;</code> 用来配置mybatis的一些全局变量，以开启延迟加载为例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>mybatis有很多全局变量，其他变量的详细介绍见：<a target="_blank" rel="noopener" href="https://mybatis.org/mybatis-3/zh/configuration.html#settings">https://mybatis.org/mybatis-3/zh/configuration.html#settings</a></p>
<h2 id="lt-typeAliases-gt"><a href="#lt-typeAliases-gt" class="headerlink" title="&lt;typeAliases&gt;"></a><code>&lt;typeAliases&gt;</code></h2><p>该标签的作用是为Java类指定一个缩写别名，就不用每次指定类时都使用其全限定名。</p>
<p>如：</p>
<p><strong>type属性指定类的全限定名；alias属性指定别名</strong>。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;author&quot;</span> <span class="attr">type</span>=<span class="string">&quot;domain.blog.Author&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>通过该配置，在任何使用 <code>domain.blog.Autho</code> 的地方，都可以用author代替</strong>，且不区分大小写。</p>
<p>也可以在<code>&lt;typeAliases&gt;</code> 标签中使用<code>&lt;package&gt;</code>标签指定一个包名，<strong>对该包下的所有类会使用 Bean 的首字母小写的非限定类名来作为它的别名</strong>。如<code>domain.blog.Blog</code>的别名为blog。<strong>这种方法更被推荐使用</strong>。</p>
<p>例子：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;domain.blog&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="lt-environments-gt"><a href="#lt-environments-gt" class="headerlink" title="&lt;environments&gt;"></a><code>&lt;environments&gt;</code></h2><p><code>&lt;environments&gt;</code>用于配置环境。<strong>可以配置多个数据库环境，但只能选择一种环境，通过default指定要使用的<code>&lt;environment&gt;</code> 的id</strong>。<strong>每个 SqlSessionFactory 实例只能对应一种环境</strong>，如想要连接两个数据库，则需要两个SqlSessionFactory 。</p>
<p>在<code>&lt;environments&gt;</code>通过<code>&lt;transactionManager&gt;</code> 来配置事务管理器。</p>
<p>以下来自官网：</p>
<p>在 MyBatis 中有两种类型的事务管理器（也就是 type=”[JDBC|MANAGED]”）：</p>
<ul>
<li><p>JDBC – 这个配置直接使用了 JDBC 的提交和回滚设施，它依赖从数据源获得的连接来管理事务作用域。</p>
</li>
<li><p>MANAGED – 这个配置几乎没做什么。它从不提交或回滚一个连接，而是让容器来管理事务的整个生命周期（比如 JEE 应用服务器的上下文）。 默认情况下它会关闭连接。然而一些容器并不希望连接被关闭，因此需要将 closeConnection 属性设置为 false 来阻止默认的关闭行为</p>
</li>
<li><p><strong>如果使用的是Spring + MyBatis，则没有必要配置事务管理器，因为 Spring 模块会使用自带的管理器来覆盖前面的配置</strong>。</p>
</li>
</ul>
<p><code>&lt;dataSource&gt;</code> 元素使用标准的 JDBC 数据源接口来配置 JDBC 连接对象的资源。在<code>&lt;dataSource&gt;</code>通过type属性指定数据源类型，Mybatis提供了3种数据源类型：</p>
<ul>
<li><strong>UNPOOLED</strong>：每次请求数据库连接时打开一个连接，使用完时关闭连接。没有使用连接池的概念。适用那些对数据库连接可用性要求不高的简单应用程序。</li>
<li><strong>POOLED</strong>：使用了连接池，避免了创建新的连接实例时所必需的初始化和认证时间。</li>
<li><strong>JNDI</strong>：放置一个 JNDI 上下文的数据源引用。</li>
</ul>
<p>示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;url&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;username&#125;&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;password&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="lt-mappers-gt"><a href="#lt-mappers-gt" class="headerlink" title="&lt;mappers&gt;"></a><code>&lt;mappers&gt;</code></h2><p>该标签用于<strong>指定映射文件的位置，即告诉Mybatis要到哪里去找Mapper对应的映射文件</strong>。</p>
<p>有多种配置方式：</p>
<ul>
<li>使用第一种方式时，是在resource目录下（类路径下）寻找映射文件。映射文件的目录结构要与其对应的Mapper的包结构一致，如<code>org/mybatis/builder/UserMapper.xml</code>对应<code>org.mybatis.builder.UserMapper</code>。**且要注意分隔符是 / 而不是 . ** </li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 使用相对于类路径的资源引用 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;org/mybatis/builder/UserMapper.xml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 使用映射器接口实现类的完全限定类名 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.builder.AuthorMapper&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 将包内的映射器接口实现全部注册为映射器 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;org.mybatis.builder&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>





<h1 id="基本CRUD以及参数映射"><a href="#基本CRUD以及参数映射" class="headerlink" title="基本CRUD以及参数映射"></a>基本CRUD以及参数映射</h1><h2 id="和"><a href="#和" class="headerlink" title="#{}和${}"></a>#{}和${}</h2><p>默认情况下，使用 <code>#&#123;&#125;</code> 时，MyBatis 会创建 <code>PreparedStatement</code> 参数占位符，并通过占位符安全地设置参数（就像使用 ? 一样）。</p>
<p>但<code>PreparedStatement</code> 的占位符不能用于一些元数据字段，如表名、列名。这时可以使用<code>$&#123;&#125;</code>，mybatis会直接插入一个不转义的字符串。</p>
<p>如要查询某个字段名为指定值的记录，不用在mapper中定义多个查询方法，如：<code>findById()</code>、<code>findByUsername()</code>。可以直接用一个方法：其中columnName指字段名，value指字段值</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">User <span class="title">selectByColumn</span><span class="params">(<span class="meta">@Param(&quot;columnName&quot;)</span> String columnName, <span class="meta">@Param(&quot;value&quot;)</span> String value)</span></span>;</span><br></pre></td></tr></table></figure>

<p>映射文件中的sql语句：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByColumn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select * from user where $&#123;columnName&#125;=#&#123;value&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>其中columnName将直接替换<code>$&#123;columnName&#125;</code>。</li>
</ul>
<p><strong>一般优先使用<code>#&#123;&#125;</code>，其使用的是PreparedStatement会更加安全。而<code>$&#123;&#125;</code>可能会引起SQL注入</strong>。</p>
<h2 id="参数映射"><a href="#参数映射" class="headerlink" title="参数映射"></a>参数映射</h2><ul>
<li><p><strong>对于方法形参到sql语句的参数映射</strong>：</p>
<ul>
<li><strong>当Mapper方法只有一个参数时，<code>#&#123;&#125;</code>内的值无需与方法形参名对应，可以任意指定</strong>。若是有多个形参：<ul>
<li>以param加上形参在参数列表中的位置来命名（从1开始），比如：<code>#&#123;param1&#125;、#&#123;param2&#125;</code>。</li>
<li>使用<code>@Param</code>注解修饰形参，通过其value属性自定义命名，并在<code>#&#123;&#125;</code>内使用对应命名。</li>
</ul>
</li>
<li>当传入的参数的一个JavaBean，要获取其属性，通过<code>#&#123;属性名&#125;</code>即可。（<strong>若是bean中含bean，则使用<code>#&#123;innerBean.paramName&#125;</code>的形式</strong>）</li>
<li>parameterType属性可以指定传入的参数类型。该属性是可选的，一般情况下mybatis都可以推断出具体传入语句的参数类型。</li>
</ul>
</li>
<li><p><strong>对于sql语句到返回值的参数映射</strong>：</p>
<ul>
<li><p><strong>通过resultType属性可以指定返回值类型。且当返回值是集合时，返回类型不是设置为集合，而是应指定其集合元素的类型</strong>。resultType适用于表的字段名与JavaBean的成员变量名一一对应的情况，MyBatis 会<strong>获取结果中返回的列名并在 Java 类中查找相同名字的属性（忽略大小写）</strong>。若是不对应将会抛出异常。这种情况可以使用<code>&lt;resultMap&gt;</code>标签。</p>
<blockquote>
<p>PS：当使用<code>#&#123;&#125;</code>从传入的对象中获取其属性值时是区分大小写的，如User对象有一个userName属性，若使用<code>#&#123;username&#125;</code>，Mybatis将会找不到userName属性，抛出异常。</p>
</blockquote>
</li>
<li><p><code>&lt;resultMap&gt;</code>标签可以对表字段与JavaBean属性不对应的情况进行手动映射。<strong>且手动映射与自动映射会相互配合</strong>。<strong>即在<code>&lt;resultMapL&gt;</code>中可以只手动映射不对应的字段，那些对应的字段可以省略，Mybatis会进行自动映射处理</strong>。<code>&lt;resultMap&gt;</code>配置完毕后，在<code>&lt;select&gt;</code> 等标签中通过resultMap属性引用。</p>
</li>
<li><p><strong>返回类型的配置不能省略</strong>。</p>
</li>
</ul>
</li>
</ul>
<p><code>&lt;resultMap&gt;</code>示例：</p>
<p>Book类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String bookName;</span><br><span class="line">    <span class="keyword">private</span> String bookAuthor;</span><br><span class="line">    <span class="keyword">private</span> Integer price;</span><br><span class="line">    <span class="comment">//getter、setter、toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>book表：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200915215129913.png" alt="image-20200915215129913"></p>
<p>可看到Book类的bookName、bookAuthor属性与book表的book_name，author不对应。</p>
<p>映射文件的配置：</p>
<ul>
<li><code>&lt;resultMap&gt;</code>的id属性<strong>唯一标识该映射</strong>。</li>
<li>type属性指定要映射的JavaBean类；<strong>id标签用于映射主键，result标签用于映射普通字段。property属性指定JavaBean的属性名，column属性指定表的字段名</strong>。</li>
<li>在select标签中使用<code>resultMap=&quot;bookMap&quot;</code>引用配置的映射。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;bookMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;book&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;bookName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;book_name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;bookAuthor&quot;</span> <span class="attr">column</span>=<span class="string">&quot;author&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;bookMap&quot;</span>&gt;</span></span><br><span class="line">    select * from book where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">    InputStream stream = Resources.getResourceAsStream(<span class="string">&quot;sqlMapConfig.xml&quot;</span>);</span><br><span class="line">    SqlSessionFactory factory = builder.build(stream);</span><br><span class="line">    SqlSession session = factory.openSession();</span><br><span class="line"></span><br><span class="line">    BookMapper mapper = session.getMapper(BookMapper.class);</span><br><span class="line">    Book book = mapper.selectById(<span class="number">1</span>);</span><br><span class="line">    System.out.println(book);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：Book(id=1, bookName=Java疯狂讲义, bookAuthor=李刚, price=100)</span></span><br></pre></td></tr></table></figure>





<h2 id="lt-select-gt-★"><a href="#lt-select-gt-★" class="headerlink" title="&lt;select&gt; ★"></a><code>&lt;select&gt;</code> ★</h2><p>下文例子中的user表：其中，id是自增主键</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200915181249271.png" alt="image-20200915181249271"></p>
<p>User类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="comment">//...set、getter,toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>----------------</code> </p>
<p>直接上例子：</p>
<p>UserMapper中查询相关方法定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//根据id查询</span></span><br><span class="line"><span class="function">User <span class="title">selectById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//查询全部，返回类型是集合</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//模糊查询。查询username中带有keyword的用户</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">selectByFuzzy</span><span class="params">(String keyword)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定字段和其字段值查询</span></span><br><span class="line"><span class="function">User <span class="title">selectByColumn</span><span class="params">(String columnName, String value)</span></span>;</span><br></pre></td></tr></table></figure>



<p>对应的映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span> &gt;</span></span><br><span class="line">    select * from user where username = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select * from user</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByFuzzy&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select * from user where username like #&#123;keyword&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByColumn&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    select * from user where $&#123;param1&#125;=#&#123;param2&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>要注意的点</strong>：</p>
<ul>
<li>select标签中的<strong>id属性指定的是Mapper中的方法名</strong>。（对后文的<code>&lt;insert&gt;</code>等标签一样）</li>
<li>resultType属性指定返回值类型。例子中的user指User类，已使用别名。</li>
<li>注意selectAll方法的返回值的List集合，而对应select标签的resultType属性是List的元素User。</li>
<li>selectByColumn是根据字段名跟字段值进行查询。与上文例子相同。该mapper方法有两个参数，<strong>在sql语句中使用param+形参位置的形式映射参数</strong>。</li>
<li>在测试方法中，调用mapper的selectByFuzzy方法时，传入的参数是<code>%小%</code>。<strong>即进行模糊查询时，要注意传参时先拼接好通配符</strong>。</li>
</ul>
<p>测试方法：</p>
<p>测试类中使用了Junit的@Before初始化了SqlSessionFactory，并作为测试类的成员变量：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> SqlSessionFactory factory;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactoryBuilder builder = <span class="keyword">new</span> SqlSessionFactoryBuilder();</span><br><span class="line">    InputStream in = Resources.getResourceAsStream(<span class="string">&quot;sqlMapConfig.xml&quot;</span>);</span><br><span class="line">    factory = builder.build(in);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession();)&#123;</span><br><span class="line">        UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line"></span><br><span class="line">        User user = mapper.selectById(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;id为2的User: &quot;</span> + user);</span><br><span class="line"></span><br><span class="line">        List&lt;User&gt; users = mapper.selectAll();</span><br><span class="line">        System.out.println(<span class="string">&quot;所有User: &quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (User u : users)&#123;</span><br><span class="line">            System.out.println(u);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//查询用户名中带有‘小’的用户</span></span><br><span class="line">        List&lt;User&gt; users2 = mapper.selectByFuzzy(<span class="string">&quot;%小%&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;用户名中带有 小 的用户：&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span>(User u : users2)&#123;</span><br><span class="line">            System.out.println(u);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        User user1 = mapper.selectByColumn(<span class="string">&quot;username&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;查询username字段为张三的记录：&quot;</span> + user1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">id为2的User: User(id=2, username=李四, password=5896596)</span></span><br><span class="line"><span class="comment">所有User: </span></span><br><span class="line"><span class="comment">User(id=1, username=张三, password=123456)</span></span><br><span class="line"><span class="comment">User(id=2, username=李四, password=5896596)</span></span><br><span class="line"><span class="comment">User(id=3, username=王小强, password=666666)</span></span><br><span class="line"><span class="comment">User(id=4, username=许小红, password=777777)</span></span><br><span class="line"><span class="comment">用户名中带有 小 的用户：</span></span><br><span class="line"><span class="comment">User(id=3, username=王小强, password=666666)</span></span><br><span class="line"><span class="comment">User(id=4, username=许小红, password=777777)</span></span><br><span class="line"><span class="comment">查询username字段为张三的记录：User(id=1, username=张三, password=123456)</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h2 id="lt-insert-gt-★"><a href="#lt-insert-gt-★" class="headerlink" title="&lt;insert&gt; ★"></a><code>&lt;insert&gt;</code> ★</h2><p>同上，直接看例子。</p>
<p>Mapper方法定义：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br></pre></td></tr></table></figure>

<p>对应的映射文件配置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">    insert into user values(null, #&#123;username&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testInsert</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession sqlSession=factory.openSession())&#123;</span><br><span class="line">        UserMapper mapper = sqlSession.getMapper(UserMapper.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(<span class="string">&quot;蜘蛛侠&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;555969&quot;</span>);</span><br><span class="line">        mapper.insert(user);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;执行插入后，获取user的id值：&quot;</span> + user.getId());</span><br><span class="line">        <span class="comment">//提交事务</span></span><br><span class="line">        sqlSession.commit();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：执行插入后，获取user的id值：11</span></span><br></pre></td></tr></table></figure>



<p><strong>要注意的点</strong>：</p>
<ul>
<li><p>注意到sql语句并没有插入id值（id是自增主键），<strong>可以通过<code>useGeneratedKeys=&quot;true&quot; keyProperty=&quot;id&quot;</code>的配置，获取执行插入操作后新记录的主键值，获取的主键值会返回给传入的JavaBean；keyProperty指定的是表的字段名</strong>，，如例子中执行插入操作后，把插入记录的id值赋值给user对象。</p>
<ul>
<li><p>也可以通过<code>&lt;selectKey&gt;</code>标签实现：（order属性值表示插入后或插入前获取主键）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;insert&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;user&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span> <span class="attr">order</span>=<span class="string">&quot;AFTER&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;int&quot;</span>&gt;</span></span><br><span class="line">        select LAST_INSERT_ID();</span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></span><br><span class="line">    insert into user values(null, #&#123;username&#125;, #&#123;password&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>在测试方法的最后，有一句<code>sqlSession.commit();</code>，<strong>mybatis默认开启事务，即autoCommit属性为false，所以执行插入操作后需要提交事务。也可以在获取sqlSession时指定autoCommit属性为true，如下：</strong></p>
<p>**<code>SqlSession sqlSession=factory.openSession(true)</code>**（更新、删除操作也一样）</p>
<p>否则操作将会回滚。</p>
</li>
</ul>
<h2 id="lt-delete-gt-amp-lt-update-gt"><a href="#lt-delete-gt-amp-lt-update-gt" class="headerlink" title="&lt;delete&gt; &amp; &lt;update&gt;"></a><code>&lt;delete&gt;</code> &amp; <code>&lt;update&gt;</code></h2><p>这两个元素与insert大同小异。看个简单示例即可。</p>
<p>Mapper方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;update&quot;</span>&gt;</span></span><br><span class="line">    update user set username=#&#123;username&#125;, password=#&#123;password&#125; where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">&quot;deleteById&quot;</span>&gt;</span></span><br><span class="line">    delete from user where id=#&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">delete</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdate</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession(<span class="keyword">true</span>))&#123;</span><br><span class="line">        UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setId(<span class="number">3</span>);</span><br><span class="line">        user.setUsername(<span class="string">&quot;王宝强&quot;</span>);</span><br><span class="line">        user.setPassword(<span class="string">&quot;666888&quot;</span>);</span><br><span class="line"></span><br><span class="line">        mapper.update(user);</span><br><span class="line">        System.out.println(<span class="string">&quot;修改了id为3的user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDelete</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession(<span class="keyword">true</span>))&#123;</span><br><span class="line">        UserMapper mapper = session.getMapper(UserMapper.class);</span><br><span class="line">        mapper.deleteById(<span class="number">14</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;删除了id为14的user&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="抽取可复用sql语句"><a href="#抽取可复用sql语句" class="headerlink" title="抽取可复用sql语句"></a>抽取可复用sql语句</h2><p>通过<code>&lt;sql&gt;</code>标签定义可重用的sql语句片段，通过<code>&lt;include&gt;</code>标签引用。</p>
<p>官方文档的示例：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span> $&#123;alias&#125;.id,$&#123;alias&#125;.username,$&#123;alias&#125;.password <span class="tag">&lt;/<span class="name">sql</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUsers&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">  select</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;alias&quot;</span> <span class="attr">value</span>=<span class="string">&quot;t1&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span>,</span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">refid</span>=<span class="string">&quot;userColumns&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;alias&quot;</span> <span class="attr">value</span>=<span class="string">&quot;t2&quot;</span>/&gt;</span><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">  from some_table t1</span><br><span class="line">    cross join some_table t2</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="动态SQL"><a href="#动态SQL" class="headerlink" title="动态SQL"></a>动态SQL</h1><p>Mybatis的动态sql可以<strong>使用简单的配置来实现根据条件拼接sql语句</strong>。让开发者可以不用过多关注于语法方面的问题。</p>
<p>下文例子中的数据表（employee）：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200916131813006.png" alt="image-20200916131813006" style="zoom:80%;" />



<p>对应的JavaBean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> String gender;</span><br><span class="line">    <span class="keyword">private</span> String department;</span><br><span class="line">    <span class="keyword">private</span> Integer salary;</span><br><span class="line">    <span class="comment">//...set getter toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="lt-if-gt"><a href="#lt-if-gt" class="headerlink" title="&lt;if&gt;"></a><code>&lt;if&gt;</code></h2><p>EmployeeMapper中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Employee&gt; <span class="title">selectByConditionIf</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>



<p>对应的映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByConditionIf&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">    select * from employee where gender=#&#123;gender&#125;</span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>and name like #&#123;name&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;salary != null&quot;</span>&gt;</span>and salary&gt;#&#123;salary&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li><p><strong>test属性设置了条件</strong>。当employee的相关属性不为空时，将会在where中添加对应条件。test属性中要使用传入参数的属性时，直接使用属性名即可。</p>
</li>
<li><p><strong>where关键字后必须带有一个条件，否则当所有if条件不满足时，sql语句将会出现语法错误：<code>select * from employee where</code>。</strong> </p>
</li>
<li><p>若是test中的条件要用到与或非，不能使用<code>&amp;&amp; ||</code>等符号，应使用<code>and not or</code>。如<code>author != null and author.name != null</code>。</p>
</li>
<li><p><strong>当所有条件都不满足，就只有<code>gender=#&#123;gender&#125;</code>一个条件</strong>。</p>
</li>
</ul>
<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testIf</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession())&#123;</span><br><span class="line">        EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);</span><br><span class="line"></span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">        employee.setGender(<span class="string">&quot;男&quot;</span>);</span><br><span class="line">        employee.setName(<span class="string">&quot;%小%&quot;</span>);</span><br><span class="line">        employee.setSalary(<span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Employee&gt; employees = mapper.selectByConditionIf(employee);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Employee e : employees)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//输出：</span></span><br><span class="line"><span class="comment">//Employee(id=1, name=小明, gender=男, department=保安部, salary=5000)</span></span><br><span class="line"><span class="comment">//Employee(id=3, name=小强, gender=男, department=保安部, salary=5000)</span></span><br></pre></td></tr></table></figure>



<h2 id="lt-choose-gt"><a href="#lt-choose-gt" class="headerlink" title="&lt;choose&gt;"></a><code>&lt;choose&gt;</code></h2><p><code>&lt;choose&gt;</code> 类似于Java的switch，即<strong>按顺序判断条件，若满足则拼接对应的语句，之后的条件不再判断。所有条件都不满时，则拼接<code>&lt;otherwise&gt;</code>中的语句</strong>。</p>
<p>示例：</p>
<p>EmployeeMapper中的方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Employee&gt; <span class="title">selectByConditionChoose</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>



<p>对应的映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByConditionChoose&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">    select * from employee where 1=1</span><br><span class="line">    <span class="tag">&lt;<span class="name">choose</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>and name like #&#123;name&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">&quot;salary != null&quot;</span>&gt;</span>and salary&gt;#&#123;salary&#125;<span class="tag">&lt;/<span class="name">when</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span></span><br><span class="line">            and gender=#&#123;gender&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">choose</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="lt-where-gt"><a href="#lt-where-gt" class="headerlink" title="&lt;where&gt;"></a><code>&lt;where&gt;</code></h2><p>相比于使用if，使用<code>&lt;where&gt;</code>标签在sql语句中不用出现where关键字。<strong>where元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句</strong>。<strong>若子句的开头为 “AND” 或 “OR”，where元素也会将它们去除</strong>。</p>
<p>示例：</p>
<p>Mapper方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Employee&gt; <span class="title">selectByConditionWhere</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByConditionWhere&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">    select * from employee</span><br><span class="line">     <span class="tag">&lt;<span class="name">where</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span>and  gender=#&#123;gender&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>and name like #&#123;name&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;salary != null&quot;</span>&gt;</span>and salary&gt;#&#123;salary&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>当有条件满足时，mybatis会插入对应where子句。若没有条件满足，则会查询所有记录。</p>
<h2 id="lt-set-gt"><a href="#lt-set-gt" class="headerlink" title="&lt;set&gt;"></a><code>&lt;set&gt;</code></h2><p>与<code>&lt;where&gt;</code>类似，可通过<code>&lt;set&gt;</code> 实现动态更新语句。</p>
<p>示例：</p>
<p>Mapper方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updateByCondition</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">&quot;updateByCondition&quot;</span>&gt;</span></span><br><span class="line">    update employee</span><br><span class="line">    <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;name != null&quot;</span>&gt;</span>name = #&#123;name&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;gender != null&quot;</span>&gt;</span>gender = #&#123;gender&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;department != null&quot;</span>&gt;</span>department = #&#123;department&#125;,<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">&quot;salary != null&quot;</span>&gt;</span>salary = #&#123;salary&#125;<span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">    where id = #&#123;id&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">update</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testUpdateByCondition</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//注意以开启事务的方式获取SqlSession</span></span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession(<span class="keyword">true</span>))&#123;</span><br><span class="line">        EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);</span><br><span class="line"></span><br><span class="line">        Employee employee = <span class="keyword">new</span> Employee();</span><br><span class="line">        employee.setId(<span class="number">1</span>);</span><br><span class="line">        employee.setDepartment(<span class="string">&quot;程序员&quot;</span>);</span><br><span class="line">        employee.setSalary(<span class="number">15000</span>);</span><br><span class="line"></span><br><span class="line">        mapper.updateByCondition(employee);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>执行测试方法，id为1的记录的department字段和salary字段被更新。</p>
<ul>
<li><strong>注意if元素里的sql语句尾部的逗号不可少（最后一个if可省略逗号）</strong>，否则会发送语法错误。</li>
<li><strong>当所有的if都不满足条件会发生语法错误</strong>。</li>
</ul>
<h2 id="lt-foreach-gt"><a href="#lt-foreach-gt" class="headerlink" title="&lt;foreach&gt;"></a><code>&lt;foreach&gt;</code></h2><p><code>&lt;foreach&gt;</code> 可以通过循环的方式获取集合中的值。尤其适合<code>IN</code>语句。</p>
<p>根据id集合查询的示例：</p>
<p>Mapper方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Employee&gt; <span class="title">selectByIdsWithForeach</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectByIdsWithForeach&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;employee&quot;</span>&gt;</span></span><br><span class="line">    select * from employee</span><br><span class="line">    where id in</span><br><span class="line">    <span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">&quot;collection&quot;</span> <span class="attr">index</span>=<span class="string">&quot;index&quot;</span> <span class="attr">item</span>=<span class="string">&quot;id&quot;</span></span></span><br><span class="line"><span class="tag">             <span class="attr">open</span>=<span class="string">&quot;(&quot;</span> <span class="attr">separator</span>=<span class="string">&quot;,&quot;</span> <span class="attr">close</span>=<span class="string">&quot;)&quot;</span>&gt;</span></span><br><span class="line">        #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectByIdsWithForeach</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession())&#123;</span><br><span class="line">        EmployeeMapper mapper = session.getMapper(EmployeeMapper.class);</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;Integer&gt; ids = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        <span class="comment">//获取id为1、2、3的记录</span></span><br><span class="line">        ids.add(<span class="number">1</span>);</span><br><span class="line">        ids.add(<span class="number">2</span>);</span><br><span class="line">        ids.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        List&lt;Employee&gt; employees = mapper.selectByIdsWithForeach(ids);</span><br><span class="line">        <span class="keyword">for</span>(Employee e : employees)&#123;</span><br><span class="line">            System.out.println(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>**<code>&lt;foreach&gt;</code> 的collection属性的属性值只能为<code>list</code>和<code>collection</code>**，使用别的命名比如ids会抛出以下异常：</p>
<blockquote>
<p>Cause: org.apache.ibatis.binding.BindingException: Parameter ‘ids’ not found. Available parameters are [collection, list]</p>
<p>从异常来看应该是只能使用这两种命名….</p>
</blockquote>
<p><strong>且Mapper方法的集合形参的参数名不用跟collection属性值相对应</strong>。</p>
<h1 id="Mybatis多表查询"><a href="#Mybatis多表查询" class="headerlink" title="Mybatis多表查询"></a>Mybatis多表查询</h1><h2 id="一对一-lt-association-gt"><a href="#一对一-lt-association-gt" class="headerlink" title="一对一(&lt;association&gt;)"></a>一对一(<code>&lt;association&gt;</code>)</h2><p>以学生（Student）和身份证（Card）为例，即一个学生对应一个身份证。</p>
<p>数据表如下：（表中的字段除了3个id字段，其他都是varchar类型，card_id是指向card的id字段的外键）</p>
<p>card：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200916223746339.png" alt="image-20200916223746339" style="zoom:80%;" />

<p>student：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200916223847902.png" alt="image-20200916223847902" style="zoom:80%;" />

<p>（省略了setter等）</p>
<p>Card类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Card</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Student类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String studentName;</span><br><span class="line">    <span class="keyword">private</span> Card card;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p>编写StudentMapper方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Student&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>



<p>映射文件（<strong>查询全部，并Student对应的Card封装进Student</strong>）：</p>
<ul>
<li><p>sql语句使用的是等值连接查询。</p>
</li>
<li><p><strong>cardMap和studentMap的id标签中的column属性值，分别是cid和sid，对应查询语句结果集的字段名，这里为s.id和c.id设置了别名</strong>。</p>
<blockquote>
<p>此处column属性值不能使用s.id和c.id，mybatis将无法解析。所以可通过为字段指定别名，将column值指定为对应别名。</p>
</blockquote>
</li>
<li><p>studentMap中<strong>使用了<code>&lt;association&gt;</code>标签</strong>来封装Student中的Card对象。</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;cardMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;idNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id_number&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;studentName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;card&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;cardMap&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentMap&quot;</span>&gt;</span></span><br><span class="line">    select s.id sid,student_name,c.id cid,id_number</span><br><span class="line">    from student s</span><br><span class="line">    inner join card c</span><br><span class="line">    on s.card_id=c.id;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectALl</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession())&#123;</span><br><span class="line">        StudentMapper mapper = session.getMapper(StudentMapper.class);</span><br><span class="line">        List&lt;Student&gt; students = mapper.selectAll();</span><br><span class="line">        <span class="keyword">for</span>(Student student : students)&#123;</span><br><span class="line">            System.out.println(student);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Student(<span class="attribute">id</span>=2, <span class="attribute">studentName</span>=小明, <span class="attribute">card</span>=Card(id=1, <span class="attribute">idNumber</span>=111111))</span><br><span class="line">Student(<span class="attribute">id</span>=1, <span class="attribute">studentName</span>=张三, <span class="attribute">card</span>=Card(id=2, <span class="attribute">idNumber</span>=222222))</span><br><span class="line">Student(<span class="attribute">id</span>=3, <span class="attribute">studentName</span>=王大锤, <span class="attribute">card</span>=Card(id=3, <span class="attribute">idNumber</span>=333333))</span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>&emsp;  </p>
<hr>
<h2 id="一对多-lt-collection-gt"><a href="#一对多-lt-collection-gt" class="headerlink" title="一对多(&lt;collection&gt;)"></a>一对多(<code>&lt;collection&gt;</code>)</h2><p>以班级（grade）和老师（Teacher）为例，一个班级对应多个老师</p>
<p>grade表：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200916233040044.png" alt="image-20200916233040044" style="zoom:80%;" />

<p>teacher表：（grade_id为指向grade的外键）</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200916233100274.png" alt="image-20200916233100274" style="zoom:80%;" />

<p>对应的JavaBean：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Grade</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String gradeName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Teacher&gt; teachers;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Teacher</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String teacherName;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//省略了setter、getter、toString</span></span><br></pre></td></tr></table></figure>



<p>定义Mapper方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">List&lt;Grade&gt; <span class="title">selectAll</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<ul>
<li>先使用<code>&lt;resultMap&gt;</code>分别对两个表跟JavaBean进行映射。</li>
<li>gradeMap中<strong>使用了<code>&lt;collection&gt;</code>封装Grade中的Teacher</strong>，通过<code>resultMap</code>属性指定集合类型。property属性指定集合对应的JavaBean属性。</li>
<li>与一对一中一样，注意别名问题。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;teacherMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;teacher&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;tid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;teacherName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;teacher_name&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;gradeMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;grade&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gradeName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;grade_name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;teachers&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;teacherMap&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;gradeMap&quot;</span>&gt;</span></span><br><span class="line">    select g.id gid, g.grade_name, t.id tid,t.teacher_name</span><br><span class="line">    from grade g</span><br><span class="line">    inner join teacher t</span><br><span class="line">    on t.grade_id=g.id;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelectAll</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession())&#123;</span><br><span class="line">        GradeMapper mapper = session.getMapper(GradeMapper.class);</span><br><span class="line">        List&lt;Grade&gt; grades = mapper.selectAll();</span><br><span class="line">        <span class="keyword">for</span>(Grade grade : grades)&#123;</span><br><span class="line">            System.out.println(grade);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>输出：可看到与实际表数据对应。</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Grade(<span class="attribute">id</span>=2, <span class="attribute">gradeName</span>=软件工程, teachers=[Teacher(<span class="attribute">id</span>=1, <span class="attribute">teacherName</span>=黄老师), Teacher(<span class="attribute">id</span>=2, <span class="attribute">teacherName</span>=徐老师), Teacher(<span class="attribute">id</span>=3, <span class="attribute">teacherName</span>=张老师)])</span><br><span class="line">Grade(<span class="attribute">id</span>=1, <span class="attribute">gradeName</span>=计算机科学与技术, teachers=[Teacher(<span class="attribute">id</span>=4, <span class="attribute">teacherName</span>=李老师)])</span><br><span class="line">Grade(<span class="attribute">id</span>=3, <span class="attribute">gradeName</span>=信息安全, teachers=[Teacher(<span class="attribute">id</span>=5, <span class="attribute">teacherName</span>=王老师), Teacher(<span class="attribute">id</span>=6, <span class="attribute">teacherName</span>=马老师)])</span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>&emsp;  </p>
<hr>
<h2 id="多对多"><a href="#多对多" class="headerlink" title="多对多"></a>多对多</h2><p>多对多其实本质就是一对多，相关的配置与一对多一样。</p>
<p>&emsp;  </p>
<p>&emsp;  </p>
<hr>
<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p>在上述示例的映射文件中，都是先使用<code>&lt;/resultMap&gt;</code>封装好表与JavaBean之间的映射，再在<code>&lt;association&gt;</code>和<code>&lt;collection&gt;</code>中使用resultMap属性指定即可。这样配置代码更加整洁。</p>
<p>也可以在<code>&lt;association&gt;</code>和<code>&lt;collection&gt;</code>中配置映射关系，如一对一中的studentMap可改为：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;sid&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;studentName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_name&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;association property=&quot;card&quot; resultMap=&quot;cardMap&quot; /&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;card&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;cid&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;idNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id_number&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><strong>其中，替代resultMap属性，通过javaType指定封装的类型</strong>，对于<code>&lt;collection&gt;</code>，则是使用ofType属性。</p>
<h1 id="Mybatis延迟加载"><a href="#Mybatis延迟加载" class="headerlink" title="Mybatis延迟加载"></a>Mybatis延迟加载</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p><strong>在多表查询的一对多中，在查询“一”时，有时并不需要将“多”也全部查询出来，<span style="color:red">什么时候需要用到，什么时候再查询</span>才更符合实际要求，不用造成不必要的系统开销</strong>。</p>
<p>在四种表关系中：<strong>一对<span style="color:red">多</span>、多对<span style="color:red">多</span>，通常情况下都是采用延迟加载</strong>；而<strong>一对<span style="color:red">一</span>（跟多对<span style="color:red">一</span>），通常情况下“一”都不可省略，所以一般都是采用立即加载</strong>（也有使用延迟加载的情况）。</p>
<p>Mybatis中可通过<strong>修改配置信息</strong>实现延迟加载。</p>
<p>&emsp;  </p>
<p>&emsp;  </p>
<hr>
<h2 id="实现延迟加载"><a href="#实现延迟加载" class="headerlink" title="实现延迟加载"></a>实现延迟加载</h2><p>实现延迟加载需要先设置mybatis的全局变量<code>lazyLoadingEnabled</code>为true（该值默认为false） ，表示开启延迟加载。</p>
<blockquote>
<p>若是3.4.1 及之前的版本，还需设置<code>aggressiveLazyLoading    </code>变量为false，其默认值是true。</p>
<p>该变量的官方解释：</p>
<p>开启时，任一方法的调用都会加载该对象的所有延迟加载属性。 否则，每个延迟加载属性会按需加载</p>
</blockquote>
<p>以上配置在主配置文件的settings标签中进行：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;setting name=&quot;aggressiveLazyLoading&quot; value=&quot;false&quot;/&gt;--&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>通过示例验证：</p>
<p>以学生（Student）和身份证（Card）为例，即一个学生对应一个身份证。</p>
<p>数据表如下：</p>
<p>card：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200916223746339.png" alt="image-20200916223746339" style="zoom:80%;" />

<p>student：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200916223847902.png" alt="image-20200916223847902" style="zoom:80%;" />



<p>Card类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Card</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String idNumber;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Card</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//被创建时输出内容。用于验证延迟加载</span></span><br><span class="line">        System.out.println(<span class="string">&quot;创建了一个Card对象...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Student类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Student</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String studentName;</span><br><span class="line">    <span class="keyword">private</span> Card card;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>两个JavaBean对应的Mapper：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CardMapper</span> </span>&#123; <span class="function">Card <span class="title">selectById</span><span class="params">(Integer id)</span></span>; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;  <span class="function">List&lt;Student&gt; <span class="title">selectAll</span><span class="params">()</span></span>; &#125;</span><br></pre></td></tr></table></figure>



<p>映射文件：</p>
<p>CardMapper.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mapper.CardMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;cardMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;card&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;idNumber&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id_number&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;cardMap&quot;</span>&gt;</span></span><br><span class="line">        select * from card</span><br><span class="line">        where id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>StudentMapper.xml：</p>
<ul>
<li><strong>selectAll中的sql语句不用使用连接查询语句</strong>。</li>
<li>在association标签中，<strong>select指定了查询Student中的Card时使用的查询方法</strong>，<strong>属性值是Mapper方法的全限定名</strong>。column属性指定了用于查询card所需的id，<strong>即<code>select * from student</code>的查询结果集中的<code>card_id</code>字段</strong>。</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.mapper.StudentMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;studentMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;student&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;studentName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;student_name&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;card&quot;</span> <span class="attr">column</span>=<span class="string">&quot;card_id&quot;</span> <span class="attr">select</span>=<span class="string">&quot;com.mapper.CardMapper.selectById&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;studentMap&quot;</span>&gt;</span></span><br><span class="line">        select * from student</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>测试方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testLazyLoad</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession())&#123;</span><br><span class="line">        StudentMapper mapper = session.getMapper(StudentMapper.class);</span><br><span class="line">        List&lt;Student&gt; students = mapper.selectAll();</span><br><span class="line"></span><br><span class="line">        Student student = students.get(<span class="number">0</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;输出student的name：&quot;</span> + student.getStudentName());</span><br><span class="line">        System.out.println(<span class="string">&quot;---------------------&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;输出student的card：&quot;</span> + student.getCard());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>输出是</strong>：</p>
<figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">输出student的name：张三</span><br><span class="line">---------------------</span><br><span class="line">创建了一个Card对象...</span><br><span class="line">输出student的card：Card(id=2, idNumber=222222)</span><br></pre></td></tr></table></figure>



<p>Card对象被创建时，会输出<code>创建了一个Card对象...</code>（见其类定义的构造器），<strong>通过输出可看出<code>mapper.selectAll()</code>执行时并没有创建Card对象。当调用了student的<code>getCard()</code>方法时才查询所需的Card对象</strong>。</p>
<blockquote>
<p>通过idea的debug不能看出延迟加载的效果。debug过程中查看students变量可发现所有的card都被创建完成。。。</p>
</blockquote>
<h1 id="Mybatis-的缓存机制"><a href="#Mybatis-的缓存机制" class="headerlink" title="Mybatis 的缓存机制"></a>Mybatis 的缓存机制</h1><p>Mybatis 使用到了两种缓存：<strong>本地缓存（一级缓存）和二级缓存</strong>。</p>
<h2 id="本地（一级）缓存"><a href="#本地（一级）缓存" class="headerlink" title="本地（一级）缓存"></a>本地（一级）缓存</h2><p><strong>每当一个新 session 被创建，MyBatis 就会创建一个与之相关联的本地缓存</strong>。<strong>任何在 session 执行过的查询结果都会被保存在本地缓存中，当再次执行参数相同的相同查询时，会返回缓存中的内容，而不用访问数据库</strong>。本地缓存将会在<strong>做出修改、事务提交或回滚，以及关闭 session 时清空，调用SqlSession的<code>void clearCache()</code>方法也可以情空缓存</strong>。</p>
<p>默认情况下，本地缓存数据的生命周期等同于整个 session 的周期。</p>
<p>简单示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCache</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">try</span>(SqlSession session = factory.openSession())&#123;</span><br><span class="line">        CardMapper mapper = session.getMapper(CardMapper.class);</span><br><span class="line">        Card card1 = mapper.selectById(<span class="number">1</span>);</span><br><span class="line">        Card card2 = mapper.selectById(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(card1==card2);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出true，第二次查询获取的是缓存在SqlSession中的card对象。</p>
<h2 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h2><blockquote>
<p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_36380516/article/details/73194758">https://blog.csdn.net/weixin_36380516/article/details/73194758</a></p>
<p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&amp;mid=2247483937&amp;idx=5&amp;sn=4a049d7461b67c4135183db09ec97bcb&amp;chksm=ebd74320dca0ca3691081597ac9db2447d51250d7aa819009231760977dd932b43a116fe44ba&amp;scene=21#wechat_redirect">https://mp.weixin.qq.com/s?__biz=MzI4Njg5MDA5NA==&amp;mid=2247483937&amp;idx=5&amp;sn=4a049d7461b67c4135183db09ec97bcb&amp;chksm=ebd74320dca0ca3691081597ac9db2447d51250d7aa819009231760977dd932b43a116fe44ba&amp;scene=21#wechat_redirect</a></p>
</blockquote>
<p><strong>二级缓存是mapper级别的缓存，二级缓存是跨SqlSession的，对于mapper级别的缓存不同的sqlsession是可以共享的</strong>。</p>
<p>每个Mapper有一个二级缓存区域（<strong>按namespace分</strong>），两个mapper的namespace如果相同，这两个mapper执行sql查询到数据将存在相同的二级缓存区域中。</p>
<p>如图：（图片来自第二个参考链接）</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/2BGWl1qPxib3W3VSvKKR7ialreweHt7HP0hQyg7IYibDxWTcDSMYCNlwXGW5bm48pLQJtKpN516H3Bzebzy9Qia3wg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/04/Java/%E5%9F%BA%E7%A1%80/%E5%BA%8F%E5%88%97%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="bxxiao">
      <meta itemprop="description" content="nothing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bxxiao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/Java/%E5%9F%BA%E7%A1%80/%E5%BA%8F%E5%88%97%E5%8C%96/" class="post-title-link" itemprop="url">Java-序列化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-04 17:43:46" itemprop="dateCreated datePublished" datetime="2020-11-04T17:43:46+08:00">2020-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-29 11:00:29" itemprop="dateModified" datetime="2021-03-29T11:00:29+08:00">2021-03-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="序列化的含义和意义"><a href="#序列化的含义和意义" class="headerlink" title="序列化的含义和意义"></a>序列化的含义和意义</h2><p><strong>序列化指将Java对象转换成字节序列</strong>， 这些字节序列可以保存在磁盘上， 或者进行网络传输。反序列化即指<strong>将序列化后的字节序列重新恢复成对象</strong>。序列化机制使得对象可以脱离程序的运行而独立存在。</p>
<p>一个Java对象要能序列化，<strong>必须实现一个特殊的<code>java.io.Serializable</code>接口</strong>，这个接口不包含任何方法或成员变量，只是一个标记。</p>
<p>&emsp;  </p>
<h2 id="序列化-反序列化"><a href="#序列化-反序列化" class="headerlink" title="序列化/反序列化"></a>序列化/反序列化</h2><p>序列化通过<strong>ObjectOutputStream</strong>来实现，它可以把一个Java对象写入字节流。</p>
<blockquote>
<p> <strong>当序列化一个对象到文件时， 按照 Java 的标准约定是给文件一个 .ser 扩展名</strong>.</p>
</blockquote>
<p>反序列化使用<strong>ObjectInputStream</strong>对象，它可以从字节流中读取一个Java对象。若反序列化时要使用<code>readObject()</code>读出多个对象，注意要与写入的顺序一致。</p>
<p>&emsp;  </p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SerializableDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        writeObj();</span><br><span class="line">        readObj();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">writeObj</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\person.ser&quot;</span>);</span><br><span class="line">        FileOutputStream out = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">        ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(out);</span><br><span class="line"></span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">&quot;王大锤&quot;</span>, <span class="number">25</span>);</span><br><span class="line">        objectOutputStream.writeObject(person);</span><br><span class="line">        System.out.println(<span class="string">&quot;写入的对象：&quot;</span> + person);</span><br><span class="line">        objectOutputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readObj</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\person.ser&quot;</span>);</span><br><span class="line">        FileInputStream in = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(in);</span><br><span class="line"></span><br><span class="line">        Person person = (Person)objectInputStream.readObject();</span><br><span class="line">        System.out.println(<span class="string">&quot;读取的对象：&quot;</span> + person);</span><br><span class="line">        objectInputStream.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Person</span><span class="params">(String name, <span class="keyword">int</span> age)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Person&#x27;s constructor&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...省略getter、setter、toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>程序输出：</p>
<figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Person&#x27;s constructor</span><br><span class="line">写入的对象：Person&#123;<span class="attr">name=&#x27;王大锤&#x27;,</span> <span class="attr">age=25&#125;</span></span><br><span class="line">读取的对象：Person&#123;<span class="attr">name=&#x27;王大锤&#x27;,</span> <span class="attr">age=25&#125;</span></span><br></pre></td></tr></table></figure>

<p>可以看到反序列化时，Person的构造器并没有执行。<strong>反序列化时，是由JVM直接构造出Java对象，不调用构造方法，构造方法内部的代码，在反序列化时将不被执行</strong>。</p>
<p>&emsp;  </p>
<p>看另一个示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        ByteArrayOutputStream byteOut = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(byteOut);</span><br><span class="line"></span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">        objectOutputStream.writeObject(person);</span><br><span class="line"></span><br><span class="line">        ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> ByteArrayInputStream(byteOut.toByteArray()));</span><br><span class="line">        Person readPerson = (Person)objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化得到的Person对象：&quot;</span> + readPerson);</span><br><span class="line">        System.out.println(<span class="string">&quot;反序列化得到的对象与原对象是否是同一对象：&quot;</span> + (person==readPerson));</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">反序列化得到的Person对象：Person&#123;<span class="attribute">name</span>=<span class="string">&#x27;张三&#x27;</span>, <span class="attribute">age</span>=20&#125;</span><br><span class="line">反序列化得到的对象与原对象是否是同一对象：<span class="literal">false</span></span><br></pre></td></tr></table></figure>

<p><strong>可见反序列化得到的对象与原来的person不是同一个对象，即反序列化得到的是一个新的对象</strong>。</p>
<p>&emsp;  </p>
<h2 id="serialVersionUID"><a href="#serialVersionUID" class="headerlink" title="serialVersionUID"></a>serialVersionUID</h2><p>每一个可序列化类都会带有一个<strong>long类型的<code>serialVersionUID</code>静态常量值</strong>，<strong>如果没有人为显式定义过<code>serialVersionUID</code>，那编译器会根据类的各种信息为它自动声明一个</strong>。</p>
<p><strong><font color="red">serialVersionUID是序列化前后类的唯一标识符，在反序列化时，jvm会把字节流中的序列号id和被序列化类的序列号id进行比较，只有两个id相同才能成功反序列化，否则抛出InvalidClassException异常</font></strong>。</p>
<p><strong>若是没有人为指定序列号id，则若是改变类时（如添加新的成员变量），默认的serialVersionUID值将会改变</strong>。</p>
<p>示例：</p>
<p>执行上述例子的<code>writeObj()</code>方法后，在Person类定义中添加一个birth成员变量：<code>private Date birth;</code></p>
<p>再执行<code>readObj()</code>进行反序列化，此时抛出异常：<strong>即字节流中的serialVersionUID与Person类的不同</strong>。</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Exception</span> <span class="keyword">in</span> thread &quot;main&quot; java.io.InvalidClassException: io.stream.<span class="keyword">serializable</span>.Person; <span class="keyword">local</span> <span class="keyword">class</span> incompatible: stream classdesc serialVersionUID = <span class="number">5578959987866231607</span>, <span class="keyword">local</span> <span class="keyword">class</span> serialVersionUID = <span class="number">-8466270221378179612</span></span><br></pre></td></tr></table></figure>



<p><strong>一般对于可序列化类，为了<code>serialVersionUID</code>的确定性，都要人为指定一个serialVersionUID值</strong>，可以使用idea的自动生成功能：<a href="https://www.jianshu.com/p/5dfa065b7890" target="_blank">IDEA自动生成serialVersionUID</a> 。</p>
<p>&emsp;  </p>
<h2 id="反序列化时的异常"><a href="#反序列化时的异常" class="headerlink" title="反序列化时的异常"></a>反序列化时的异常</h2><p><strong>在反序列化时<code>readObject()</code>可能抛出的异常有</strong>：</p>
<ul>
<li><code>ClassNotFoundException</code>：没有找到对应的Class；</li>
<li><code>InvalidClassException</code>：Class不匹配。</li>
</ul>
<p>抛出<code>ClassNotFoundException</code>的情况：一台电脑上的Java程序把一个Java对象序列化以后，通过网络传给另一台电脑上的另一个Java程序，但是这台电脑的Java程序并没有定义该类，所以无法反序列化，抛出该异常。</p>
<p>抛出<code>InvalidClassException</code>的情况：如serialVersionUID中的示例情况。</p>
<p>&emsp;  </p>
<h2 id="序列化的特殊情况"><a href="#序列化的特殊情况" class="headerlink" title="序列化的特殊情况"></a>序列化的特殊情况</h2><ul>
<li><strong>当要序列化的对象中包含其他引用类型变量的引用时，该变量对应的类也要实现Serializable接口</strong>。</li>
<li><strong>对同一个对象多次序列化，只有第一次序列化时JVM才会将对象转换为字节序列</strong>，之后的序列化只是直接输出一个序列化编号。且反序列化时多次使用<code>readObject()</code>读出的是同一个对象。</li>
</ul>
<p>&emsp;  </p>
<p>示例：</p>
<p>示例中的Person类同上。新增了一个ID类：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> stream.serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ID</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">5829455553074732547L</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//...省略getter、setter、toString</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>创建一个Person对象person和一个ID对象id，id中的Person指向person。将person和id序列化。再反序列，可看到<code>readId.getPerson()==readPerson</code>返回true。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\id.ser&quot;</span>);</span><br><span class="line">        FileOutputStream out = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">        ObjectOutputStream objectOutputStream = <span class="keyword">new</span> ObjectOutputStream(out);</span><br><span class="line"></span><br><span class="line">        ID id = <span class="keyword">new</span> ID();</span><br><span class="line">        Person person = <span class="keyword">new</span> Person(<span class="string">&quot;王大锤&quot;</span>, <span class="number">30</span>);</span><br><span class="line">        id.setNumber(<span class="number">1</span>);</span><br><span class="line">        id.setPerson(person);</span><br><span class="line">        objectOutputStream.writeObject(id);</span><br><span class="line">        objectOutputStream.writeObject(person);</span><br><span class="line"></span><br><span class="line">        FileInputStream in = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        ObjectInputStream objectInputStream = <span class="keyword">new</span> ObjectInputStream(in);</span><br><span class="line">        ID readId = (ID) objectInputStream.readObject();</span><br><span class="line">        Person readPerson = (Person) objectInputStream.readObject();</span><br><span class="line"></span><br><span class="line">        System.out.println(readId);</span><br><span class="line">        System.out.println(readPerson);</span><br><span class="line">        System.out.print(<span class="string">&quot;readId.getPerson()==readPerson:&quot;</span>);</span><br><span class="line">        System.out.print(readId.getPerson()==readPerson);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ul>
<li><strong>凡是被<code>static</code>修饰的字段是不会被序列化的</strong>。<ul>
<li>因为序列化保存的是<strong>对象的状态</strong>而非类的状态，所以会忽略<code>static</code>静态域。</li>
</ul>
</li>
<li><strong>凡是被<code>transient</code>修饰符修饰的字段也是不会被序列化的</strong>。<ul>
<li>transient修饰符的作用就是修饰不想被序列号的成员变量，一般是对于一些要保密的字段，如密码。对于被transient修饰的字段，在序列号时以null值填充（<strong>对于值类型，则使用0、false等默认值</strong>）。</li>
</ul>
</li>
</ul>
<p>&emsp;  </p>
<p>还有一个点是<strong>序列化的受控和加强</strong>，具体见第3个参考链接中最后一个小节。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><blockquote>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1298366845681698" target="_blank">廖雪峰Java教程-序列化</a> </p>
<p><a href="https://www.runoob.com/java/java-serialization.html" target="_blank">菜鸟教程</a> </p>
<p><a href="https://mp.weixin.qq.com/s?__biz=MzU4ODI1MjA3NQ==&mid=2247486849&idx=1&sn=c0a2555ba22921187a28547b66877af8&scene=21#wechat_redirect" target="_blank">序列化/反序列化，我忍你很久了，淦！</a> （程序羊）</p>
<p>《疯狂Java讲义 第4版》</p>
</blockquote>
<p>&emsp;  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/04/Java/%E5%9F%BA%E7%A1%80/byte%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="bxxiao">
      <meta itemprop="description" content="nothing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bxxiao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/04/Java/%E5%9F%BA%E7%A1%80/byte%E7%B1%BB%E5%9E%8B%E6%95%B0%E6%8D%AE/" class="post-title-link" itemprop="url">Java-关于byte类型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-04 17:38:36" itemprop="dateCreated datePublished" datetime="2020-11-04T17:38:36+08:00">2020-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-20 20:06:10" itemprop="dateModified" datetime="2021-03-20T20:06:10+08:00">2021-03-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="byte类型数据的范围"><a href="#byte类型数据的范围" class="headerlink" title="byte类型数据的范围"></a>byte类型数据的范围</h2><p>Java中一个byte类型数据的大小是一个字节，即8位，其范围是-128（1000_0000) ~ 127（0111_1111），二进制的最高位是符号位。</p>
<p>&emsp;  </p>
<h2 id="使用二进制形式赋值报错问题"><a href="#使用二进制形式赋值报错问题" class="headerlink" title="使用二进制形式赋值报错问题"></a>使用二进制形式赋值报错问题</h2><p>为byte类型变量赋值只能是-128~127范围内的数。</p>
<p>可以使用二进制形式赋值，如：<code>byte b = 0b10011;</code> （b=19）。<strong>且使用二进制赋值时，系统是以补码形式解析赋值的二进制数（如对于<code>0b10011</code>是19；对于<code>0b1111_1101</code>则是-3）</strong>。</p>
<p>若想使用二进制形式赋值一个负数，如：<code>byte b = 0b1001_0101;</code>，<strong>编译器会报类型不兼容的错误</strong>（int不能赋值给byte）。需要添加类型强制转换：<code>byte b = (byte) 0b1001_0101;</code> </p>
<p><strong>原因</strong>：（参考：<a href="https://www.cnblogs.com/ntyvictory/p/10650834.html" target="_blank">关于JAVA中Byte数据类型二进制赋值运算报错问题</a>）</p>
<p>byte共有8个比特位，其中最高位是符号位，给它赋值<code>0b1001_0101</code>时，<strong>最高位的1系统无法判断是实际数值还是符号位数值</strong>。添加强制类型转换<code>(byte)</code>，则系统可以知道1是符号位，此时可以被赋值；<strong>如果没有加强制类型转换，则系统认为<code>0b1001_0101</code>是一个int类型数据</strong>。int类型值无法赋值给byte变量，所以会报错。</p>
<p>&emsp;  </p>
<h2 id="以二进制形式输出byte"><a href="#以二进制形式输出byte" class="headerlink" title="以二进制形式输出byte"></a>以二进制形式输出byte</h2><p>以二进制形式输出byte可以通过包装类<code>Integer</code>的静态方法<code>toBinaryString(int i)</code>。</p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span> a = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">byte</span> b = <span class="number">12</span>;</span><br><span class="line">System.out.println(Integer.toBinaryString(a));</span><br><span class="line">System.out.println(Integer.toBinaryString(b));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">10</span></span><br><span class="line"><span class="comment">1100</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>但若是通过该方法输出一个负数的byte变量，会看到结果是输出了一个32位的二进制数，如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">byte</span> a = -<span class="number">2</span>;</span><br><span class="line">System.out.println(Integer.toBinaryString(a));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">11111111111111111111111111111110</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p><strong>这是因为byte值被赋值给<code>toBinaryString()</code>方法时被转换为int类型，即变成32位</strong>。对于上个例子的正数也一样被转换为int，只不过因为是正数，所以高位的0可以被省略，因而看起来是正常显示；<strong>但对于负数，高位的1不可以省略，所以以32位形式显示</strong>。</p>
<p>&emsp;  </p>
<p>针对负数的byte，可以截取结果的后8位，如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    <span class="keyword">byte</span> a = -<span class="number">2</span>;</span><br><span class="line">    String aBinary = Integer.toBinaryString(a);</span><br><span class="line">    aBinary = aBinary.substring(aBinary.length()-<span class="number">8</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;原二进制数：&quot;</span> + Integer.toBinaryString(a));</span><br><span class="line">    System.out.println(<span class="string">&quot;截取后的二进制数：&quot;</span> + aBinary);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">原二进制数：11111111111111111111111111111110</span></span><br><span class="line"><span class="comment">截取后的二进制数：11111110</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>

<p>&emsp;  </p>
<p>一个<code>Integer.toBinaryString()</code>处理byte值（对于正数，进行左补0；对于负数，截取后8位）的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        <span class="keyword">byte</span> a = <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">byte</span> b = -<span class="number">2</span>;</span><br><span class="line">        String aBinary = getBinaryByteStr(Integer.toBinaryString(a));</span><br><span class="line">        String bBinary = getBinaryByteStr(Integer.toBinaryString(b));</span><br><span class="line">        System.out.println(aBinary);</span><br><span class="line">        System.out.println(bBinary);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title">getBinaryIntWithZero</span><span class="params">(String binary)</span></span>&#123;</span><br><span class="line">        <span class="keyword">int</span> zeroCount = <span class="number">8</span> - binary.length();</span><br><span class="line">        String zeros = <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(zeroCount &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; zeroCount; i++) &#123;</span><br><span class="line">                zeros += <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> zeros + binary;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取8位二进制形式</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">getBinaryByteStr</span><span class="params">(String b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(b.length()&gt;<span class="number">8</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> b.substring(b.length()-<span class="number">8</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getBinaryIntWithZero(b);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/01/Java/%E5%9F%BA%E7%A1%80/Java%20IO%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="bxxiao">
      <meta itemprop="description" content="nothing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bxxiao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/01/Java/%E5%9F%BA%E7%A1%80/Java%20IO%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">Java IO总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-01 20:05:41" itemprop="dateCreated datePublished" datetime="2020-11-01T20:05:41+08:00">2020-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-20 20:49:59" itemprop="dateModified" datetime="2021-03-20T20:49:59+08:00">2021-03-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/" itemprop="url" rel="index"><span itemprop="name">Java</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Java/%E5%9F%BA%E7%A1%80/" itemprop="url" rel="index"><span itemprop="name">基础</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="File类"><a href="#File类" class="headerlink" title="File类"></a>File类</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>使用Java io流经常会用到File类，这里先对File类做个总结。</p>
<p>File类是Java.io包下<strong>代表与平台无关的文件和目录</strong>。可通过File对象新建、重命名、文件和目录，但<strong>不能通过File类访问文件内容本身，此操作需通过Java输入/输出流</strong>。</p>
<p><strong>File 类是对文件系统的映射，并不是硬盘上真实的文件， new File(“filePath”) 只是创建一个与硬盘中filePath指定的文件或目录（不管存不存在）对应的File对象</strong>，并不会在硬盘中创建文件，<strong>即一个File对象只是和硬盘里面的一个文件/目录相关联</strong>。如果所指向的文件不存在，调用<code>exist()</code>将返回false，可以通过<code>createNewFile()</code>方法在硬盘中创建对应文件或目录。</p>
<h2 id="创建File对象"><a href="#创建File对象" class="headerlink" title="创建File对象"></a>创建File对象</h2><p>创建File对象最常用的方法是使用构造器<code>new File(String pathName)</code>。pathName可以是绝对路径和相对路径。<strong>可以通过传入空字符串来创建一个当前路径对应的File对象：<code>File file = new File(&quot;&quot;);</code>，可以通过该方法来获取当前路径</strong>。</p>
<p>File类还包含其他构造器，具体查看官方文档或者File类源码。</p>
<h2 id="常用API"><a href="#常用API" class="headerlink" title="常用API"></a>常用API</h2><ul>
<li><p>File类的一些静态变量：</p>
<ul>
<li><p><strong><code>separator</code>（String）：代表当前系统对应的文件路径分隔符</strong> </p>
</li>
<li><p><strong><code>separatorChar</code>（char）</strong>：与系统有关的默认名称分隔符，为了方便，它被表示为一个字符串。此字符串只包含一个字符</p>
</li>
<li><p><strong>pathSeparatorChar（char）</strong>：与系统有关的路径分隔符，为了方便，它被表示为一个字符串</p>
</li>
<li><p><strong>pathSeparator（String）</strong>：此字符<strong>用于分隔以路径列表形式给定的文件序列中的文件名</strong>。在UNIX 系统上此字段为<code>:</code>；在 Windows系统上，它为 <code>;</code> </p>
</li>
</ul>
</li>
<li><p><strong>获取文件名</strong> </p>
<ul>
<li><code>String getName()</code>：返回<strong>文件</strong>名（最后一级子路径名）</li>
<li><code>String getPath()</code>：返回<strong>文件</strong>（若是目录则返回空字符串）对应的路径名</li>
<li><strong><code>String getAbsolutePath()</code>：返回绝对路径名</strong></li>
<li><code>String getParent()</code>：返回父目录名</li>
<li><code>boolean renameTo(File newName)</code>：修改文件名，成功返回true，否则false（文件不存在时返回false）</li>
</ul>
</li>
<li><p><strong>检测文件</strong> </p>
<ul>
<li>**<code>boolean exist()</code>**：是否存在</li>
<li><code>boolean canWrite()</code>：是否可写</li>
<li><code>boolean canRead()</code>：是否可读</li>
<li>**<code>boolean isFile()</code>**：是否是文件而不是目录</li>
<li>**<code>boolean isDirectory()</code>**：是否是目录而不是文件</li>
</ul>
</li>
<li><p><strong>获取文件信息</strong> </p>
<ul>
<li><code>long lastModified()</code>：返回最后修改的时间</li>
<li><strong><code>long length()</code>：返回文件长度</strong> </li>
</ul>
</li>
<li><p>文件操作：</p>
<ul>
<li><strong><code>boolean createNewFile()</code>：若对应文件不存在，创建对应的新文件。创建成功返回true，否则false</strong> </li>
<li><strong><code>boolean delete()</code>：删除对应文件</strong> </li>
<li><code>static File createTempFile(String prefix, String suffix)</code>：静态方法。根据前缀，后缀以及系统生成的随机数在默认的临时文件目录中创建一个空文件。prefix至少3字节，suffix可为null</li>
<li><code>static File createTempFile(String prefix, String suffix, File directory)</code>：在指定目录创建对应文件</li>
<li><code>void deleteOnExit()</code>：注册删除钩子。当虚拟机退出时，删除该文件</li>
</ul>
</li>
<li><p>目录操作：</p>
<ul>
<li><strong><code>boolean mkdir()</code>：创建File对象对应的目录</strong></li>
<li><strong><code>String[] list()</code>：返回File的所有子文件名和路径名的String数组</strong></li>
<li><code>File[] listFiles()</code>：返回File的所有子文件名和路径名的File数组</li>
<li><code>static File[] listRoots()</code>：返回系统所有的根路径的File数组</li>
</ul>
</li>
</ul>
<h2 id="文件过滤器"><a href="#文件过滤器" class="headerlink" title="文件过滤器"></a>文件过滤器</h2><p>在使用<code>list()</code>方法所有子文件名和路径名时，可以传入一个FilenameFilter（接口）参数，代表文件过滤器。该接口包含一个<code>boolean accept(File dir, String name)</code>方法，该方法将依次对指定File对象的子文件名和路径名进行迭代筛选，返回true表示符合要求。</p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    File f1 = <span class="keyword">new</span> File(<span class="string">&quot;E:\\temp&quot;</span>);</span><br><span class="line"></span><br><span class="line">    String[] list1 = f1.list();</span><br><span class="line">    System.out.println(<span class="string">&quot;该目录下的所有文件：&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (String s : list1) &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    System.out.println(<span class="string">&quot;过滤掉不以.txt结尾的子文件：&quot;</span>);</span><br><span class="line">    String[] list2 = f1.list(((dir, name) -&gt; name.endsWith(<span class="string">&quot;.txt&quot;</span>)));</span><br><span class="line">    <span class="keyword">for</span> (String s : list2) &#123;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">输出：</span><br><span class="line">该目录下的所有文件：</span><br><span class="line">a.txt</span><br><span class="line">a.txt.bak</span><br><span class="line">answers.txt</span><br><span class="line">b.txt</span><br><span class="line">b.txt.bak</span><br><span class="line">c.txt</span><br><span class="line">c.txt.bak</span><br><span class="line">expFile.txt</span><br><span class="line">过滤掉不以.txt结尾的子文件：</span><br><span class="line">a.txt</span><br><span class="line">answers.txt</span><br><span class="line">b.txt</span><br><span class="line">c.txt</span><br><span class="line">expFile.txt</span><br></pre></td></tr></table></figure>



<h1 id="Java-IO"><a href="#Java-IO" class="headerlink" title="Java IO"></a>Java IO</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>Java的IO流是实现输入/输出的基础， 它可以方便地实现数据的输入/输出操作， <strong>在Java中把不同的输入/输出源(键盘、文件、网络连接等) 抽象表述为“流”(stram) ， 通过流的方式允许Java程序使用相同的方式来访问不同的输入/输出源。流是一组有顺序的，有起点和终点的字节集合，是对数据传输的总称或抽象</strong>。即数据在两设备间的传输称为流，流的本质是数据传输，根据数据传输特性将流抽象为各种类，方便更直观的进行数据操作。</p>
<p><strong>Java io流的类层次图</strong>，其中的类皆来自java.io包（图片来自菜鸟教程）：</p>
<img src="https://www.runoob.com/wp-content/uploads/2013/12/iostream2xx.png"  />



<h2 id="流的分类"><a href="#流的分类" class="headerlink" title="流的分类"></a>流的分类</h2><h3 id="输入流与输出流"><a href="#输入流与输出流" class="headerlink" title="输入流与输出流"></a>输入流与输出流</h3><p>根据数据流向不同可分为输入流和输出流。</p>
<p>输入流：只能从中读取数据。<strong>输入流主要以InputStream、Reader抽象类作为基类</strong>。</p>
<p>输出流：只能向其中输入数据。<strong>输出流主要以OutputStream、Writer抽象类作为基类。</strong> </p>
<p><strong>这里的输入输出是从程序运行所在角度来划分的</strong>。</p>
<h3 id="字节流和字符流"><a href="#字节流和字符流" class="headerlink" title="字节流和字符流"></a>字节流和字符流</h3><p>根据处理数据类型的不同可分为字节流和字符流。</p>
<p>两者的区别：</p>
<ul>
<li><p><strong>传输数据的单位不同，字节流为8位的字节，字符流为16位的字符</strong>。</p>
</li>
<li><p>处理对象不同，<strong>字节流能处理所有类型的数据，而字符流只能处理字符类型的数据</strong>。</p>
</li>
<li><p>字节流在操作的时候本身是不会用到缓冲区的，是在文件本身直接操作；而<strong>字符流是通过缓冲区来操作文件的</strong>。</p>
</li>
<li><p>结论：优先选用字节流。首先因为硬盘上的所有文件都是以字节的形式进行传输或者保存的，包括图片等内容。但是字符只是在内存中才会形成的，所以在开发中，字节流使用广泛。</p>
</li>
</ul>
<p><strong>字节流以InputStream、OutputStream为基类。字符流以Reader、Writer为基类</strong>。</p>
<h3 id="节点流和处理流"><a href="#节点流和处理流" class="headerlink" title="节点流和处理流"></a>节点流和处理流</h3><ul>
<li><p>节点流：可以从/向一个特定的IO设备（磁盘，网络等）读/写数据的流。<strong>即程序直接连接到数据源</strong>。</p>
</li>
<li><p>处理流：<strong>对一个已存在的节点流进行连接和封装</strong>，封装后的流提供了更简便强大的数据读写功能。<strong>关闭流时，只关闭处理流即可，外层的流将会关闭内层的节点流</strong>。</p>
</li>
</ul>
<p>以下分为字节流和字符流对一些较常用的流进行总结。</p>
<h2 id="字节流"><a href="#字节流" class="headerlink" title="字节流"></a>字节流</h2><p>字节流基类是InputStream和OutputStream。<strong>InputStream类是所有字节输入流类的抽象父类。OutputStream类是所有字节输出流的抽象父类</strong>。InputStream和OutputStream基类提供了<code>read()</code>和<code>write()</code>系列方法进行读写，可以一次读/写一个字节，也可多个字节。在处理图片、音乐等非文本文件时，使用的是字节流。</p>
<p>InputStream的常见子类有：</p>
<ul>
<li><strong>FileInputStream</strong>：从文件中读取信息。</li>
<li><strong>ByteArrayInputStream</strong>： 字节数组输入流,</li>
<li><strong>ObjectInputStream</strong>：<strong>序列化时</strong>使用。一般和ObjectOutputStream一起使用</li>
<li><strong>FilterInputStream</strong>：过滤输入流，为基础的输入流提供一些额外的操作。</li>
</ul>
<p>OutputStream的常见子类有：</p>
<ul>
<li><strong>FileOutPutStream</strong>: 文件输出流对文件进行操作</li>
<li><strong>ByteArrayOutputStream</strong>: 字节数组输出流</li>
<li><strong>ObjectOutputStream</strong>: 序列化时使用。一般和OjbectInputStream一起使用</li>
<li><strong>FilterOutputStream</strong>:过滤输出流,为基础的输出流提供一些额外的操作。</li>
</ul>
<p>其中，<strong>创建OutputStream的子类时，若指定的文件在磁盘中不存在，则会创建对应的文件</strong>；对于InputStream，若文件不存在则抛出异常。</p>
<h3 id="FileInputStream"><a href="#FileInputStream" class="headerlink" title="FileInputStream"></a>FileInputStream</h3><p>FileInputStream、FileOutPutStream是针对文件的字节输入、输出流，可以<strong>通过指定文件的路径（String）或指定一个File对象来创建</strong>。</p>
<p>一个复制文件的简单示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CopyDemo</span> </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">      <span class="comment">//创建输入流，输出流，实现文件的复制</span></span><br><span class="line">      FileInputStream input = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;E:\\source.java&quot;</span>);</span><br><span class="line">      FileOutputStream output = <span class="keyword">new</span> FileOutputStream(<span class="string">&quot;E:\\copy.txt&quot;</span>);</span><br><span class="line">        </span><br><span class="line">      <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">32</span>];</span><br><span class="line">      <span class="keyword">int</span> hasRead = <span class="number">0</span>;</span><br><span class="line">      <span class="comment">//将读取的输入流数据写入输出流</span></span><br><span class="line">      <span class="keyword">while</span>((hasRead = input.read(buf)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          output.write(buf);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//输出复制后的文件</span></span><br><span class="line">      FileInputStream file = <span class="keyword">new</span> FileInputStream(<span class="string">&quot;E:\\copy.txt&quot;</span>);</span><br><span class="line">      <span class="keyword">while</span>((hasRead = file.read(buf)) &gt; <span class="number">0</span>) &#123;</span><br><span class="line">          System.out.print(<span class="keyword">new</span> String(buf, <span class="number">0</span> ,hasRead));</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//关闭资源</span></span><br><span class="line">      input.close();</span><br><span class="line">      output.close();</span><br><span class="line">      file.close();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ByteArrayInputStream"><a href="#ByteArrayInputStream" class="headerlink" title="ByteArrayInputStream"></a>ByteArrayInputStream</h3><p><strong><font color="red">流的来源或目的地并不一定是文件，也可以是内存中的一块空间</font></strong>，例如一个字节数组。<strong>ByteArrayInputStream、ByteArrayOutputStream就是将字节数组当作流的输入来源、输出目的地的类</strong>。</p>
<p>创建ByteArrayInputStream需要传入一个<code>byte[]</code>；创建ByteArrayOutputStream不是传入一个byte数组（<strong>ByteArrayOutputStream中封装了一个byte数组作为输出目的地，通过<code>toByteArray()</code>方法可以获取到该数组</strong>），而是指定ByteArrayOutputStream中byte数组的长度，也可以不指定，默认为32。</p>
<p>关于这两个流的应用场景（来自参考链接）：</p>
<p><strong>这两个类对于要创建临时性文件的程序以及网络数据的传输、数据压缩后的传输等可以提高运行的的效率，可以不用访问磁盘</strong>。同样有StringReader与StringWriter类以字符IO流的方式处理字符串。</p>
<p>两个流的用法比较简单，直接看示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ByteArrayOutputStreamDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        demo1();</span><br><span class="line">        demo2();</span><br><span class="line">        <span class="comment">//输出：</span></span><br><span class="line">        <span class="comment">//hello</span></span><br><span class="line">		<span class="comment">//hello, world!</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        ByteArrayOutputStream outputStream = <span class="keyword">new</span> ByteArrayOutputStream();</span><br><span class="line">        ByteArrayInputStream inputStream;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[]&#123;<span class="string">&#x27;h&#x27;</span>, <span class="string">&#x27;e&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;l&#x27;</span>, <span class="string">&#x27;o&#x27;</span>&#125;;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes1 = <span class="keyword">new</span> <span class="keyword">byte</span>[bytes.length];</span><br><span class="line"></span><br><span class="line">        outputStream.write(bytes);</span><br><span class="line">        inputStream = <span class="keyword">new</span> ByteArrayInputStream(outputStream.toByteArray());</span><br><span class="line">        inputStream.read(bytes1);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(bytes1));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String str = <span class="string">&quot;hello, world!&quot;</span>;</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = str.getBytes();</span><br><span class="line"></span><br><span class="line">        ByteArrayInputStream inputStream = <span class="keyword">new</span> ByteArrayInputStream(bytes);</span><br><span class="line">        <span class="keyword">int</span> hasRead = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((hasRead = inputStream.read())&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            System.out.print((<span class="keyword">char</span>)hasRead);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="ObjectInputStream"><a href="#ObjectInputStream" class="headerlink" title="ObjectInputStream"></a>ObjectInputStream</h3><p>ObjectInputStream和ObjectOutpuStream一般<strong>用于反序列化/序列化Java对象。被操作的对象对应的类必须实现Serializable接口</strong>。</p>
<ul>
<li>ObjectInputStream能够从输入流中读取Java对象，而不需要每次读取一个字节（反序列化）</li>
<li>ObjectOutputStream能够把对象写入到输出流中，而不需要每次写入一个字节（序列化）</li>
</ul>
<p><strong>创建ObjectInputStream和ObjectOutpuStream流需要传入一个节点流</strong>。</p>
<p>示例：</p>
<p><strong>一个要注意的点是：若是要从流中读取多个对象，则读取顺序要与写入的顺序一致</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Data w=<span class="keyword">new</span> Data(<span class="number">2</span>);</span><br><span class="line">    ObjectOutputStream out=<span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;E:\\worm.out&quot;</span>));</span><br><span class="line">    <span class="comment">//序列化对象，把对象写到worm.out里面</span></span><br><span class="line">    out.writeObject(<span class="string">&quot;Worm storage\n&quot;</span>);</span><br><span class="line">    <span class="comment">//序列化对象，把对象写到worm.out里面</span></span><br><span class="line">    out.writeObject(w);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从worm.out里面读取对象</span></span><br><span class="line">    ObjectInputStream in=<span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;E:\\worm.out&quot;</span>));</span><br><span class="line">    <span class="comment">//读取String对象</span></span><br><span class="line">    String s=(String)in.readObject();</span><br><span class="line">    <span class="comment">//读取Data对象</span></span><br><span class="line">    Data d=(Data)in.readObject();</span><br><span class="line">    System.out.println(s+<span class="string">&quot;Data = &quot;</span>+d);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> n;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Data</span><span class="params">(<span class="keyword">int</span> n)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.n=n;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.toString(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>ObjectInputStream和ObjectOutpuStream也提供了系列<code>readXxx()</code>和<code>writeXxx()</code>方法，用于写入/读取int、char或者字符串等类型的值。<strong>与读写对象一样，使用<code>readXxx()</code>读取数据时，要与写入时的顺序一致</strong>。如下示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo2</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    ObjectOutputStream out=<span class="keyword">new</span> ObjectOutputStream(<span class="keyword">new</span> FileOutputStream(<span class="string">&quot;E:\\test.out&quot;</span>));</span><br><span class="line">    ObjectInputStream in;</span><br><span class="line"></span><br><span class="line">    out.writeInt(<span class="number">2</span>);</span><br><span class="line">    out.writeChar(<span class="string">&#x27;H&#x27;</span>);</span><br><span class="line">    out.writeDouble(<span class="number">3.14</span>);</span><br><span class="line">    out.writeUTF(<span class="string">&quot;hello, world!&quot;</span>);<span class="comment">//写入字符串</span></span><br><span class="line">    out.writeObject(<span class="string">&quot;I am a String Object&quot;</span>);</span><br><span class="line"></span><br><span class="line">    out.close();</span><br><span class="line"></span><br><span class="line">    in =<span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;E:\\test.out&quot;</span>));</span><br><span class="line">    <span class="comment">//从输入流中读取数据的顺序要与写入时的顺序一致，否则抛出异常</span></span><br><span class="line">    <span class="keyword">int</span> val = in.readInt();</span><br><span class="line">    <span class="keyword">char</span> c = in.readChar();</span><br><span class="line">    <span class="keyword">double</span> val1 = in.readDouble();</span><br><span class="line">    String str = in.readUTF();</span><br><span class="line">    String strObj = (String) in.readObject();</span><br><span class="line"></span><br><span class="line">    System.out.println(val);</span><br><span class="line">    System.out.println(c);</span><br><span class="line">    System.out.println(val1);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    System.out.println(strObj);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="过滤io流"><a href="#过滤io流" class="headerlink" title="过滤io流"></a>过滤io流</h3><p>这里的过滤输入/输出流是指<strong>FilterInputStream和FilteOutputStream</strong>，他们的作用是<strong>为基础流提供一些额外的功能</strong>。</p>
<p><strong>常用子类</strong>：</p>
<ul>
<li><p>FilterInputStream常用子类</p>
<ul>
<li><strong>DataInputStream</strong></li>
<li><strong>BufferedInputStream</strong>：可以从缓冲区中读取数据，不用每次和文件的操作都进行实际操作了。</li>
</ul>
</li>
<li><p>FilterOutputStream常用子类</p>
<ul>
<li><strong>DataOutputStream</strong></li>
<li><strong>PrintStream</strong>:用于产生格式化的输出</li>
<li><strong>BufferedOutputStream</strong>:通过缓冲区像文件中写入数据。</li>
</ul>
</li>
</ul>
<h4 id="DataInputStream"><a href="#DataInputStream" class="headerlink" title="DataInputStream"></a>DataInputStream</h4><p>DataInputStream是数据字节输入流，用来装饰其他的输入流，<strong>允许应用程序以与机器无关方式从底层输入流中读取基本 Java 数据类型</strong>；DataOutputStream可以向文件中写入基本类型的数据，与DataInputStream配合使用。</p>
<p>创建DataInputStream和DataOutputStream都要基于一个输入/输出节点流。</p>
<p>示例：</p>
<p><strong>其中的<code>writeUTF()</code>方法，是以UTF-8编码写入指定字符串；相应的，<code>readUTF()</code>是以UTF-8编码读取字符串</strong>。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DataInOutStreamDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\data.txt&quot;</span>);</span><br><span class="line">        FileInputStream in;</span><br><span class="line">        FileOutputStream out;</span><br><span class="line">        DataInputStream dataIn;</span><br><span class="line">        DataOutputStream dataOut;</span><br><span class="line"></span><br><span class="line">        out = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">        dataOut = <span class="keyword">new</span> DataOutputStream(out);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//写入数据</span></span><br><span class="line">        dataOut.writeInt(<span class="number">2020</span>);</span><br><span class="line">        dataOut.writeBoolean(<span class="keyword">true</span>);</span><br><span class="line">        dataOut.writeChar(<span class="string">&#x27;H&#x27;</span>);</span><br><span class="line">        dataOut.writeUTF(<span class="string">&quot;hello,world&quot;</span>);</span><br><span class="line"></span><br><span class="line">        in = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        dataIn = <span class="keyword">new</span> DataInputStream(in);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读出数据（注意顺序）</span></span><br><span class="line">        <span class="keyword">int</span> readInt = dataIn.readInt();</span><br><span class="line">        <span class="keyword">boolean</span> readBoolean = dataIn.readBoolean();</span><br><span class="line">        <span class="keyword">char</span> readChar = dataIn.readChar();</span><br><span class="line">        String readStr = dataIn.readUTF();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;readInt = &quot;</span> + readInt);</span><br><span class="line">        System.out.println(<span class="string">&quot;readBoolean = &quot;</span> + readBoolean);</span><br><span class="line">        System.out.println(<span class="string">&quot;readChar = &quot;</span> + readChar);</span><br><span class="line">        System.out.println(<span class="string">&quot;readStr = &quot;</span> + readStr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="BufferedInputStream"><a href="#BufferedInputStream" class="headerlink" title="BufferedInputStream"></a>BufferedInputStream</h4><p>BufferedInputStream和BufferedOutputStream是两个缓冲流。对于没有缓冲的节点流，如FileInputStream，<strong>读取一个字节就要与磁盘交互一次，与磁盘的交互过于频繁，读取速度较低</strong>。</p>
<p>缓冲流中内置了一个缓冲区，</p>
<ul>
<li>对于BufferedOutputStream，<strong>使用<code>write()</code>方法写入数据时，写入的数据暂时被放在缓冲区，当调用<code>flush()</code>方法或者缓冲区满时才把数据写入输出流</strong>，从而减少了与磁盘的交互，提高效率。</li>
<li><strong>对于BufferedInputStream</strong>，在新建某输入流对应的BufferedInputStream后，<strong>当通过<code>read()</code>读取输入流的数据时，BufferedInputStream会将该输入流的数据分批的填入到缓冲区中。每当缓冲区中的数据被读完之后，输入流会再次填充数据缓冲区</strong>；如此反复，直到读完输入流数据位置。<strong><font color="red">从内存中读取数据的速度比从硬盘读取数据的速度快得多</font></strong>，且分批读取数据减少了与磁盘的交互，所以BufferedInputStream的效率比普通的输入节点流要高很多。</li>
</ul>
<p>一个复制图片的示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedInOutStreamDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        copyDemo();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">copyDemo</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File srcImg = <span class="keyword">new</span> File(<span class="string">&quot;E:\\xiaogailun.jpg&quot;</span>);</span><br><span class="line">        File copyImg = <span class="keyword">new</span> File(<span class="string">&quot;E:\\copy.jpg&quot;</span>);</span><br><span class="line">        FileInputStream in = <span class="keyword">new</span> FileInputStream(srcImg);</span><br><span class="line">        FileOutputStream out = <span class="keyword">new</span> FileOutputStream(copyImg);</span><br><span class="line">        BufferedInputStream bufIn = <span class="keyword">new</span> BufferedInputStream(in);</span><br><span class="line">        BufferedOutputStream bufOut = <span class="keyword">new</span> BufferedOutputStream(out);</span><br><span class="line">        <span class="keyword">byte</span>[] buf = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">64</span>];</span><br><span class="line">        <span class="keyword">int</span> hasRead = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> ((hasRead = bufIn.read(buf)) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            bufOut.write(buf, <span class="number">0</span>, hasRead);</span><br><span class="line">        &#125;</span><br><span class="line">        bufOut.flush();</span><br><span class="line"></span><br><span class="line">        bufIn.close();</span><br><span class="line">        bufOut.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>最后关闭流时，只需关闭外层流（处理流）即可，在外层流中会把包装的内层流（节点流）关闭</strong>。</p>
<h4 id="PrintStream"><a href="#PrintStream" class="headerlink" title="PrintStream"></a>PrintStream</h4><p>PrintStream 是用来装饰其它输出流，<strong>其中提供了系列<code>print()</code>方法，让其他输出流能够方便地输出各种形式的数据</strong>。另外，PrintStream提供了<strong>自动flush（写入数据时自动调用<code>flush()</code>）和字符集设置</strong>功能。</p>
<p>PrintStream的构造器：（<strong>其中的boolean值是指定是否自动flush；String是指定文件名或字符集名</strong>）</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20201028233241230.png" alt="image-20201028233241230"></p>
<p>简单示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PrintStreamDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\print.txt&quot;</span>);</span><br><span class="line">        PrintStream printStream = <span class="keyword">new</span> PrintStream(<span class="keyword">new</span> FileOutputStream(file));</span><br><span class="line"></span><br><span class="line">        printStream.println(<span class="string">&quot;hello,world!啊哈哈哈&quot;</span>);<span class="comment">//结尾加回车符</span></span><br><span class="line">        printStream.print(<span class="number">12138</span>);<span class="comment">//结尾无回车符</span></span><br><span class="line">        printStream.println();</span><br><span class="line">        printStream.print(<span class="string">&#x27;H&#x27;</span>);</span><br><span class="line">        </span><br><span class="line">        printStream.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>执行后的print.txt文件内容：</p>
<figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hello,world!啊哈哈哈</span><br><span class="line"><span class="number">12138</span></span><br><span class="line">H</span><br></pre></td></tr></table></figure>



<blockquote>
<p>更多关于PrintStream的内容推荐看（贼详细）：<a href="https://www.cnblogs.com/skywang12345/p/io_16.html" target="_blank">java io系列16之 PrintStream(打印输出流)详解</a> </p>
</blockquote>
<h2 id="2-4-字符流"><a href="#2-4-字符流" class="headerlink" title="2.4 字符流"></a>2.4 字符流</h2><p>字符流操作的数据单位是字符，在处理文本文件的时候更多使用的是字符流。</p>
<p>字符流的两个抽象基类是<code>Reader</code>和 <code>Writer</code>。其常见子类如下：</p>
<p>Reader类常见子类有：</p>
<ul>
<li><p><strong>InputStreamReader</strong>：字节流到字符流的桥接器。</p>
</li>
<li><p><strong>FileReader</strong>：文件字符输入流</p>
</li>
<li><p><strong>BufferedReader</strong>： 带缓冲区的字符输入流</p>
</li>
<li><p>StringReader：以字符串为源的字符输入流。（StringReader和StringWriter的使用较简单，不作总结）</p>
</li>
</ul>
<p>Writer类常见子类有：</p>
<ul>
<li><p><strong>OutputStreamWriter</strong>：字节流到字符流的桥接器。</p>
</li>
<li><p><strong>FileWriter</strong>:文件字符输出流</p>
</li>
<li><p><strong>BufferedWriter</strong>:带缓冲区的字符输出流</p>
</li>
<li><p>StringWriter：内部封装了一个StringBuffer，作为该输出流的源。提供了一个<code>getBuffer()</code>方法获取其中的StringBuffer。</p>
</li>
</ul>
<p><strong>要注意的点</strong>：</p>
<ul>
<li><strong>Writer抽象类中定义了一个<code>char[]</code>缓冲区</strong>（即Writer的系列子类都有一个缓冲区），该缓冲区的默认大小是1024，<strong>且不可自行指定大小</strong>。在执行写操作时，<strong>只有缓冲区满或调用<code>flush()</code>或调用<code>close()</code>方法时才会将内容写入磁盘中的文件</strong>。</li>
<li>创建Writer子类时，与OutputStream一样，<strong>若指定的文件在磁盘中不存在，则会创建对应的文件</strong>；对于Reader，若文件不存在则同样抛出异常。</li>
</ul>
<h3 id="InputStreamReader"><a href="#InputStreamReader" class="headerlink" title="InputStreamReader"></a>InputStreamReader</h3><p>InputStreamReader和OutputStreamWriter<strong>是字节流到字符流的桥接器，它们可以根据指定的字符集来进行读写内容，没有指定字符集时使用的是java虚拟机的字符集</strong>。</p>
<p>每次调用InputStreamReader的<code>read()</code>都将从底层读取一个或多个字节；每次调用OutputStreamWriter的<code>write()</code>方法都会将指定内容写入底层文件。为了提高效率，一般用BufferedReader和BufferedWriter来包装它们。</p>
<p><strong>创建InputStreamReader和OutputStreamWriter时传入的是字节流，它们会根据指定的字符集进行字节和字符间的转换</strong>。</p>
<p>InputStreamReader的构造器：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20201031105204555.png" alt="image-20201031105204555"></p>
<p>OutputStreamWriter的构造器：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20201031105018986.png" alt="image-20201031105018986"></p>
<h3 id="FileReader"><a href="#FileReader" class="headerlink" title="FileReader"></a>FileReader</h3><p>FileWriter和FileReader是InputStreamWriter和OutputStreamReader的子类，在FileWriter和FileReader中，字符集使用的是Java虚拟机的字符集。</p>
<p>FileWriter和FileReader的使用比较简单。它们都是节点流，可以直接传入一个FIle或文件路径来创建流。</p>
<p><strong>其中，创建FileWriter时可以传入一个boolean值，若为true，表示写入的内容是追加在原文件结尾之后，该值默认为false</strong>。对应的两个构造器：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">FileWriter(File file, <span class="keyword">boolean</span> append)</span><br><span class="line">FileWriter(String fileName, <span class="keyword">boolean</span> append)</span><br></pre></td></tr></table></figure>

<p>源码中关于append参数的解释：</p>
<figure class="highlight applescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">boolean</span> <span class="keyword">if</span> <span class="literal">true</span>, <span class="keyword">then</span> data will be written <span class="keyword">to</span> <span class="keyword">the</span> <span class="keyword">end</span> <span class="keyword">of</span> <span class="keyword">the</span> <span class="built_in">file</span> rather than <span class="keyword">the</span> <span class="keyword">beginning</span>.</span><br></pre></td></tr></table></figure>



<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FileReaderAndWriterDemo</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        write();</span><br><span class="line">        read();</span><br><span class="line">        System.out.println(<span class="string">&quot;\n\n---------------------------------------------------------------------\n&quot;</span>);</span><br><span class="line">        appendWrite();</span><br><span class="line">        read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\file.txt&quot;</span>);</span><br><span class="line">        FileWriter writer = <span class="keyword">new</span> FileWriter(file);</span><br><span class="line">        writer.write(<span class="string">&quot;hello,world!你好，世界！\n&quot;</span>);</span><br><span class="line">        writer.write(<span class="string">&quot;12345678999+*-\n&quot;</span>);</span><br><span class="line">        <span class="comment">//写入时会把int数值转换为对应的char</span></span><br><span class="line">        writer.write(<span class="number">67</span>);</span><br><span class="line">        writer.flush();<span class="comment">//可以省略，因为调用close时会调用flush</span></span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\file.txt&quot;</span>);</span><br><span class="line">        FileReader reader = <span class="keyword">new</span> FileReader(file);</span><br><span class="line">        <span class="keyword">char</span>[] cbuf = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">16</span>];</span><br><span class="line">        <span class="keyword">int</span> hasRead = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> ((hasRead=reader.read(cbuf)) &gt; <span class="number">0</span>)&#123;</span><br><span class="line">            System.out.print(<span class="keyword">new</span> String(cbuf, <span class="number">0</span>, hasRead));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        reader.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 在文件结尾写入内容</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">appendWrite</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\file.txt&quot;</span>);</span><br><span class="line">        FileWriter writer = <span class="keyword">new</span> FileWriter(file, <span class="keyword">true</span>);</span><br><span class="line">        writer.write(<span class="string">&quot;\n------以下内容并没有覆盖原文件内容------\n&quot;</span>);</span><br><span class="line">        writer.write(<span class="string">&quot;啊哈哈哈哈哈哈哈\n&quot;</span>);</span><br><span class="line">        writer.write(<span class="string">&quot;弹指间、数据库灰飞烟灭&quot;</span>);</span><br><span class="line">        writer.flush();</span><br><span class="line"></span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">hello,world!你好，世界！</span></span><br><span class="line"><span class="comment">12345678999+*-</span></span><br><span class="line"><span class="comment">C</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">---------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">hello,world!你好，世界！</span></span><br><span class="line"><span class="comment">12345678999+*-</span></span><br><span class="line"><span class="comment">C</span></span><br><span class="line"><span class="comment">------以下内容并没有覆盖原文件内容------</span></span><br><span class="line"><span class="comment">啊哈哈哈哈哈哈哈</span></span><br><span class="line"><span class="comment">弹指间、数据库灰飞烟灭</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h3 id="BufferedReader"><a href="#BufferedReader" class="headerlink" title="BufferedReader"></a>BufferedReader</h3><p>BufferedReader和BufferedWriter的功能是<strong>为其他字符输入/输出流提供缓存的功能</strong>。关于缓存功能的说明在上文的BufferedInputStream和BufferedOutputStream中已有描述，此处不再赘述。</p>
<p>一个问题是，上文中提到Writer抽象基类中已经有了一个缓冲区，为何还要使用BufferedWriter？</p>
<p>原因：<strong>Writer中定义的缓冲区大小是不能自定义的，且大小只有1024；BufferedWriter中的缓冲区默认大小是8192（1024的8倍），且大小可以自定义，可以指定更大的缓冲区，这个差别使得在操作大量数据时，BufferedWriter的效率将会比普通的字符流，如FileWriter要快得多（BufferedWriter与磁盘的交互次数更少）</strong>。</p>
<p>使用BufferedReader和BufferedWriter来处理文本时<strong>为了保证字符集的统一，内层流可以使用InputStreamReader和OutputStreamWriter，它们可以指定字符集</strong>。</p>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BufferedWriterReaderDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\file.txt&quot;</span>);</span><br><span class="line">        write(file);</span><br><span class="line">        readLine(file);</span><br><span class="line">        System.out.println(<span class="string">&quot;\n---------------------------\n&quot;</span>);</span><br><span class="line">        readAll(file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(File file)</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line"></span><br><span class="line">        FileOutputStream outStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">        BufferedWriter writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(outStream, 										StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        writer.write(<span class="string">&quot;hello,world!你好，世界！\n&quot;</span>);</span><br><span class="line">        writer.write(<span class="string">&quot;123456789&quot;</span>, <span class="number">0</span>, <span class="number">5</span>);<span class="comment">//写入前5个字符</span></span><br><span class="line">        writer.flush();</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用readLine()按行读取</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readLine</span><span class="params">(File file)</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        FileInputStream inStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inStream, StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        String line1 = reader.readLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;读取文件的第一行：&quot;</span> + line1);</span><br><span class="line">        String line2 = reader.readLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;读取文件的第二行：&quot;</span> + line2);</span><br><span class="line"></span><br><span class="line">        reader.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">readAll</span><span class="params">(File file)</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        FileInputStream inStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inStream, StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">char</span>[] cbuf = <span class="keyword">new</span> <span class="keyword">char</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line"></span><br><span class="line">        reader.read(cbuf);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(cbuf));</span><br><span class="line"></span><br><span class="line">        reader.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">输出：</span></span><br><span class="line"><span class="comment">读取文件的第一行：hello,world!你好，世界！</span></span><br><span class="line"><span class="comment">读取文件的第二行：12345</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">---------------------------</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">hello,world!你好，世界！</span></span><br><span class="line"><span class="comment">12345    </span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure>



<h2 id="移动输入流中的记录指针"><a href="#移动输入流中的记录指针" class="headerlink" title="移动输入流中的记录指针"></a>移动输入流中的记录指针</h2><p>在对输入流进行读操作（<code>read()</code>）时，流中的记录指针随之向后移动。InputStream和Reader中提高了下列方法来移动输入流中的记录指针，从而可以重复读取内容：</p>
<ul>
<li><code>mark(int readlimit)</code>：在此输入流中的当前位置做一个标记。<code>readlimit</code>参数<strong>告诉输入流允许在标记位置之后读取多个字节（注意是字节，不管是对于InputStream还是Reader）</strong>，若是<code>reset()</code>之后读取的字节数超过该参数，则抛出异常：<code>java.io.IOException: Mark invalid</code>。</li>
<li><code>markSupported()</code>：判断是否支持标记，即是否支持mark方法。</li>
<li><code>reset()</code>：将此流的记录指针重新定位到<strong>上一次</strong>在此输入流上调用 <code>mark()</code>方法时的位置。调用<code>reset()</code>之前必须有进行标记，否则抛出异常：<code>java.io.IOException: Stream not marked</code>。</li>
<li><code>skip(long n)</code>：跳过输入流中的 <strong><code>n</code>个字节或字符</strong>。</li>
</ul>
<p>示例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MarkDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        File file = <span class="keyword">new</span> File(<span class="string">&quot;E:\\file.txt&quot;</span>);</span><br><span class="line">        write(file);</span><br><span class="line">        read(file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">(File file)</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        FileOutputStream outStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">        BufferedWriter writer = <span class="keyword">new</span> BufferedWriter(<span class="keyword">new</span> OutputStreamWriter(outStream, StandardCharsets.UTF_8));</span><br><span class="line"></span><br><span class="line">        writer.write(<span class="string">&quot;hello,world!你好，世界！\n&quot;</span>);</span><br><span class="line">        writer.write(<span class="string">&quot;123456789&quot;</span>);</span><br><span class="line">        writer.flush();</span><br><span class="line">        writer.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(File file)</span><span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        FileInputStream inStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inStream, StandardCharsets.UTF_8));</span><br><span class="line">        <span class="keyword">char</span>[] chars = <span class="keyword">new</span> <span class="keyword">char</span>[<span class="number">128</span>];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//在开头进行mark。输出文件全部内容后进行reset</span></span><br><span class="line">        reader.mark(<span class="number">1024</span>);</span><br><span class="line">        reader.read(chars);</span><br><span class="line">        System.out.println(<span class="string">&quot;文件的全部内容是：&quot;</span>);</span><br><span class="line">        System.out.println(<span class="keyword">new</span> String(chars) + <span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        reader.reset();</span><br><span class="line"></span><br><span class="line">        reader.read(chars, <span class="number">0</span>, <span class="number">12</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;读取前12个字符：&quot;</span> + <span class="keyword">new</span> String(chars, <span class="number">0</span>, <span class="number">12</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;BufferedReader是否支持标记：&quot;</span> + reader.markSupported());</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;\n在当前位置进行mark()&quot;</span>);</span><br><span class="line">        reader.mark(<span class="number">32</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//跳过7个字符，即跳过了 你好，世界！\n</span></span><br><span class="line">        reader.skip(<span class="number">7</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;\n跳过7个字符，并读取整行：&quot;</span>);</span><br><span class="line">        String line = reader.readLine();</span><br><span class="line">        System.out.println(line);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//reset，再读取，读取的开始位置是上一次mark时的位置</span></span><br><span class="line">        System.out.println(<span class="string">&quot;\n--调用了reset()--\n&quot;</span>);</span><br><span class="line">        reader.reset();</span><br><span class="line">        String line2 = reader.readLine();</span><br><span class="line">        System.out.println(<span class="string">&quot;reset之后再读取：&quot;</span>);</span><br><span class="line">        System.out.println(line2);</span><br><span class="line"></span><br><span class="line">        reader.close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><blockquote>
<p>《疯狂Java讲义 第4版》</p>
<p><a href="https://blog.csdn.net/qq_36537546/article/details/88421680" target="_blank">关于：File.separator （ 详解 ）</a> </p>
<p><a href="https://zhuanlan.zhihu.com/p/99609337" target="_blank">一文带你看懂JAVA IO流 - 知乎</a> </p>
<p><a href="https://www.cnblogs.com/yixiu868/p/8144670.html" target="_blank">ByteArrayInputStream的作用，和BufferedOutputStream 的区别</a> </p>
<p><a href="https://blog.csdn.net/zhaoyanjun6/article/details/54894451" target="_blank">Java IO流学习总结三：缓冲流-BufferedInputStream、BufferedOutputStream</a> </p>
<p><a href="https://www.cnblogs.com/skywang12345/p/io_16.html" target="_blank">java io系列16之 PrintStream(打印输出流)详解</a> </p>
<p><a href="https://www.runoob.com/manual/jdk11api/java.base/java/io/OutputStreamWriter.html" target="_blank">OutputStreamWriter</a> <a href="https://www.runoob.com/manual/jdk11api/java.base/java/io/InputStreamReader.html" target="_blank">InputStreamReader</a> </p>
<p>另外推荐一个博主的Java io系列文章：<a href="https://www.cnblogs.com/skywang12345/p/io_01.html" target="_blank">java io系列01之 “目录”</a>  </p>
</blockquote>
<p><code>----------------------------------------------------------------</code> </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2020/11/01/MySQL/MySQL%E5%9F%BA%E7%A1%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="bxxiao">
      <meta itemprop="description" content="nothing">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="bxxiao">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/01/MySQL/MySQL%E5%9F%BA%E7%A1%80/" class="post-title-link" itemprop="url">MySQL基础</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-11-01 17:41:43" itemprop="dateCreated datePublished" datetime="2020-11-01T17:41:43+08:00">2020-11-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-03-20 21:00:53" itemprop="dateModified" datetime="2021-03-20T21:00:53+08:00">2021-03-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/MySQL/" itemprop="url" rel="index"><span itemprop="name">MySQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="DQL"><a href="#DQL" class="headerlink" title="DQL"></a>DQL</h2><blockquote>
<p>该笔记的实例代码中的数据库是<code>myemploees</code>。</p>
</blockquote>
<p>SQL语言的分类：</p>
<ul>
<li>DQL（Data Query Language）：数据查询语言。</li>
<li>DML（Data Management Language）：数据操作语言，修改表的语言，如插入、修改、删除语句。</li>
<li>DDL（Data Definition Language）：数据定义语言，如创建表、创建库。</li>
<li>TCL（Translation Control Language）：事物控制语言。</li>
</ul>
<h3 id="基础查询"><a href="#基础查询" class="headerlink" title="基础查询"></a>基础查询</h3><p><strong>tips：字符型、日期型的值用单引号括起来。</strong> </p>
<p>查询表中字段：<code>select queryList from tableName;</code> </p>
<p>查询所有字段：<code>select * from tableName;</code> </p>
<p>查询常量：<code>select 100;</code>或  <code>select &#39;string&#39;;</code> </p>
<p>查询表达式：<code>select 100*90;</code> </p>
<p>查询函数：<code>select version();</code> </p>
<p><code>-----------------------------------------------</code> </p>
<p>起别名（别名可用于字段名重复的情况）：</p>
<p><code>SELECT first_name AS 姓,last_name AS 名 FROM employees</code> </p>
<p>或</p>
<p><code>SELECT first_name 姓,last_name 名 FROM employees;</code> </p>
<p><code>SELECT salary AS &#39;out put&#39; FROM employees;</code></p>
<p><code>-----------------------------------------------</code> </p>
<p>去重：<code>SELECT DISTINCT job_id FROM employees</code> </p>
<p><code>-----------------------------------------------</code> </p>
<p>SQL中的+号：</p>
<p><strong>两个运算数都是数值型，作加法运算</strong>：<code>select 100+10;</code> </p>
<p><strong>有一个是字符串，则试图转化字符串为数字，若是转化失败则化为0</strong>：</p>
<p><code>select &#39;123&#39;+10;</code>  //133</p>
<p><code>select &#39;string&#39;+10;</code>  //0 + 10 = 10</p>
<p><code>SELECT 10 + &#39;10sdfef3s&#39; + 10;</code>若字符串的前端有数字，会进行转换，此处查询结果为10+10+10=30</p>
<p><strong>若有运算数为null，则结果为null</strong>：<code>select null+10;</code>  </p>
<p><strong>SQL中的+号没有字符串拼接功能，要拼接字符使用<code>concat()</code>函数</strong>：</p>
<p><code>SELECT CONCAT(last_name,first_name) AS 姓名 FROM employees</code> </p>
<p><code>-----------------------------------------------</code> </p>
<h3 id="条件查询"><a href="#条件查询" class="headerlink" title="条件查询"></a>条件查询</h3><p><strong>条件查询语句</strong>：<strong><code>select 查询列表 from tableName where condition;</code></strong> </p>
<p>其中，<strong><span style="color:red;">筛选条件顺序为：tableName -&gt; condition -&gt; 查询列表</span></strong>。</p>
<h4 id="按条件表达式筛选"><a href="#按条件表达式筛选" class="headerlink" title="按条件表达式筛选"></a>按条件表达式筛选</h4><p>包含这些运算符的表达式：<strong><code>&gt;  &lt;  =  !=  &lt;&gt;(建议)  &gt;=  &lt;=</code></strong>  </p>
<p>eg：</p>
<p><code>SELECT * FROM employees WHERE salary&gt;12000;</code> </p>
<p><code>SELECT last_name, first_name FROM employees WHERE department_id&lt;&gt;20;</code> </p>
<h4 id="按逻辑表达式筛选"><a href="#按逻辑表达式筛选" class="headerlink" title="按逻辑表达式筛选"></a>按逻辑表达式筛选</h4><p><strong><code>and or not</code>（建议）或<code>&amp;&amp;  || !</code></strong>  （<strong>连接条件表达式</strong>）</p>
<ul>
<li><p><code>SELECT last_name, salary, commission_pct </code> </p>
<p><code>FROM employees </code> </p>
<p><code>WHERE salary&gt;=10000 AND salary&lt;=20000;</code> </p>
</li>
<li><p><code>SELECT * FROM employees</code><br><code>WHERE NOT(department_id&gt;=90 AND department_id&lt;=110) OR salary&gt;15000;</code> </p>
</li>
</ul>
<h4 id="模糊查询"><a href="#模糊查询" class="headerlink" title="模糊查询"></a>模糊查询</h4><p><span style="font-size:20px;"><code>like</code></span>    </p>
<p><code>like</code>一般与通配符配合使用，如下：</p>
<ul>
<li><code>%</code>：表示任意多个字符，包括空字符。</li>
<li><code>_</code>：表示一个字符。</li>
</ul>
<p>eg：</p>
<p><code>SELECT * FROM employees WHERE last_name LIKE &#39;%a%&#39;;</code> </p>
<p><code>SELECT last_name,salary FROM employees WHERE last_name LIKE &#39;__t_b%&#39;;</code> </p>
<p>当需要查询包含通配符的字段，需要使用转义字符<code>\</code>，<strong>也可通过<code>escape</code>自定义转移字符</strong>。</p>
<p>eg：</p>
<p>查询last_name中第二个字符是_的字段：<strong><code>SELECT last_name FROM employees WHERE last_name LIKE &#39;_\_%&#39;;</code></strong> </p>
<p>或：<strong><code>SELECT last_name FROM employees WHERE last_name LIKE &#39;_$_%&#39; ESCAPE &#39;#39;;</code></strong>  </p>
<p><strong><span style="color:red;">like也可用于筛选int类型值</span></strong>，eg：</p>
<p><code>SELECT * FROM employees WHERE department_id LIKE &#39;1__&#39;;</code> </p>
<p><code>-------------------------------------------------------------------------------------</code> </p>
<p><span style="font-size:20px;"><strong><code>（not） between and</code></strong></span> （<strong>左右为闭区间</strong>） </p>
<p>代替<code>where value1&gt;= 100 and value1&lt;=120;</code>，<strong>代码更整洁</strong>。</p>
<p>eg：</p>
<p><code>SELECT * FROM employees WHERE employee_id BETWEEN 100 AND 120;</code> </p>
<p><code>-------------------------------------------------------------------------------------</code> </p>
<p><span style="font-size:20px;"><code>in </code></span>   </p>
<p>若字段的值等于in列表内的任一值即满足条件。其中，<strong><span style="color:red">in列表中的值必须为同一类型或可兼容</span></strong>（如’123’可等于123），<strong>且不支持通配符</strong>。</p>
<p>eg：</p>
<p><code>SELECT last_name,job_id FROM employees WHERE job_id IN(&#39;IT_PROG&#39;,&#39;AD_VP&#39;);</code> </p>
<p><code>-------------------------------------------------------------------------------------</code> </p>
<p><span style="font-size:20px;"><code> is （not） null</code> </span></p>
<p><strong>MySQL中的=，&lt;&gt;不能比较字段值跟null，只能用<code>is null</code>或<code>is not null</code></strong>。eg：</p>
<p><code>SELECT last_name,commission_pct FROM employees WHERE commission_pct IS NOT NULL;</code> </p>
<p><strong>MySQL中，有安全等与符号：<code>&lt;=&gt;</code> ，可用于普通值间的比较跟null值的比较</strong>。</p>
<p>eg：</p>
<p><code>SELECT last_name,commission_pct FROM employees WHERE commission_pct &lt;=&gt; NULL;</code> </p>
<p><code>-------------------------------------------------------------------------------------</code> </p>
<p><span style="font-size:20px;"><code>REGEXP</code></span> </p>
<p>使用正则表达式匹配。操作符见 <a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-regexp.html">菜鸟教程</a> 。</p>
<p>eg：<code>SELECT * FROM admin WHERE username REGEXP &#39;^谢&#39;</code>;</p>
<h3 id="排序查询"><a href="#排序查询" class="headerlink" title="排序查询"></a>排序查询</h3><p><strong>排序查询语法</strong>：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> queryList</span><br><span class="line"><span class="keyword">from</span> tableName</span><br><span class="line"><span class="keyword">where</span> condition</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> 排序列表名 <span class="keyword">asc</span>|<span class="keyword">desc</span>;  <span class="comment"># asc 升序；desc 降序，默认为asc</span></span><br></pre></td></tr></table></figure>

<p><strong>order by的排序列表可用别名、单个字段、多个字段、函数及表达式</strong>。</p>
<p>eg：</p>
<p>工资降序：</p>
<p><code>SELECT * FROM employees ORDER BY salary DESC;</code> </p>
<p>全部信息，年薪降序：</p>
<p><code>SELECT *,salary*12*(1+IFNULL(commission_pct,0)) yearSalary FROM employees ORDER BY yearSalary DESC;</code></p>
<p><strong>按多个字段排序</strong>：其中，<strong><span style="color:red">先将salary升序排序，再在每个salary相同的区间内，对这些记录的employee_id进行降序排序</span></strong>。</p>
<p><code>SELECT * FROM employees ORDER BY salary ASC,employee_id DESC;</code></p>
<hr>
<h3 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h3><p><strong>分组查询使用<code>group by</code>关键字，配合分组函数</strong>，<strong><span style="color:red">根据条件将记录分为若干组</span></strong>。语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 只有出现在group by后的列才能位于查询列表；下列的数字为语句执行顺序</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">colum</span>,groupFunction(<span class="keyword">colum</span>)   <span class="comment">#5</span></span><br><span class="line"><span class="keyword">FROM</span> tableName  <span class="comment">#1（把整个表拿出来）</span></span><br><span class="line">[<span class="keyword">WHERE</span> condition]  <span class="comment">#2</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> expr  <span class="comment">#3</span></span><br><span class="line">[<span class="keyword">HAVING</span> condition2]  <span class="comment">#4</span></span><br><span class="line">[<span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">colum</span>]  <span class="comment">#6</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>​        其中，<strong>若有where字句，则必须放在from后；且<span style="color:red">只有出现在group by后的列（字段）才能位于查询列表</span>，<span style="color:red">其中，数字为底层执行顺序</span></strong>。<strong>分组函数将根据<code>GROUP BY</code>的分组情况分别作用于每一组</strong>。</p>
<p>​        一般不在having子句使用别名，原因是Oracle等数据库不支持，不使用别名从而有更好的通用性。</p>
<p>例子：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#每个工种的最高工资</span></span><br><span class="line"><span class="keyword">SELECT</span> job_id,<span class="keyword">MAX</span>(salary)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">#每个位置上的部门个数</span></span><br><span class="line"><span class="keyword">SELECT</span> location_id,<span class="keyword">COUNT</span>(*) <span class="keyword">FROM</span> departments <span class="keyword">GROUP</span> <span class="keyword">BY</span> location_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加分组前的筛选</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>为分组查询添加筛选条件：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询邮箱中带有a的，每个部门的平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="keyword">AVG</span>(salary) 平均工资 </span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> email <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id;</span><br></pre></td></tr></table></figure>

<h4 id="分组后筛选-having子句"><a href="#分组后筛选-having子句" class="headerlink" title="分组后筛选(having子句)"></a>分组后筛选(<code>having</code>子句)</h4><p>​        上述的有筛选条件的分组查询都是<strong>分组前的筛选</strong>，即在原始表上进行筛选。</p>
<p>​        有时需要对分组的后的结果再添加筛选条件（<strong>分组后的筛选</strong>），<strong>即对分组查询的结果集再添加筛选条件</strong>，这时<strong>where子句不能满足</strong>需求，<strong>需使用<code>having</code>子句，放在<code>group by</code>后面</strong>。</p>
<p>如下：</p>
<ul>
<li>例1中，先按部门id分组，查询出部门id和每个部门的员工个数，再在该查询基础上，使用having子句添加员工个数&gt;2的筛选条件。</li>
<li>例2分析见注释。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#添加分组后的筛选</span></span><br><span class="line"><span class="comment">#1.查询员工个数大于2的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id,<span class="keyword">COUNT</span>(*)</span><br><span class="line"><span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.查询每个工种有奖金的员工的最高工资&gt;12000的 的工种编号和最高工资</span></span><br><span class="line"><span class="comment">#对题目解析：</span></span><br><span class="line"><span class="comment">#查询每个工种(group by)有奖金(comm.. is not null，分组前，即可在原始表上进行筛选)的员工的</span></span><br><span class="line"><span class="comment">#最高工资(max salary)&gt;12000(having,即分组后）的 的工种编号和最高工资</span></span><br><span class="line"><span class="keyword">SELECT</span> job_id,<span class="keyword">MAX</span>(salary) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MAX</span>(salary)&gt;<span class="number">12000</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.查询领导编号大于102的领导手下员工的最低工资&gt;5000 的领导编号和最低工资</span></span><br><span class="line"><span class="keyword">SELECT</span> manager_id,<span class="keyword">MIN</span>(salary) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> manager_id&gt;<span class="number">102</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> manager_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">MIN</span>(salary)&gt;<span class="number">5000</span>;</span><br><span class="line">                        </span><br></pre></td></tr></table></figure>

<p>分组条件也可以是函数或其他表达式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#按表达式或函数分组</span></span><br><span class="line"><span class="comment">#1.按员工姓名的长度分组，查询每一组的员工个数，并筛选出员工个数长度大于5的</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">LENGTH</span>(last_name) name_len,<span class="keyword">COUNT</span>(*) c <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> name_len</span><br><span class="line"><span class="keyword">HAVING</span> c&gt;<span class="number">5</span>;</span><br></pre></td></tr></table></figure>



<p><strong>按多个字段分组</strong>：<strong><span style="color:red;">按多个字段分组的最终结果其实就是：各分组字段值都一样的若干记录为一组</span>，分组函数再根据分组情况作用于每一组。若把分组的字段顺序改变，其结果将一样</strong>。。</p>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.查询每个部门中，每个工种的员工平均工资</span></span><br><span class="line"><span class="keyword">SELECT</span> department_id,job_id,<span class="keyword">AVG</span>(salary) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_id,job_id;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.按平均工资降序排序</span></span><br><span class="line"><span class="keyword">SELECT</span> job_id,department_id,<span class="keyword">AVG</span>(salary) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> job_id,department_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">AVG</span>(salary) <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure>



<p>​        综上，分组查询的筛选条件分为分组前筛选跟分组后筛选，如下表</p>
<table>
<thead>
<tr>
<th align="center"></th>
<th align="center">数据源</th>
<th align="center">位置</th>
<th align="center">关键字</th>
</tr>
</thead>
<tbody><tr>
<td align="center">分组前筛选</td>
<td align="center">原始表</td>
<td align="center">group by子句前</td>
<td align="center">where</td>
</tr>
<tr>
<td align="center">分组后筛选</td>
<td align="center">分组后的结果集</td>
<td align="center">group by子句后</td>
<td align="center">having</td>
</tr>
</tbody></table>
<p>其中，对分组函数做条件必须放在having子句中；能用分组前筛选则优先使用分组前筛选。</p>
<hr>
<h3 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h3><p>（sql99标准）</p>
<p>​        当查询对象来自多个表时，需要用到连接查询。当<strong>连接查询没有添加任何限制时，将会发送笛卡尔积现象</strong>，即若表1有12行，表2有4行，查询结果将会有12*4=48行。</p>
<p>​        <strong><span style="color:red;">多表查询的结果可按以下思路：先查询出笛卡尔积结果，再根据where子句的条件进行筛选</span></strong>。</p>
<p>​        <strong>连接查询按功能可分为</strong>：</p>
<ul>
<li>内连接 <strong>inner</strong>（连接类型关键字可省略） <ul>
<li>等值连接 </li>
<li>非等值连接</li>
<li>自连接</li>
</ul>
</li>
<li>外连接<ul>
<li>左外连接 <strong>left [outer]</strong> </li>
<li>右外连接 <strong>right [outer]</strong> </li>
<li>全外连接（MySQL不支持）</li>
</ul>
</li>
<li>交叉连接 <strong>cross</strong> </li>
</ul>
<p><strong>连接查询的语法</strong>：</p>
<p>其中，<strong>连接类型关键字见上面功能分类</strong>。<strong>连接条件与筛选条件分开，可读性更高</strong>。#num表示执行顺序。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> 查询列表 <span class="comment">#6</span></span><br><span class="line"><span class="keyword">from</span> table1 别名   <span class="comment">#1</span></span><br><span class="line">【连接类型关键字】<span class="keyword">join</span> table2 别名  <span class="comment">#2（笛卡尔积）</span></span><br><span class="line"><span class="keyword">on</span> 连接条件<span class="number">1</span></span><br><span class="line">【<span class="keyword">join</span> table3 别名 </span><br><span class="line"><span class="keyword">on</span> 连接条件<span class="number">2</span>】</span><br><span class="line">【<span class="keyword">where</span> 筛选条件】 <span class="comment">#3</span></span><br><span class="line">【<span class="keyword">group</span> <span class="keyword">by</span> 分组条件】 <span class="comment">#4</span></span><br><span class="line">【<span class="keyword">having</span> 分组后筛选】 <span class="comment">#5</span></span><br><span class="line">【<span class="keyword">order</span> <span class="keyword">by</span> ...】 <span class="comment">#7</span></span><br></pre></td></tr></table></figure>



<h4 id="内连接-等值连接"><a href="#内连接-等值连接" class="headerlink" title="内连接-等值连接"></a>内连接-等值连接</h4><p>其查询结果与sql92标准中的一致。inner关键字可以省略；<strong>多表（3以上）查询中，需保证前后两个表有连接条件</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1.查询员工名以及对应的部门</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,d.department_id </span><br><span class="line"><span class="keyword">FROM</span> employees e </span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.名字包含e的员工名和工种名</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> jobs j</span><br><span class="line"><span class="keyword">ON</span> e.<span class="string">`job_id`</span>=j.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> e.<span class="string">`last_name`</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%e%&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.部门员工个数大于3的部门名以及对应员工个数，按个数降序</span></span><br><span class="line"><span class="keyword">SELECT</span> department_name,<span class="keyword">COUNT</span>(*) </span><br><span class="line"><span class="keyword">FROM</span> departments d</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> employees e</span><br><span class="line"><span class="keyword">ON</span> d.<span class="string">`department_id`</span>=e.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> department_name</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(*)&gt;<span class="number">3</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(*) <span class="keyword">DESC</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#4.员工名，部门名，工种名，按部门名降序</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.<span class="string">`department_id`</span>=d.<span class="string">`department_id`</span></span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> e.<span class="string">`job_id`</span>=j.<span class="string">`job_id`</span></span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> department_name;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="内连接-非等值连接"><a href="#内连接-非等值连接" class="headerlink" title="内连接-非等值连接"></a>内连接-非等值连接</h4><p><strong>非等值连接与等值连接的不同之处在于：where子句使用<code>=</code>以外的条件运算符</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#查询员工的工资跟工资等级（employees表跟job_grades表）</span><br><span class="line">SELECT last_name,salary,grade_level</span><br><span class="line">FROM employees e</span><br><span class="line">JOIN job_grades g</span><br><span class="line">ON salary BETWEEN lowest_sal AND highest_sal;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#查询员工的工资等级及该等级的工资的员工个数</span><br><span class="line">SELECT grade_level,COUNT(*)</span><br><span class="line">FROM employees e</span><br><span class="line">JOIN job_grades g</span><br><span class="line">ON salary BETWEEN lowest_sal AND highest_sal</span><br><span class="line">GROUP BY grade_level;</span><br></pre></td></tr></table></figure>



<h4 id="内连接-自连接"><a href="#内连接-自连接" class="headerlink" title="内连接-自连接"></a>内连接-自连接</h4><p>自连接，顾名思义，即<strong>一个表连接它本身</strong>。适用的表的特点：<strong><span style="color:red;">表中有一个字段指向当前表的另一个字段</span></strong>。</p>
<p>查询员工名，对应的领导id跟领导名：（领导id指向员工名）</p>
<p><strong><span style="color:red;">此处为两个employees表起了两个别名</span></strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.<span class="string">`last_name`</span>,a.<span class="string">`manager_id`</span>,b.<span class="string">`last_name`</span> manager_name</span><br><span class="line"><span class="keyword">FROM</span> employees a,employees b</span><br><span class="line"><span class="keyword">WHERE</span> a.<span class="string">`manager_id`</span>=b.<span class="string">`employee_id`</span>;</span><br></pre></td></tr></table></figure>



<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> a.<span class="string">`last_name`</span>,a.<span class="string">`manager_id`</span>,b.<span class="string">`last_name`</span> manager_name</span><br><span class="line"><span class="keyword">FROM</span> employees a</span><br><span class="line"><span class="keyword">JOIN</span> employees b</span><br><span class="line"><span class="keyword">ON</span> a.<span class="string">`manager_id`</span>=b.<span class="string">`employee_id`</span>;	</span><br></pre></td></tr></table></figure>



<h4 id="外连接"><a href="#外连接" class="headerlink" title="外连接"></a>外连接</h4><p><strong>左/右外连接查询的特点</strong>：（<strong>注意主表、从表的概念</strong>）</p>
<ul>
<li>查询结果<strong>保留主表的所有记录</strong>，对于从表，若有与主表匹配额的，显示匹配的值；<strong>若没用匹配的，显示null</strong>。</li>
<li><strong>区分主表从表</strong>：<strong>对于左外连接，左主右从；对于右连接，右主左从</strong>。</li>
<li><strong>可用于查询两表除了交集部分的剩余不匹配的记录</strong>。</li>
</ul>
<p>​        </p>
<p>eg，例子只用了左外连接，右外连接同理，此处省略：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#1.查询所有女神，且若女神有男朋友，显示男朋友名</span><br><span class="line">SELECT b.&#96;id&#96;,b.name,bo.boyName</span><br><span class="line">FROM beauty b</span><br><span class="line">LEFT JOIN boys bo</span><br><span class="line">ON b.&#96;boyfriend_id&#96;&#x3D;bo.&#96;id&#96;;</span><br><span class="line"></span><br><span class="line">#2.查询莫得男朋友的女神</span><br><span class="line">#先查询出上面例子的中间表，再使用筛选条件筛出莫得男朋友的女神</span><br><span class="line">SELECT b.name </span><br><span class="line">FROM beauty b </span><br><span class="line">LEFT JOIN boys bo </span><br><span class="line">ON b.&#96;boyfriend_id&#96; &#x3D; bo.&#96;id&#96; </span><br><span class="line">WHERE bo.&#96;id&#96; IS NULL;</span><br></pre></td></tr></table></figure>

<p><strong>上述例题2的实现可见如下图解</strong>：</p>
<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200714170433903.png" alt="image-20200714170433903" style="zoom:67%;" />



<p>​        对于全外连接，MySQL不支持，<strong>理论上全外连接的查询结果是：对两个表的左外连接与右外连接的查询结果的并集</strong>。</p>
<h4 id="交叉连接"><a href="#交叉连接" class="headerlink" title="交叉连接"></a>交叉连接</h4><p>​        交叉连接其实就是笛卡尔乘积的sql99标准写法。。。</p>
<p>即以下两钟查询结果相同：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SELECT b.name,bo.boyName</span><br><span class="line">FROM beauty b</span><br><span class="line">CROSS JOIN boys bo;</span><br><span class="line"></span><br><span class="line">SELECT b.name,bo.boyName</span><br><span class="line">FROM beauty b,boys bo;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h3><p>​        <strong>出现在其他语句内部的select语句，成为子查询语句；相应的，内部嵌套其他select语句的查询成为外查询语句</strong>。子查询必须放在<code>()</code>内。</p>
<p>​        <strong>子查询按结果集的行列数不同可分为</strong>：</p>
<ul>
<li><strong>标量子查询</strong>（结果集只有一行一列，<strong>即一个单一值</strong>）</li>
<li><strong>列子查询</strong>（一列多行）</li>
<li><strong>行子查询</strong>（一行多列）</li>
<li><strong>表子查询</strong>（多行多列）</li>
</ul>
<p>​        <strong>子查询可出现的位置</strong>：</p>
<ul>
<li>select后：<strong>仅支持标量子查询</strong>。</li>
<li>from后：支持上述所有查询。</li>
<li>where或having后：支持标量子查询、列、行子查询。</li>
<li>exists后（相关子查询）：表子查询。</li>
</ul>
<p>以下按子查询出现位置展开。</p>
<h4 id="where-having后的子查询"><a href="#where-having后的子查询" class="headerlink" title="where/having后的子查询"></a><span style="font-size:20px;">where/having后的子查询</span></h4><p>​        where/having后的子查询支持标量、列、行子查询。其中</p>
<ul>
<li><p>若条件表达式是<code>&gt;  &lt;  =  &lt;=  &gt;= &lt;&gt;</code>，<strong>则必须使用标量子查询，因为这些运算符只能匹配一个操作数</strong>。</p>
</li>
<li><p>若<strong>使用列子查询，一般搭配<code>in</code>，<code>any/some</code>，<code>all</code>关键字</strong>。</p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>in/not in</td>
<td>等于（或不等于）列表中的任一个</td>
</tr>
<tr>
<td>any/some（两者意义相同）</td>
<td>与列表中的任意一个比较满足条件，可用min、max代替</td>
</tr>
<tr>
<td>all</td>
<td>与列表中的所有值比较都满足条件</td>
</tr>
</tbody></table>
</li>
<li><p><strong>子查询的执行优先度高于主查询</strong>，因为主查询需用到子查询作为判断条件。</p>
</li>
</ul>
<p>标量子查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">#1.工资比Abel高的员工</span><br><span class="line">SELECT last_name FROM employees</span><br><span class="line">WHERE salary&gt;(</span><br><span class="line">	#标量子查询</span><br><span class="line">	SELECT salary </span><br><span class="line">	FROM employees</span><br><span class="line">	WHERE last_name&#x3D;&#39;Abel&#39;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#2.返回job_id与141号员工相同,sa1a比143号员工多的员工姓名, job_id和工资</span><br><span class="line">SELECT last_name,job_id,salary </span><br><span class="line">FROM employees</span><br><span class="line">WHERE job_id&#x3D;(</span><br><span class="line">	SELECT job_id FROM employees</span><br><span class="line">	WHERE employee_id&#x3D;141</span><br><span class="line">)</span><br><span class="line">AND</span><br><span class="line">salary&gt;(</span><br><span class="line">	SELECT salary FROM employees</span><br><span class="line">	WHERE employee_id&#x3D;143</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#3.查询最低工资大于50号部门最低工资 的 部门id 和 其最低工资</span><br><span class="line"></span><br><span class="line">SELECT department_id,MIN(salary)</span><br><span class="line">FROM employees</span><br><span class="line">GROUP BY department_id</span><br><span class="line">HAVING MIN(salary)&gt;(</span><br><span class="line">	SELECT MIN(salary) FROM employees</span><br><span class="line">	WHERE department_id&#x3D;50</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>列子查询：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#1.返回1ocation_id是1400或1700的部门中的所有员工姓名</span><br><span class="line">SELECT last_name FROM employees</span><br><span class="line">WHERE department_id IN(</span><br><span class="line">	SELECT department_id FROM locations</span><br><span class="line">	WHERE location_id IN (1400,1700)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">#2.返回其它工种中比（job_id为IT_PROG工种任一工资 1）低的员工的（员工号、姓名、job_id以及sa1ary 2）</span><br><span class="line">SELECT employee_id,last_name,job_id,salary</span><br><span class="line">FROM employees</span><br><span class="line">WHERE salary&lt;ANY(</span><br><span class="line">	SELECT DISTINCT salary FROM employees</span><br><span class="line">	WHERE job_id&#x3D;&#39;IT_PROG&#39;</span><br><span class="line">) AND  job_id&lt;&gt;&#39;IT_PROG&#39;;</span><br></pre></td></tr></table></figure>

<p><strong>行子查询（一行多列或多行多列）</strong>：<strong>当筛选条件个数&gt;=2，且使用的判断符都一样，可以使用行子查询对多个字段同时判断</strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#查询员工编号最小，工资最高的员工信息</span><br><span class="line">SELECT * FROM employees</span><br><span class="line">WHERE (employee_id,salary)&#x3D;(</span><br><span class="line">	SELECT MIN(employee_id),MAX(salary)</span><br><span class="line">	FROM employees</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h4 id="select后的子查询"><a href="#select后的子查询" class="headerlink" title="select后的子查询"></a><span style="font-size:20px;">select后的子查询</span></h4><p>select后的子查询只支持标量子查询。<strong><font color="red">若子查询结果为空，则返回null值</font></strong>。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#每个部门的员工个数</span><br><span class="line">SELECT d.department_name,(</span><br><span class="line">	SELECT COUNT(*) </span><br><span class="line">	FROM employees e</span><br><span class="line">	WHERE d.&#96;department_id&#96; &#x3D;e.department_id</span><br><span class="line">) &#39;count&#39; FROM departments d;</span><br></pre></td></tr></table></figure>



<h4 id="from后的子查询"><a href="#from后的子查询" class="headerlink" title="from后的子查询"></a><span style="font-size:20px;">from后的子查询</span></h4><p>from后的子查询可支持任何类型的子查询。eg：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#查询每个部门的平均工资的工资等级</span><br><span class="line">#先查询每个部门的平均工资，再与工资等级表进行内连接查询</span><br><span class="line">SELECT ag_dep.*,grade_level</span><br><span class="line">FROM (</span><br><span class="line">	SELECT department_id,AVG(salary) ag</span><br><span class="line">	FROM employees</span><br><span class="line">	GROUP BY department_id</span><br><span class="line">) ag_dep</span><br><span class="line">INNER JOIN job_grades j</span><br><span class="line">ON ag_dep.ag BETWEEN j.&#96;lowest_sal&#96; AND j.&#96;highest_sal&#96;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="exists后的子查询"><a href="#exists后的子查询" class="headerlink" title="exists后的子查询"></a><span style="font-size:20px;">exists后的子查询</span></h4><p>**exists函数语法：<code>exists(查询语句)</code>**。</p>
<p><strong>当查询语句的结果集不为空，则返回1，否则返回0</strong>。</p>
<p>eg：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#有员工的部门名</span><br><span class="line">SELECT department_name </span><br><span class="line">FROM departments d</span><br><span class="line">WHERE EXISTS(</span><br><span class="line">	SELECT * </span><br><span class="line">	FROM employees e</span><br><span class="line">	WHERE e.&#96;department_id&#96;&#x3D;d.&#96;department_id&#96;</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"># 用列子查询</span><br><span class="line">SELECT department_name</span><br><span class="line">FROM departments d</span><br><span class="line">WHERE d.&#96;department_id&#96; </span><br><span class="line">IN(</span><br><span class="line">SELECT e.department_id</span><br><span class="line">FROM employees e</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="分页查询（Limit）"><a href="#分页查询（Limit）" class="headerlink" title="分页查询（Limit）"></a>分页查询（Limit）</h3><p>​        当要显示的查询结果过多，只需先显示部分记录时，可用<code>limit</code>进行分页查询。**<code>limit</code>语句要放在查询语句的最后**。</p>
<p>​        语法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">limit size #显示从第一条记录开始的size条记录</span><br><span class="line"></span><br><span class="line">-- 显示从第pos（索引从0开始）条开始的size条记录</span><br><span class="line">limit pos,size </span><br><span class="line">-- 或</span><br><span class="line">limit pos offset size</span><br></pre></td></tr></table></figure>



<p><strong>对于web应用中的分页查询，假如要显示第page页，每页有size个记录，则查询语句为：</strong> </p>
<p><strong><code>select * from tableName limit (page-1)*size,size;</code></strong> </p>
<h3 id="联合查询"><a href="#联合查询" class="headerlink" title="联合查询"></a>联合查询</h3><p>&emsp;&emsp;<strong>联合查询的作用是将多条查询语句的结果集合并为一个结果集</strong>。当要查询的<strong>信息来自多个表</strong>，且要查询的信息对应的<strong>字段在这些表中的类型一致</strong>，但这些表又<strong>没有直接关联</strong>，这时可使用联合查询。<strong>联合查询使用<code>UNION</code>关键字</strong>。</p>
<p>联合查询的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">查询语句1</span><br><span class="line">union</span><br><span class="line">查询语句2</span><br><span class="line">union</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>联合查询的特点：</p>
<ul>
<li><strong>多条查询语句的查询列数必须一致</strong>。</li>
<li>每一列的类型必须一致；为了查询结果的正确显示，字段顺序也要一致（<strong>不一致不会报错，但结果会错误显示</strong>）。</li>
<li><strong>union关键字默认去重（若是多个字段，则全部字段值相同才算相等），可使用<code>union all</code>显示重复项</strong>。</li>
<li><strong>查询结果集的字段名与第一条查询语句的查询字段对应</strong>。</li>
</ul>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">id</span>,cname,csex <span class="keyword">from</span> t_ca <span class="keyword">where</span> csex=<span class="string">&#x27;男&#x27;</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> t_id,tName,tGender <span class="keyword">from</span> t_ua <span class="keyword">where</span> tGender=<span class="string">&#x27;male&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h2 id="DML"><a href="#DML" class="headerlink" title="DML"></a>DML</h2><p>&emsp;&emsp;DML（Data Manage Language），数据操作语言，用于<strong>对表进行插入（insert）、删除（delete）、更新（update）操作</strong>。</p>
<h3 id="插入（insert）"><a href="#插入（insert）" class="headerlink" title="插入（insert）"></a>插入（insert）</h3><p>&emsp;&emsp;插入语句的语法有两种，如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name[(colum1, colum2, ...)]  <span class="comment">#该部分省略时默认所有字段</span></span><br><span class="line"><span class="keyword">VALUES</span>(value1, value2, ...)</span><br><span class="line">[, (value11, value22, ...)] ; <span class="comment">#可同时插入多个记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name</span><br><span class="line"><span class="keyword">SET</span> colum1=value1, colum2=value2, ...;</span><br><span class="line"></span><br><span class="line"><span class="comment">#3</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> table_name[(colum1, colum2, ...)]</span><br><span class="line"><span class="keyword">SELECT</span> ...;</span><br></pre></td></tr></table></figure>

<p>&emsp;&emsp;第一种方式可以同时插入多个记录，<strong>字段列表可省略，省略时默认插入表对应的所有字段</strong>；当只是要插入一条记录，且插入少数字段，可使用第二种方式，更为简便，<strong>但不支持插入多条记录</strong>。<strong><span style="color:red;">还可以通过子查询语句插入记录，此时子查询语句的查询列表要与要插入的表的字段对应</span></strong>。</p>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="literal">NULL</span>, <span class="string">&#x27;女朋友&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2000-02-26&#x27;</span>, <span class="string">&#x27;123456&#x27;</span>, <span class="literal">NULL</span>, <span class="number">2</span>); <span class="comment">#主键部分写null即可</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#插入多条记录</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty(<span class="keyword">NAME</span>, sex, borndate, phone) </span><br><span class="line"><span class="keyword">VALUES</span>(<span class="string">&#x27;女朋友&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2000-02-26&#x27;</span>, <span class="string">&#x27;4546984&#x27;</span>),</span><br><span class="line">(<span class="string">&#x27;迪丽热巴&#x27;</span>, <span class="string">&#x27;女&#x27;</span>, <span class="string">&#x27;2020-02-26&#x27;</span>, <span class="string">&#x27;549884&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#使用第二种语法</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> beauty </span><br><span class="line"><span class="keyword">set</span> <span class="keyword">name</span>=<span class="string">&#x27;ggggg&#x27;</span>, borndate=<span class="string">&#x27;1998-02-25&#x27;</span>, phone=<span class="string">&#x27;8582321&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>通过子查询插入值。eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> beauty(<span class="keyword">id</span>,<span class="keyword">name</span>,phone)</span><br><span class="line"><span class="keyword">select</span> <span class="number">26</span>,<span class="string">&#x27;宋茜&#x27;</span>,<span class="string">&#x27;856132123&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="更新（update）"><a href="#更新（update）" class="headerlink" title="更新（update）"></a>更新（update）</h3><p>​        更新表的SQL语句语法：<strong>其中，更新多表记录就是先将多个表连接起来，再对连接后的结果集进行更改。更改操作将作用到原表</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#更新单表记录</span></span><br><span class="line"><span class="keyword">UPDATE</span> table_name</span><br><span class="line"><span class="keyword">SET</span> colum1=new_value1, colum2=new_value2, ...</span><br><span class="line"><span class="keyword">WHERE</span> condition; <span class="comment">#若不加筛选条件，会对字段对应的所有记录修改</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#更新多表记录(sql99标准)</span></span><br><span class="line"><span class="keyword">UPDATE</span> table_name1 [<span class="keyword">alias</span>]</span><br><span class="line">JOIN_TYPE <span class="keyword">JOIN</span> table_name2 [<span class="keyword">alias</span>]</span><br><span class="line"><span class="keyword">ON</span> join_condition</span><br><span class="line"><span class="keyword">SET</span> colum1=new_value1, colum2=new_value2, ...</span><br><span class="line"><span class="keyword">WHERE</span> condition;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>eg:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">UPDATE</span> boys </span><br><span class="line"><span class="keyword">SET</span> boyname=<span class="string">&#x27;张飞&#x27;</span> </span><br><span class="line"><span class="keyword">WHERE</span> boyname=<span class="string">&#x27;鹿晗&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#多表更新</span></span><br><span class="line"><span class="comment">#修改张无忌的女朋友的电话号码为114455。需要先将boys表跟beauty表进行内连接</span></span><br><span class="line"><span class="keyword">UPDATE</span> boys bo</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> beauty be</span><br><span class="line"><span class="keyword">ON</span> bo.<span class="string">`id`</span>=be.<span class="string">`boyfriend_id`</span></span><br><span class="line"><span class="keyword">SET</span> be.<span class="string">`phone`</span>=<span class="string">&#x27;114455&#x27;</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`boyName`</span>=<span class="string">&#x27;张无忌&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="删除（delete）"><a href="#删除（delete）" class="headerlink" title="删除（delete）"></a>删除（delete）</h3><p>​        删除语句会删除满足条件的所有记录。且删除语句也支持单表跟多表的删除，其语法如下：其中：</p>
<ul>
<li>多表删除中，<strong>若只是想删除其中一个表的记录，DELETE后的只写要删除的表的表名即可</strong>。总之，delete后写上要删除的记录对应的表。</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#单表</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> table_name</span><br><span class="line"><span class="keyword">WHERE</span> condition;  <span class="comment">#若不加筛选条件，该语句会删除整个表的记录</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#多表</span></span><br><span class="line"><span class="keyword">DELETE</span> alias1,alias2</span><br><span class="line"><span class="keyword">FROM</span> table1_name alias1</span><br><span class="line">[join_type] <span class="keyword">join</span> table2_name alias2</span><br><span class="line"><span class="keyword">ON</span> join_condition</span><br><span class="line"><span class="keyword">WHERE</span> condition;</span><br></pre></td></tr></table></figure>



<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">delete</span> <span class="keyword">from</span> beauty <span class="keyword">where</span> phone <span class="keyword">like</span> <span class="string">&#x27;%9&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#多表删除（该例子只删除beauty表）</span></span><br><span class="line"><span class="comment">#删除张无忌的女朋友的信息</span></span><br><span class="line"><span class="keyword">DELETE</span> be</span><br><span class="line"><span class="keyword">FROM</span> boys bo</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> beauty be</span><br><span class="line"><span class="keyword">ON</span> bo.<span class="string">`id`</span>=be.<span class="string">`boyfriend_id`</span></span><br><span class="line"><span class="keyword">WHERE</span> bo.<span class="string">`boyName`</span>=<span class="string">&#x27;张无忌&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>当要删除整个表的记录，可以使用<code>truncate</code>关键字，语法是<code>TRUNCATE [TABLE] table_name;</code>。</p>
<p>使用delete删除跟truncate删除的<strong>区别</strong>：</p>
<ul>
<li>truncate不能加<code>where</code>。</li>
<li>truncate的删除效率稍微高一点。</li>
<li>若表中有自增长列，<strong>使用delete删除后不会改变当前的自增长值</strong>；<strong>而使用truncate删除后自增长值变为1</strong>。</li>
<li><strong>truncate不能返回受影响的记录数，而delete可以</strong>。</li>
<li><strong style="color:red">在事务方面</strong>：<strong>delete是可以回滚的，而truncate不可回滚</strong>。</li>
</ul>
<blockquote>
<p>以下来自 <a target="_blank" rel="noopener" href="https://www.yiibai.com/mysql/truncate-table.html">MySQL TRUNCATE TABLE语句简介</a> </p>
</blockquote>
<p>如果使用 InnoDB表，MySQL将在删除数据之前检查表中是否有可用的外键约束。 以下是一些情况：</p>
<ul>
<li>如果表具有任何外键约束，则<code>TRUNCATE TABLE</code>语句会逐个删除行。如果外键约束具有<code>DELETE CASCADE</code>动作，则子表中的相应行也将被删除。</li>
<li>如果外键约束没有指定 DELETE CASCADE 动作，<strong>则<code>TRUNCATE TABLE</code>将逐个删除行，并且遇到由子表中的行引用的行时（即其他表的外键指向该表的字段），它将停止并发出错误</strong>。</li>
<li>如果表没有任何外键约束，则<code>TRUNCATE TABLE</code>语句将删除该表并重新创建一个具有相同结构的新表，这比使用<code>DELETE</code>语句特别是对于大表更快更有效。</li>
</ul>
<p>如果使用其他存储引擎，则 <code>TRUNCATE TABLE</code> 语句将删除并重新创建一个新表。</p>
<p>此外，<code>TRUNCATE TABLE</code>语句不使用<code>DELETE</code>语句，因此与表关联的<a target="_blank" rel="noopener" href="http://www.yiibai.com/mysql/triggers.html">DELETE触发器</a>将不被调用。</p>
<h2 id="DDL"><a href="#DDL" class="headerlink" title="DDL"></a>DDL</h2><p>​        数据定义语言（Data Define Language， DDL）用于对数据库、表进行创建、修改、删除操作。</p>
<h3 id="库的管理"><a href="#库的管理" class="headerlink" title="库的管理"></a>库的管理</h3><p>库的相关语法如下：<strong>其中，对于创建、删除库，若是库已存在或不存在会报错，可使用<code>IF (NOT) EXISTS</code>进行判断，使语句正确执行</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建库</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] database_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">#删除库</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] database_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改库</span></span><br><span class="line"><span class="comment">#修改库名（该语法似乎不用了）</span></span><br><span class="line"><span class="keyword">RENAME</span> <span class="keyword">DATABASE</span> database_name <span class="keyword">TO</span> new_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">#修改字符集</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">DATABASE</span> database_name <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> character_name;</span><br></pre></td></tr></table></figure>



<h3 id="表的管理"><a href="#表的管理" class="headerlink" title="表的管理"></a>表的管理</h3><h4 id="1-表的创建"><a href="#1-表的创建" class="headerlink" title="1.表的创建"></a>1.表的创建</h4><p>创建表的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> [<span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span>] table_name(</span><br><span class="line">	colum_name COLUM_TYPE [(<span class="keyword">length</span>) 约束],</span><br><span class="line">	colum_name COLUM_TYPE [(<span class="keyword">length</span>) 约束],</span><br><span class="line">    ...</span><br><span class="line">    colum_name COLUM_TYPE [(<span class="keyword">length</span>) 约束],</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<p>eg:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> book(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span>,</span><br><span class="line">	bname <span class="built_in">VARCHAR</span>(<span class="number">20</span>),</span><br><span class="line">	author <span class="built_in">VARCHAR</span>(<span class="number">10</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h4 id="2-表的修改"><a href="#2-表的修改" class="headerlink" title="2.表的修改"></a>2.表的修改</h4><p>表的修改有修改列名、修改列的类型或约束、添加新列、删除列以及修改修改表名。对应的语法为：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 修改表</span></span><br><span class="line">    <span class="comment">-- 修改表本身的选项</span></span><br><span class="line">        <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 表的选项（具体选项可见 <span class="number">5.</span>-）</span><br><span class="line">        eg: <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 <span class="keyword">ENGINE</span>=MYISAM;</span><br><span class="line">    <span class="comment">-- 对表进行重命名</span></span><br><span class="line">        <span class="keyword">RENAME</span> <span class="keyword">TABLE</span> 原表名 <span class="keyword">TO</span> 新表名</span><br><span class="line">        <span class="keyword">RENAME</span> <span class="keyword">TABLE</span> 原表名 <span class="keyword">TO</span> 库名.表名 （可将表移动到另一个数据库）</span><br><span class="line">        <span class="comment">-- RENAME可以交换两个表名</span></span><br><span class="line">    <span class="comment">-- 修改表的字段机构</span></span><br><span class="line">        <span class="keyword">ALTER</span> <span class="keyword">TABLE</span> 表名 操作名</span><br><span class="line">        <span class="comment">-- 操作名</span></span><br><span class="line">            <span class="keyword">ADD</span>[ <span class="keyword">COLUMN</span>] 字段定义       <span class="comment">-- 增加字段</span></span><br><span class="line">                <span class="keyword">AFTER</span> 字段名          <span class="comment">-- 表示增加在该字段名后面</span></span><br><span class="line">                <span class="keyword">FIRST</span>               <span class="comment">-- 表示增加在第一个</span></span><br><span class="line">            <span class="keyword">ADD</span> PRIMARY <span class="keyword">KEY</span>(字段名)   <span class="comment">-- 创建主键</span></span><br><span class="line">            <span class="keyword">ADD</span> <span class="keyword">UNIQUE</span> [索引名] (字段名)<span class="comment">-- 创建唯一索引</span></span><br><span class="line">            <span class="keyword">ADD</span> <span class="keyword">INDEX</span> [索引名] (字段名) <span class="comment">-- 创建普通索引</span></span><br><span class="line">            <span class="keyword">DROP</span>[ <span class="keyword">COLUMN</span>] 字段名      <span class="comment">-- 删除字段</span></span><br><span class="line">            <span class="keyword">MODIFY</span>[ <span class="keyword">COLUMN</span>] 字段名 字段属性     <span class="comment">-- 支持对字段属性进行修改，不能修改字段名(所有原有属性也需写上)</span></span><br><span class="line">            <span class="keyword">CHANGE</span>[ <span class="keyword">COLUMN</span>] 原字段名 新字段名 字段属性      <span class="comment">-- 支持对字段名修改</span></span><br><span class="line">            <span class="keyword">DROP</span> PRIMARY <span class="keyword">KEY</span>    <span class="comment">-- 删除主键(删除主键前需删除其AUTO_INCREMENT属性)</span></span><br><span class="line">            <span class="keyword">DROP</span> <span class="keyword">INDEX</span> 索引名 <span class="comment">-- 删除索引</span></span><br><span class="line">            <span class="keyword">DROP</span> <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> 外键    <span class="comment">-- 删除外键</span></span><br><span class="line">        <span class="comment">-- 删除约束</span></span><br><span class="line">        	<span class="comment"># 除了上面3个drop，删除一些列级约束可以通过modify</span></span><br><span class="line">        	<span class="keyword">MODIFY</span> [<span class="keyword">COLUMN</span>] 字段名 字段类型 [新的约束];  <span class="comment">-- 通过这种方法重新让字段没有约束越换成新的约束</span></span><br></pre></td></tr></table></figure>

<p>TIPS：**表的修改中不支持<code>if (not) exists</code>**。</p>
<p>对于自增的主键字段，在删除若干记录再重新插入数据时，会出现id值“断层”，可以通过以下sql语句修改自增值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER TABLE table_name AUTO_INCREMENT &#x3D; N;</span><br></pre></td></tr></table></figure>

<h4 id="3-表的删除"><a href="#3-表的删除" class="headerlink" title="3.表的删除"></a>3.表的删除</h4><p><code>DROP TABLE [IF EXISTS] table_name</code>.</p>
<p>在sql脚本文件中写表或库创建的语句时，可以先删除表或库再创建，如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">DATABASE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> database_name;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">DATABASE</span> database_name;</span><br></pre></td></tr></table></figure>



<h4 id="4-表的复制"><a href="#4-表的复制" class="headerlink" title="4.表的复制"></a>4.表的复制</h4><p>表的复制可分为：</p>
<ul>
<li><p><strong>通过<code>LIKE</code>关键字</strong>仅复制表的结构（<strong>复制全部字段，不包含数据</strong>）：<strong><code>CREATE TABLE copy_table_name LIKE exists_table;</code></strong> </p>
</li>
<li><p>复制表的结构（<strong>部分或全部字段</strong>）跟数据（<strong>部分或全部数据</strong>）</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> copy_table_name </span><br><span class="line"><span class="keyword">SELECT</span> 查询列表 <span class="keyword">FROM</span> exists_table</span><br><span class="line"><span class="keyword">WHERE</span> condition;</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>通过查询列表来选择要复制的字段（使用<code>select *</code>即实现复制全部字段）</strong>。</li>
<li>通过<code>where</code>来筛选要复制的数据。<strong>可以通过<code>where 0</code>来过滤掉全部的数据，即只复制部分或全部字段</strong>；也可以直接去掉where来复制所选字段对应的全部数据。</li>
</ul>
</li>
</ul>
<h4 id="5-表的选项-查看表结构"><a href="#5-表的选项-查看表结构" class="headerlink" title="5.表的选项/查看表结构"></a>5.表的选项/查看表结构</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">表选项</span><br><span class="line">    <span class="comment">-- 字符集</span></span><br><span class="line">        CHARSET = charset_name</span><br><span class="line">        如果表没有设定，则使用数据库字符集</span><br><span class="line">    <span class="comment">-- 存储引擎</span></span><br><span class="line">        ENGINE = engine_name</span><br><span class="line">        表在管理数据时采用的不同的数据结构，结构不同会导致处理方式、提供的特性操作等不同</span><br><span class="line">        常见的引擎：InnoDB MyISAM Memory/Heap BDB <span class="keyword">Merge</span> Example CSV MaxDB <span class="keyword">Archive</span></span><br><span class="line">        不同的引擎在保存表的结构和数据时采用不同的方式</span><br><span class="line">        MyISAM表文件含义：.frm表定义，.MYD表数据，.MYI表索引</span><br><span class="line">        <span class="keyword">InnoDB</span>表文件含义：.frm表定义，表空间数据和日志文件</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">SHOW</span> <span class="keyword">ENGINES</span> <span class="comment">-- 显示存储引擎的状态信息</span></span><br><span class="line">        <span class="keyword">SHOW</span> <span class="keyword">ENGINE</span> 引擎名 &#123;<span class="keyword">LOGS</span>|<span class="keyword">STATUS</span>&#125; <span class="comment">-- 显示存储引擎的日志或状态信息</span></span><br><span class="line">    <span class="comment">-- 自增起始数</span></span><br><span class="line">        AUTO_INCREMENT = 行数</span><br><span class="line">    <span class="comment">-- 数据文件目录</span></span><br><span class="line">        <span class="keyword">DATA</span> <span class="keyword">DIRECTORY</span> = <span class="string">&#x27;目录&#x27;</span></span><br><span class="line">    <span class="comment">-- 索引文件目录</span></span><br><span class="line">        <span class="keyword">INDEX</span> <span class="keyword">DIRECTORY</span> = <span class="string">&#x27;目录&#x27;</span></span><br><span class="line">    <span class="comment">-- 表注释</span></span><br><span class="line">        <span class="keyword">COMMENT</span> = <span class="string">&#x27;string&#x27;</span></span><br><span class="line">    <span class="comment">-- 分区选项</span></span><br><span class="line">        <span class="keyword">PARTITION</span> <span class="keyword">BY</span> ... (详细见手册)</span><br><span class="line"><span class="comment">-- 查看表结构</span></span><br><span class="line">    <span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">TABLE</span> 表名 （信息更详细）</span><br><span class="line">    <span class="keyword">DESC</span> 表名 / <span class="keyword">DESCRIBE</span> 表名 / <span class="keyword">EXPLAIN</span> 表名 / <span class="keyword">SHOW</span> <span class="keyword">COLUMNS</span> <span class="keyword">FROM</span> 表名 [<span class="keyword">LIKE</span> <span class="string">&#x27;PATTERN&#x27;</span>]</span><br><span class="line">    <span class="keyword">SHOW</span> <span class="keyword">TABLE</span> <span class="keyword">STATUS</span> [<span class="keyword">FROM</span> db_name] [<span class="keyword">LIKE</span> <span class="string">&#x27;pattern&#x27;</span>]  </span><br></pre></td></tr></table></figure>



<hr>
<h2 id="MySQL数据类型"><a href="#MySQL数据类型" class="headerlink" title="MySQL数据类型"></a>MySQL数据类型</h2><p>MySQL的数据类型有：</p>
<ul>
<li>数值型：<ul>
<li>整型</li>
<li>小数：定点、浮点</li>
</ul>
</li>
<li>字符型：<ul>
<li>短文本：char、varchar</li>
<li>长文本：text、blob(较长的二进制数据)</li>
</ul>
</li>
<li>日期型</li>
</ul>
<h3 id="整型"><a href="#整型" class="headerlink" title="整型"></a>整型</h3><p>​        整形数据按字节大小可分为（括号内为字节数）：<strong>tinyint(1)、smallint(2)、mediumint(3)、int/integer(4)、bigint(8)</strong>。</p>
<p><strong>整形数据的特点</strong>：</p>
<ul>
<li><p>整形数据有有符号数和无符号数，默认是有符号数；要设置无符号数需在建表时添加 <strong><code>UNSIGNED</code>关键字</strong>。如：</p>
<p><code>create table test(t1 int, t2 int unsigned);</code>。</p>
</li>
<li><p>若插入的数值<strong>超出了类型值的范围</strong>，会报<code>out of range</code>异常，<strong>并停止插入操作</strong>。</p>
</li>
<li><p><strong><span style="color:red">整型值的长度指的是最多能显示出来有多少个数字</span></strong>。若无指定，每种类型的整型都有默认长度。建表时可以使用<code>ZEROFILL</code>关键字，当不足长度时用0进行左填充。eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> testss(</span><br><span class="line">	t1 <span class="built_in">INT</span>(<span class="number">7</span>) ZEROFILL</span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> testss <span class="keyword">VALUES</span>(<span class="number">55</span>);<span class="comment">#插入55，因为使用了zerofill关键字，会对55左填充0，即0000055.</span></span><br></pre></td></tr></table></figure>



</li>
</ul>
<h3 id="小数"><a href="#小数" class="headerlink" title="小数"></a>小数</h3><p>小数类型有浮点型和定点型：</p>
<ul>
<li>浮点型<ul>
<li>float(M, D)</li>
<li>double(M, D)</li>
</ul>
</li>
<li>定点型（<strong>高精度</strong>）：dec/decimal(M, D)</li>
</ul>
<p>​        其中（M, D)的形式在建表时使用，<strong>M指整个数值的长度（意义同整型的长度），即整数部分长度+小数部分长度；D指小数部分的长度</strong>。也可省略，省略时dec默认是（10，0），而float跟double会自适应插入的数。</p>
<p>FLOAT 和 DOUBLE 为浮点类型，<strong>DECIMAL 为高精度小数类型。CPU 原生支持浮点运算，但是不支持 DECIMAl 类型的计算，因此 DECIMAL 的计算比浮点类型需要更高的代价</strong>。</p>
<h3 id="字符型"><a href="#字符型" class="headerlink" title="字符型"></a>字符型</h3><p>字符型的分类：</p>
<ul>
<li><p><strong>短文本</strong></p>
<ul>
<li>char：<strong>建表时最大字符数可以省略，默认为1。该类型是固定长度的字符，即<span style="color:red">不管存入的数据是多少个字符，占用的空间都是指定的最大字符数</span></strong>。</li>
<li>varchar：<strong>建表时最大字符数<span style="color:red">不可以省略</span>。该类型是可变长度的字符，即<span style="color:red">占用的空间根据存入的数据自适应，多大就存多少空间</span>（存入数据&lt;=指定的最大字符数时）</strong>。</li>
<li>VARCHAR 这种变长类型能够<strong>节省空间</strong>，因为只需要存储必要的内容。<strong>但是在执行 UPDATE 时可能会使行变得比原来长，当超出一个页所能容纳的大小时，就要执行额外的操作</strong>。MyISAM 会将行拆成不同的片段存储，而 InnoDB 则需要分裂页来使行放进页内。</li>
<li>在进行存储和检索时，会保留 VARCHAR 末尾的空格，而会删除 CHAR 末尾的空格</li>
</ul>
</li>
<li><p><strong>长文本</strong></p>
<ul>
<li>text</li>
<li>blob（存放较大的二进制）</li>
</ul>
</li>
<li><p>其他</p>
<ul>
<li><p>binary、varbinary：类似char跟varchar。用于保存较短的二进制。</p>
</li>
<li><p>enum，用于保存枚举（只能保存一个数据），保存的值必须是枚举列表之一，枚举列表在建表时指定，eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> enumm(</span><br><span class="line">	colum1 ENUM(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> enumm <span class="keyword">VALUES</span>(<span class="string">&#x27;a&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> enumm <span class="keyword">VALUES</span>(<span class="string">&#x27;A&#x27;</span>);<span class="comment">#mysql不区分大小写，插入a、A效果一样</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> enumm <span class="keyword">VALUES</span>(<span class="string">&#x27;d&#x27;</span>);<span class="comment">#插入的值不是枚举列表之一，报错</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>set，用于保存集合（可以保存多个数据），和enum类似，但可以保存多个值。eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> sett(</span><br><span class="line">	s1 <span class="keyword">SET</span>(<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>,<span class="string">&#x27;d&#x27;</span>)</span><br><span class="line">	);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sett <span class="keyword">VALUES</span>(<span class="string">&#x27;a,b&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> sett <span class="keyword">VALUES</span>(<span class="string">&#x27;a,b,e&#x27;</span>);<span class="comment">#报错</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>enum、set值占用的存储空间随列表值个数的增加而增加。</p>
</li>
</ul>
</li>
</ul>
<h3 id="日期类型"><a href="#日期类型" class="headerlink" title="日期类型"></a>日期类型</h3><p><strong>日期类型如下表</strong>：</p>
<table>
<thead>
<tr>
<th>类型</th>
<th>字节</th>
<th>最小值</th>
<th>最大值</th>
</tr>
</thead>
<tbody><tr>
<td>DATE</td>
<td>4</td>
<td>1000-01-01（<strong>只有日期</strong>）</td>
<td>9999-12-31</td>
</tr>
<tr>
<td>DATETIME</td>
<td>8</td>
<td>1000-01-01 00:00:00（<strong>日期+时间</strong>）</td>
<td>9999-12-31 23:59:59</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>4</td>
<td>19700101080001（<strong>日期+时间</strong>）</td>
<td>2038 年的某个时刻</td>
</tr>
<tr>
<td>TIME</td>
<td>3</td>
<td>-838:59:59（<strong>只有时间</strong>）</td>
<td>838:59:59</td>
</tr>
<tr>
<td>YEAR</td>
<td>1</td>
<td>1901（<strong>只有年</strong>）</td>
<td>2155</td>
</tr>
</tbody></table>
<h4 id="timestamp和datetime"><a href="#timestamp和datetime" class="headerlink" title="timestamp和datetime"></a><span style="color:red">timestamp和datetime</span></h4><ul>
<li><p><strong>时间范围不一样</strong>，<strong>TIMESTAMP 要小很多</strong> ，2038 年到期。timestamp 和 UNIX 时间戳相同，保存从 1970 年 1 月 1 日午夜（格林威治时间）以来的秒数，<strong>使用 4 个字节，只能表示从 1970 年到 2038 年</strong>。</p>
</li>
<li><p><strong>对于TIMESTAMP，它<span style="color:red">把客户端插入的时间从当前时区转化为UTC（世界标准时间）进行存储。查询时，将其又转化为客户端当前时区（即根据系统变量<code>time_zone</code>的值）对应的时间进行返回</span>。而对于DATETIME，不做任何改变，原样输入和输出</strong>。</p>
</li>
<li><p>timestamp<strong>更能反应实际的日期</strong>。</p>
</li>
</ul>
<p>eg：（tips：<strong>中国位于东八时区</strong>，当前时间是2020-7-15 21:40分左右）</p>
<p>创建表并插入数据：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> timee(</span><br><span class="line">	t1 DATETIME,</span><br><span class="line">	t2 <span class="built_in">TIMESTAMP</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> timee <span class="keyword">VALUES</span>(<span class="keyword">NOW</span>(),<span class="keyword">NOW</span>());</span><br></pre></td></tr></table></figure>



<p>使用<code>select * from timee;</code>查询表，如下：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20210315154030410.png" alt="image-20210315154030410"></p>
<p>设置当前时区为东九区：<code>SET time_zone=&#39;+9:00&#39;;</code> ，查询：</p>
<p><img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20210315154114696.png" alt="image-20210315154114696"></p>
<p>可见，两次查询t1的两个值都不变，插入时的时间是什么，查询出的是什么。</p>
<p><strong>而t2查询出的值是保存的UTC时间转化为当前时区的时间</strong>。<strong>比如第一行的t2值，插入数据时是在东八区，该时刻的东九区比东八区快一个小时</strong>。</p>
<hr>
<h2 id="MySQL约束"><a href="#MySQL约束" class="headerlink" title="MySQL约束"></a>MySQL约束</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p>​        约束就是一种限制，用于限制表中的数据，<strong>使数据有更好的准确和可靠性</strong>。</p>
<p>MySQL中的常见约束：</p>
<table>
<thead>
<tr>
<th>约束类型</th>
<th>主键</th>
<th>外键</th>
<th>唯一</th>
<th>非空</th>
<th>自增</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>关键字</td>
<td>primary key</td>
<td>foreign key</td>
<td>unique</td>
<td>not null</td>
<td>auto_increment</td>
<td>default</td>
</tr>
<tr>
<td>含义</td>
<td>相当于unique+<br>not null，一般用于id</td>
<td>用于限制两个表的关系，<br/>即从表的某个字段指向主表的某一字段</td>
<td>唯一性、<br/><strong>可以为空</strong></td>
<td>不能为空</td>
<td>自增</td>
<td>指定字段的默认值</td>
</tr>
</tbody></table>
<p>​        添加约束可以在<strong>创建表时或修改表时</strong>。</p>
<p>​        <strong>约束又可分为列级约束和表级约束：除了外键，其他约束都支持列级约束；除了非空、默认以及自增，其他约束都支持表级约束</strong>。列级约束在创建表时<strong>在字段名+字段数据类型之后添加即可</strong>；表级约束在最底下声明，语法为：</p>
<p><code>[CONSTRAINT constraint_name] CONSTRAINT_TYPE(colum_name)</code> </p>
<p><strong>主键、唯一键可以使用列级跟表级两种语法进行声明</strong>。</p>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#列级约束</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> major(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	major_name <span class="built_in">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">UNIQUE</span> <span class="comment">#可以同时添加多个约束</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stuinfo(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> AUTO_INCREMENT,</span><br><span class="line">	stu_name <span class="built_in">VARCHAR</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>,</span><br><span class="line">	stu_number <span class="built_in">CHAR</span>(<span class="number">8</span>),</span><br><span class="line">	majorid <span class="built_in">INT</span> ,</span><br><span class="line">	<span class="keyword">CONSTRAINT</span> fk_stuinfo_major <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(majorid) <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>),</span><br><span class="line">	<span class="keyword">UNIQUE</span>(stu_number),</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h3 id="PRIMARY-KEY和UNIQUE"><a href="#PRIMARY-KEY和UNIQUE" class="headerlink" title="PRIMARY KEY和UNIQUE"></a><code>PRIMARY KEY</code>和<code>UNIQUE</code></h3><ul>
<li>两者都保证了唯一性，但主键不能为空。</li>
<li>一个表中只能有一个主键，但可以有多个unique。</li>
<li><strong><span style="color:red">unique约束的字段，是可以插入多个null值的</span></strong>。</li>
<li><strong>可以多个字段组合成一个主键或unique</strong>。**<span style="color:red;">该方式不推荐</span>**。</li>
</ul>
<p>关于上述组合的解释：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">test</span>(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> ,</span><br><span class="line">	sname <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	<span class="built_in">number</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	PRIMARY <span class="keyword">KEY</span>(<span class="keyword">id</span>, <span class="built_in">number</span>)  <span class="comment">#将id和number组合为一个主键</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">test</span> <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;as&#x27;</span>,<span class="string">&#x27;john&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">test</span> <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="string">&#x27;as&#x27;</span>,<span class="string">&#x27;john&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">test</span> <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="string">&#x27;as&#x27;</span>,<span class="string">&#x27;mike&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="keyword">test</span> <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="string">&#x27;as&#x27;</span>,<span class="string">&#x27;john&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">test</span>;</span><br></pre></td></tr></table></figure>

<p>前3条insert语句都能正确执行，第4条则报错。即对于组合的主键，**<span style="color:red">只有组合的几个字段的值都相等才算相同</span><strong>。</strong>组合unique同理**。</p>
<h3 id="关于外键"><a href="#关于外键" class="headerlink" title="关于外键"></a>关于外键</h3><p>外键的一些特点：</p>
<ul>
<li><p>外键是在从表设置的。</p>
</li>
<li><p><strong>从表的外键字段的数据类型与主表的关联列的类型要一致或可兼容</strong>。</p>
</li>
<li><p>主表的关联列必须是一个key，<strong>一般都是主键</strong>，也可以是unique键。eg:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> main_table;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> main_table(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> <span class="keyword">UNIQUE</span> <span class="comment">#unique键</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> forei_table;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> forei_table(</span><br><span class="line">	mainid <span class="built_in">INT</span>,</span><br><span class="line">	fname <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	<span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(mainid) <span class="keyword">REFERENCES</span> main_table(<span class="keyword">id</span>)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>外键字段的值可以为null</strong>，但<strong>要插入值时，在主表的关联字段必须有对应的数据存在，否则不可插入</strong>。</p>
</li>
<li><p><strong><span style="color:red">默认情况下，主表被关联字段的数据的更改或更新操作被拒绝</span></strong>。有以下几个操作可选（<strong>在从表设置外键时在语句的最后添加<code>ON DELETE</code>加上以下字段</strong>）：</p>
<ul>
<li><code>cascade</code>，<strong>级联操作</strong>。主表数据被更新（主键值更新），从表也被更新（外键值更新）。主表记录被删除，从表相关记录也被删除。</li>
<li><code>set null</code>，<strong>置null</strong>。<strong>主表数据被更新（主键值更新），从表的外键被设置为null。主表记录被删除，从表相关记录外键被设置成null</strong>。注意，要求该外键列没有not null属性约束。</li>
<li><code>restrict</code>，拒绝主表的外键关联字段的删除和更新。（<strong>默认</strong>）</li>
</ul>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> stu;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> stu(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">INT</span> PRIMARY <span class="keyword">KEY</span>,</span><br><span class="line">	stuname <span class="built_in">VARCHAR</span>(<span class="number">10</span>),</span><br><span class="line">	major_id <span class="built_in">INT</span>,</span><br><span class="line">	<span class="keyword">FOREIGN</span> <span class="keyword">KEY</span>(major_id) <span class="keyword">REFERENCES</span> major(<span class="keyword">id</span>) <span class="keyword">ON</span> <span class="keyword">DELETE</span> <span class="keyword">CASCADE</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>外键只被InnoDB存储引擎所支持。其他引擎是不支持的</strong>。</p>
</li>
</ul>
<h3 id="关于auto-increment"><a href="#关于auto-increment" class="headerlink" title="关于auto_increment"></a>关于auto_increment</h3><ul>
<li>对有auto_increment约束的字段插入值，比如插入10，那么下一个序号将会是11。</li>
<li><strong>auto_increment必须和key搭配，如主键，唯一键</strong>。</li>
<li>一个表只能有一个auto_increment。</li>
<li>auto_increment只能用于数值型字段。</li>
<li>标识列可以通过<code>SET auto_increment_increment=3;</code>设置步长，也可以通过手动插入值设置起始值。</li>
</ul>
<hr>
<h2 id="视图"><a href="#视图" class="headerlink" title="视图"></a>视图</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>（部分摘抄自<a target="_blank" rel="noopener" href="https://shockerli.net/post/1000-line-mysql-note/%EF%BC%89">https://shockerli.net/post/1000-line-mysql-note/）</a></p>
<p>​        视图是一个虚拟表，其内容由查询定义。同真实的表一样，<strong>视图包含一系列带有名称的列和行数据</strong>。但是，<strong>视图并不在数据库中以存储的数据值集形式存在</strong>。行和列数据来自由定义视图的查询所引用的表，<strong>并且在引用视图时动态生成</strong>。    </p>
<p>​        <strong>视图具有表结构文件，但不存在数据文件</strong>。对其中所引用的基础表来说，视图的作用类似于筛选。通过视图进行查询没有任何限制，通过它们进行数据修改时的限制也很少。视图是存储在数据库中的查询的sql语句，它主要出于两种原因：<strong>安全原因</strong>，视图可以隐藏一些数据，如：社会保险基金表，可以用视图只显示姓名，地址，而不显示社会保险号和工资数等，另一原因是可<strong>使复杂的查询易于理解和使用</strong>。</p>
<p>​        可简单的这样理解：<strong>视图存储的是sq逻辑，即sql语句，当要使用视图时根据该语句动态生成结果集</strong>。</p>
<h3 id="视图的创建和使用"><a href="#视图的创建和使用" class="headerlink" title="视图的创建和使用"></a>视图的创建和使用</h3><p>创建视图的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">查询语句; <span class="comment">-- 一般是涉及多个表的复杂的查询语句</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name; <span class="comment">-- 显示视图结构</span></span><br></pre></td></tr></table></figure>

<p>创建视图后，使用视图类似于使用表。</p>
<p>eg:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myv1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department_id=d.department_id</span><br><span class="line"><span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> j.job_id = e.job_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> myv1 <span class="keyword">WHERE</span> last_name <span class="keyword">LIKE</span> <span class="string">&#x27;%a%&#x27;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="视图的修改"><a href="#视图的修改" class="headerlink" title="视图的修改"></a>视图的修改</h3><p>两种方式：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1(如果视图不存在会创建；视图存在就代替)</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> view_name</span><br><span class="line"><span class="keyword">as</span></span><br><span class="line">查询语句;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> <span class="keyword">REPLACE</span> <span class="keyword">VIEW</span> myv1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,d.manager_id,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department_id=d.department_id</span><br><span class="line"><span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> j.job_id = e.job_id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> view_name</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line">查询语句;</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">VIEW</span> myv1</span><br><span class="line"><span class="keyword">AS</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,department_name,job_title</span><br><span class="line"><span class="keyword">FROM</span> employees e</span><br><span class="line"><span class="keyword">JOIN</span> departments d <span class="keyword">ON</span> e.department_id=d.department_id</span><br><span class="line"><span class="keyword">JOIN</span> jobs j <span class="keyword">ON</span> j.job_id = e.job_id;</span><br></pre></td></tr></table></figure>



<h3 id="视图的删除和查看"><a href="#视图的删除和查看" class="headerlink" title="视图的删除和查看"></a>视图的删除和查看</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#删除</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">VIEW</span> view1_name,view2_name...;</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看结构</span></span><br><span class="line">DESC view_name;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">VIEW</span> view_name;</span><br></pre></td></tr></table></figure>



<h3 id="视图更新"><a href="#视图更新" class="headerlink" title="视图更新"></a>视图更新</h3><p>​        <strong>视图的可更新性和视图中查询的定义有关系</strong>，<strong>以下类型的视图是不能更新的</strong></p>
<ul>
<li>包含以下关键字的sql语句：分组函数、distinct、group by、having、union或者uunion all</li>
<li>常量视图</li>
<li>Select中包含子查询</li>
<li>Join</li>
<li>from一个不能更新的视图</li>
<li>where子句的子查询引用了from子句中的表</li>
</ul>
<p><strong>一般情况下视图都是不可更新的</strong>。</p>
<p>可更新视图的简单示例：tips：<strong>更新会作用到原表</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">VIEW</span> myv3</span><br><span class="line"><span class="keyword">AS</span> </span><br><span class="line"><span class="keyword">SELECT</span> last_name, phone_number</span><br><span class="line"><span class="keyword">FROM</span> employees ;</span><br><span class="line"></span><br><span class="line"><span class="comment">#insert</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> myv3 <span class="keyword">VALUES</span>(<span class="string">&#x27;许褚&#x27;</span>,<span class="string">&#x27;888888&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#update</span></span><br><span class="line"><span class="keyword">UPDATE</span> myv3 <span class="keyword">SET</span> last_name=<span class="string">&#x27;典韦&#x27;</span> <span class="keyword">WHERE</span> last_name=<span class="string">&#x27;许褚&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#delete</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> myv3 <span class="keyword">WHERE</span> last_name=<span class="string">&#x27;典韦&#x27;</span>;</span><br></pre></td></tr></table></figure>



<p>对视图进行修改需要有权限。</p>
<h3 id="视图与表"><a href="#视图与表" class="headerlink" title="视图与表"></a>视图与表</h3><ul>
<li>两者创建的语法不同。</li>
<li>从占用存储空间方面：<strong>视图只是保存了sql语句，只占用了很小的空间；而表保存了数据，占用空间较大</strong>。</li>
<li>视图一般都不允许增删改查；表允许。</li>
</ul>
<hr>
<h2 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h2><p>MySQL变量的分类：</p>
<ul>
<li>系统变量<ul>
<li>全局变量</li>
<li>会话变量</li>
</ul>
</li>
<li>自定义变量<ul>
<li>用户变量</li>
<li>局部变量</li>
</ul>
</li>
</ul>
<h3 id="系统变量"><a href="#系统变量" class="headerlink" title="系统变量"></a>系统变量</h3><p>​        系统变量是由MySQL系统提供的，用于设置服务器的某些功能。<strong>分为全局（global）变量和会话（session）变量</strong>。两者主要区别是作用域不同，<strong>全局变量的作用域是所有会话（连接），<span style="color:red">但每次重启MySQL服务器都会重置</span>；而会话变量只针对当前会话有效</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--（对于会话变量，session可省略）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--查看所有全局/会话变量</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span>|<span class="keyword">SESSION</span> <span class="keyword">VARIABLES</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--添加筛选条件</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> condition;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看单个变量</span></span><br><span class="line"><span class="keyword">SELECT</span> @@<span class="keyword">global</span>|[<span class="keyword">session</span>].变量名</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改</span></span><br><span class="line"><span class="keyword">SET</span> <span class="keyword">GLOBAL</span>|<span class="keyword">SESSION</span> 变量名=new_value;</span><br><span class="line"><span class="keyword">SET</span> @@<span class="keyword">global</span>|[<span class="keyword">session</span>].变量名=new_value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%tx_is%&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @@global.autocommit;</span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">GLOBAL</span> <span class="keyword">VARIABLES</span> <span class="keyword">LIKE</span> <span class="string">&#x27;%char%&#x27;</span>;</span><br></pre></td></tr></table></figure>



<h3 id="自定义变量"><a href="#自定义变量" class="headerlink" title="自定义变量"></a>自定义变量</h3><p><strong>用户变量针对当前会话有效</strong>，即与会话变量作用域相同。<strong>用户变量可以应用在begin-end里面以及外面</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--声明(变量名使用@开头，避免与系统变量产生冲突)</span></span><br><span class="line"><span class="keyword">SET</span> @variable_name=<span class="keyword">value</span>;</span><br><span class="line"><span class="keyword">SET</span> @variable_name:=<span class="keyword">value</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @variable_name:=<span class="keyword">value</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改（与声明同）</span></span><br><span class="line"><span class="comment">--1</span></span><br><span class="line"><span class="keyword">SET</span> @variable_name=<span class="keyword">value</span>;</span><br><span class="line"><span class="keyword">SET</span> @variable_name:=<span class="keyword">value</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @variable_name:=<span class="keyword">value</span>;</span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(只能有一个字段) <span class="keyword">INTO</span> @variable_name</span><br><span class="line"><span class="keyword">FROM</span> table_name [<span class="keyword">where</span> ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">--使用</span></span><br><span class="line"><span class="keyword">SELECT</span> @variable_name;</span><br></pre></td></tr></table></figure>



<p><strong>局部变量只在begin-end块中有效</strong>。在块的开头声明。一般不使用@。<strong>局部变量应用在存储过程、函数等</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--声明(可不加@)</span></span><br><span class="line"><span class="keyword">DECLARE</span> variable_name DATATYPE [<span class="keyword">DEFAULT</span> <span class="keyword">value</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">--修改</span></span><br><span class="line"><span class="comment">--1(使用select加@)</span></span><br><span class="line"><span class="keyword">SET</span> variable_name=<span class="keyword">value</span>;</span><br><span class="line"><span class="keyword">SET</span> variable_name:=<span class="keyword">value</span>;</span><br><span class="line"><span class="keyword">SELECT</span> @variable_name:=<span class="keyword">value</span>;</span><br><span class="line"><span class="comment">--2</span></span><br><span class="line"><span class="keyword">SELECT</span> column_name(只能有一个字段) <span class="keyword">INTO</span> variable_name</span><br><span class="line"><span class="keyword">FROM</span> table_name [<span class="keyword">where</span> ...]</span><br><span class="line"></span><br><span class="line"><span class="comment">--使用</span></span><br><span class="line"><span class="keyword">SELECT</span> variable_name;</span><br></pre></td></tr></table></figure>



<p>eg：</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">--user variable</span><br><span class="line"><span class="builtin-name">SET</span> @<span class="attribute">m</span>=1;</span><br><span class="line"><span class="builtin-name">SET</span> @<span class="attribute">n</span>=2;</span><br><span class="line"><span class="builtin-name">SET</span> @<span class="attribute">sum</span>=@m+@n;</span><br><span class="line">SELECT @sum;</span><br><span class="line"></span><br><span class="line">--局部变量</span><br><span class="line">。。</span><br></pre></td></tr></table></figure>



<h2 id="存储过程"><a href="#存储过程" class="headerlink" title="存储过程"></a>存储过程</h2><p>​        存储过程是一段可执行性sql代码的集合。相比函数，更偏向于业务逻辑。实际上存储过程即类似于Java中的方法。</p>
<p>关于<code>DELIMITER</code>：<strong>该关键字用于指定命令结束符号，即告诉MySQL当遇见结束符时表示命令结束，可以执行</strong>。默认情况下是<code>;</code>。<strong>在某些情况下</strong>，不止要执行一条SQL语句，但又需要<code>;</code>作为各语句的结束，这时可使用该关键字指定其他的结束符。下面的存储过程创建即使用了这一点。</p>
<p><strong>创建存储过程前需要先使用<code>DELIMITER</code>关键字指定除<code>;</code>外的结束符</strong>。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--语法</span></span><br><span class="line"><span class="comment">--若过程体只有一句SQL语句，begin-end可以省略</span></span><br><span class="line"><span class="comment">--过程体的每条SQL语句必须以分号结尾</span></span><br><span class="line">DELIMITER $(可使用其他符号)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> 过程名 (参数列表)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">    过程体</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="comment">--参数列表的每个参数定义包含3个部分</span></span><br><span class="line"><span class="keyword">IN</span>|<span class="keyword">OUT</span>|INOUT 参数名 数据类型</span><br><span class="line"><span class="comment">--其中</span></span><br><span class="line"><span class="keyword">IN</span>      输入：在调用过程中，将数据输入到过程体内部的参数</span><br><span class="line"><span class="keyword">OUT</span>     输出：在调用过程中，将过程体处理完的结果返回到客户端</span><br><span class="line">INOUT   输入输出：既可输入，也可输出</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--调用</span></span><br><span class="line"><span class="keyword">CALL</span> 存储过程名(实参列表)</span><br><span class="line"></span><br><span class="line"><span class="comment">--删除存储过程</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">PROCEDURE</span> procedure_name;</span><br><span class="line"></span><br><span class="line"><span class="comment">--查看存储过程的结构</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> procedure_name;</span><br></pre></td></tr></table></figure>



<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> insert_to_major()</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">INSERT</span> <span class="keyword">INTO</span> major <span class="keyword">VALUES</span>(<span class="number">4</span>,<span class="string">&#x27;a&#x27;</span>),(<span class="number">5</span>,<span class="string">&#x27;b&#x27;</span>),(<span class="number">6</span>,<span class="string">&#x27;c&#x27;</span>),(<span class="number">7</span>,<span class="string">&#x27;d&#x27;</span>);</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> insert_to_major();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--判断登录是否成功</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> login(<span class="keyword">IN</span> username <span class="built_in">VARCHAR</span>(<span class="number">10</span>),<span class="keyword">IN</span> <span class="keyword">password</span> <span class="built_in">VARCHAR</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">DECLARE</span> <span class="keyword">result</span> <span class="built_in">INT</span> <span class="keyword">DEFAULT</span> <span class="number">0</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(*) <span class="keyword">INTO</span> <span class="keyword">result</span></span><br><span class="line">	<span class="keyword">FROM</span> <span class="keyword">admin</span> <span class="keyword">WHERE</span> admin.<span class="string">`username`</span>=username <span class="keyword">AND</span> admin.<span class="string">`password`</span>=<span class="keyword">password</span>;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">SELECT</span> <span class="keyword">IF</span>(<span class="keyword">result</span>&gt;<span class="number">0</span>,<span class="string">&#x27;登录成功&#x27;</span>,<span class="string">&#x27;登录失败&#x27;</span>) <span class="string">&#x27;登录情况&#x27;</span>;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> login(<span class="string">&#x27;吴彦祖&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--根据女神名获取男朋友名字（使用了in out）</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> get_boyfriend(<span class="keyword">IN</span> girl_name <span class="built_in">VARCHAR</span>(<span class="number">10</span>),<span class="keyword">OUT</span> boyfriend <span class="built_in">VARCHAR</span>(<span class="number">10</span>))</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SELECT</span> bo.boyName <span class="keyword">INTO</span> boyfriend</span><br><span class="line">	<span class="keyword">FROM</span> boys bo </span><br><span class="line">	<span class="keyword">INNER</span> <span class="keyword">JOIN</span> beauty b <span class="keyword">ON</span> b.boyfriend_id=bo.id</span><br><span class="line">	<span class="keyword">WHERE</span> b.name=girl_name;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SET</span> @bname = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="keyword">CALL</span> get_boyfriend(<span class="string">&#x27;王语嫣&#x27;</span>,@bname);</span><br><span class="line"><span class="keyword">SELECT</span> @bname;</span><br></pre></td></tr></table></figure>







<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><h3 id="自定义函数"><a href="#自定义函数" class="headerlink" title="自定义函数"></a>自定义函数</h3><p>MySQL的函数有系统自带（内置函数）的，<strong>也可以自定义函数</strong>。函数于存储体类似，都是一组SQL语句的集合。</p>
<p><strong>其与存储体的区别如下</strong>：</p>
<ul>
<li>存储体可以有0或多个返回值。适合批量操作。</li>
<li>函数有且仅有一个返回值。适合用于对数据处理后返回一个数据。</li>
</ul>
<p>(部分摘抄自<a target="_blank" rel="noopener" href="https://shockerli.net/post/1000-line-mysql-note/">https://shockerli.net/post/1000-line-mysql-note/</a>)</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 创建函数</span></span><br><span class="line">DELIMITER $(可使用其他符号)</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> function_name (参数列表) <span class="keyword">RETURNS</span> 返回值类型</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	函数体</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line">- 函数名，应该合法的标识符，并且不应该与已有的关键字冲突。</span><br><span class="line">- 一个函数应该属于某个数据库，可以使用db_name.funciton_name的形式执行当前函数所属数据库，否则为当前数据库。</span><br><span class="line">- 参数部分，由<span class="string">&quot;参数名&quot;</span>和<span class="string">&quot;参数类型&quot;</span>组成。多个参数用逗号隔开。</span><br><span class="line">- 函数体由多条可用的mysql语句，流程控制，变量声明等语句构成。</span><br><span class="line">- 若函数体只有一条语句，可以省略<span class="keyword">begin</span>-<span class="keyword">end</span></span><br><span class="line">- 必须有 <span class="keyword">return</span> 返回值语句。</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 调用</span></span><br><span class="line"><span class="keyword">SELECT</span> function_name(实参列表);</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 删除</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">FUNCTION</span> [<span class="keyword">IF</span> <span class="keyword">EXISTS</span>] function_name;</span><br><span class="line">    </span><br><span class="line"><span class="comment">-- 查看</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">FUNCTION</span> <span class="keyword">STATUS</span> <span class="keyword">LIKE</span> <span class="string">&#x27;partten&#x27;</span></span><br><span class="line"><span class="keyword">SHOW</span> <span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> function_name;</span><br><span class="line">    </span><br><span class="line"><span class="comment">-- 修改</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">FUNCTION</span> function_name 函数选项</span><br></pre></td></tr></table></figure>



<p>eg:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#根据员工名获取工资</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">FUNCTION</span> getsal(empName <span class="built_in">VARCHAR</span>(<span class="number">10</span>)) <span class="keyword">RETURNS</span> <span class="keyword">DOUBLE</span></span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">SET</span> @sal = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">SELECT</span> salary <span class="keyword">INTO</span> @sal</span><br><span class="line">	<span class="keyword">FROM</span> employees</span><br><span class="line">	<span class="keyword">WHERE</span> last_name=empName;</span><br><span class="line">	</span><br><span class="line">	RETURN @sal;</span><br><span class="line"><span class="keyword">END</span> $</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> getsal(<span class="string">&#x27;Hunold&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h3 id="内置函数"><a href="#内置函数" class="headerlink" title="内置函数"></a>内置函数</h3><p>​        MySQL内置函数有单行函数和分组函数：</p>
<ul>
<li><strong>单行函数</strong>：作用范围只有一行，即一个记录。</li>
<li><strong>分组函数</strong>：<strong>作用的范围是多个记录（即一列）</strong>，对多个记录进行统计，再返回一个结果。又称统计函数。</li>
</ul>
<h4 id="单行函数-字符函数"><a href="#单行函数-字符函数" class="headerlink" title="单行函数-字符函数"></a>单行函数-字符函数</h4><p><strong><span style="font-size:25px;"><code>LENGTH(str)</code></span></strong> </p>
<p>返回str的长度（字节数），其中，若使用的是<strong>utf8字符集</strong>，<strong>则一个英文占1个字节，一个中文占3个字节</strong>。</p>
<p>eg：</p>
<p><code>SELECT LENGTH(&#39;不摇碧莲&#39;);</code> 返回12.<br><code>SELECT LENGTH(&#39;jonh&#39;);</code>  返回4.</p>
<p><code>----------------------------------------------------------------------------------</code> </p>
<p><strong><span style="font-size:25px;"><code>UPPER(str)</code>、<code>LOWER(str)</code></span></strong> </p>
<p>转化为大写、小写。eg：</p>
<p><code>SELECT UPPER(&#39;john&#39;); </code><br><code>SELECT LOWER(&#39;MIKE&#39;);</code> </p>
<p><code>----------------------------------------------------------------------------------</code> </p>
<p><strong><span style="font-size:25px;"><code>CONCAT(str1,str2,...)</code></span></strong> </p>
<p>拼接字符。</p>
<p><code>SELECT CONCAT(last_name,&#39;_&#39;,first_name) &#39;name&#39; FROM employees;</code><br><code>SELECT CONCAT(LOWER(last_name),&#39;_&#39;,UPPER(first_name)) &#39;name&#39; FROM employees;</code> （函数嵌套）</p>
<p><code>----------------------------------------------------------------------------------</code> </p>
<p><strong><span style="font-size:25px;"><code>SUBSTR substring</code></span></strong> </p>
<p><strong>该函数有4个重载的形式。<span style="color:red">sql中的索引从1开始</span></strong>。</p>
<p><code>substr(str,start)</code>：</p>
<p><code>substr(str FROM pos)</code>     返回从pos开始的子字符串</p>
<p><code>substr(str, pos, length)</code>     返回从索引pos开始，长度为length的子字符串</p>
<p><code>substr(str FROM pos FOR length)</code> </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">&#x27;一二三四五六&#x27;</span>,<span class="number">4</span>) <span class="keyword">output</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">&#x27;一二三四五六&#x27;</span> <span class="keyword">FROM</span> <span class="number">3</span>) <span class="keyword">output</span>;  <span class="comment">#三四五六</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">&#x27;一二三四五六&#x27;</span>,<span class="number">1</span>,<span class="number">4</span>) <span class="keyword">output</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUBSTR</span>(<span class="string">&#x27;一二三四五六&#x27;</span> <span class="keyword">FROM</span> <span class="number">1</span> <span class="keyword">FOR</span> <span class="number">3</span>) <span class="keyword">output</span>;</span><br></pre></td></tr></table></figure>

<p><code>----------------------------------------------------------------------------------</code> </p>
<p><strong><span style="font-size:25px;"><code>INSTR(str,substr)</code></span></strong> </p>
<p><strong>返回子串第一次出现的位置，若不包含该子串，返回0</strong>。</p>
<p><code>SELECT INSTR(&#39;一二三四五六&#39;, &#39;四五六&#39;) output; #4</code><br><code>SELECT INSTR(&#39;一二三四五六&#39;, &#39;四六&#39;) output; #0</code> </p>
<p><code>----------------------------------------------------------------------------------</code> </p>
<p><strong><span style="font-size:25px;"><code>TRIM([deleteStr] FROM str)</code></span></strong> </p>
<p><strong>去掉前后的空格或指定字符（中间的字符不受影响）</strong>。eg：</p>
<p><code>SELECT TRIM(&#39;     啊哈哈哈   &#39;) output;</code><br><code>SELECT TRIM(&#39;a&#39; FROM &#39;aaaaa啊哈哈aaa&#39;) output;</code> </p>
<p><code>----------------------------------------------------------------------------------</code> </p>
<p><strong><span style="font-size:25px;"><code>LPAD(str,length,padstr) </code></span></strong> </p>
<p><strong>用padstr对str进行左填充达到length长度</strong>。<code>rpad()</code>同理。</p>
<p>eg：</p>
<p><code>SELECT LPAD(&#39;张三&#39;,10,&#39;a&#39;) output;</code>  # aaaaaaaa张三</p>
<p><code>SELECT RPAD(&#39;张三&#39;,10,&#39;a&#39;) output;</code>  # 张三aaaaaaaa</p>
<p>**其中，若是length参数小于str的长度，相当于substr(str,1,length)**，对lpad、rpad都一样。eg：</p>
<p><code>SELECT LPAD(&#39;张三四&#39;,2,&#39;a&#39;) output;</code>  # 张三</p>
<p><code>SELECT RPAD(&#39;张三四&#39;,2,&#39;a&#39;) output;</code>  # 张三</p>
<p><code>----------------------------------------------------------------------------------</code> </p>
<p><strong><span style="font-size:25px;"><code>REPLACE(str,fromStr,toStr) </code></span></strong> </p>
<p>替换。eg：</p>
<p><code>SELECT REPLACE(&#39;小明爱上了小红&#39;,&#39;小红&#39;,&#39;小绿&#39;) output;</code>  #小红爱上了小绿</p>
<h4 id="单行函数-数字函数"><a href="#单行函数-数字函数" class="headerlink" title="单行函数-数字函数"></a>单行函数-数字函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#四舍五入</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">1.56</span>) <span class="keyword">output</span>; <span class="comment"># 2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">-1.54</span>) <span class="keyword">output</span>; <span class="comment">#-2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">1.567</span>, <span class="number">2</span>) <span class="keyword">output</span>; <span class="comment"># 1.57</span></span><br><span class="line"><span class="comment">#向上取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">1.2</span>) <span class="keyword">output</span>; <span class="comment">#2</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CEIL</span>(<span class="number">-1.1</span>) <span class="keyword">output</span>; <span class="comment"># -1</span></span><br><span class="line"><span class="comment">#向下取整</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">1.2</span>) <span class="keyword">output</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">FLOOR</span>(<span class="number">-1.2</span>) <span class="keyword">output</span>; <span class="comment"># -2</span></span><br><span class="line"><span class="comment">#截断</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">TRUNCATE</span>(<span class="number">1.1999</span>,<span class="number">1</span>) <span class="keyword">output</span>; <span class="comment"># 1.1，没有四舍五入</span></span><br><span class="line"><span class="comment">#模运算</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MOD</span>(<span class="number">10</span>,<span class="number">3</span>) <span class="keyword">output</span>; <span class="comment">#10%3</span></span><br><span class="line"><span class="comment">#生成0-1的任意数以及0-100的任意数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">RAND</span>(),<span class="keyword">RAND</span>()*<span class="number">100</span>;</span><br></pre></td></tr></table></figure>



<h4 id="单行函数-日期函数"><a href="#单行函数-日期函数" class="headerlink" title="单行函数-日期函数"></a>单行函数-日期函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#返回当前系统日期+时间</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NOW</span>() <span class="string">&#x27;time&#x27;</span>;</span><br><span class="line"><span class="comment">#返回当前系统日期</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURDATE</span>() <span class="string">&#x27;time&#x27;</span>;</span><br><span class="line"><span class="comment">#返回当前系统时间</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">CURTIME</span>() <span class="string">&#x27;time&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">#截取日期中的年、月、日day、小时hour、分min?、秒second</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(<span class="keyword">NOW</span>()) <span class="string">&#x27;year&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(<span class="string">&quot;1998-12-12&quot;</span>) <span class="string">&#x27;year&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">YEAR</span>(hiredate) <span class="string">&#x27;year&#x27;</span> <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MINUTE</span>(<span class="keyword">NOW</span>()) <span class="string">&#x27;minute&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MONTH</span>(<span class="keyword">NOW</span>()) <span class="string">&#x27;month&#x27;</span>;</span><br><span class="line"><span class="keyword">SELECT</span> MONTHNAME(<span class="keyword">NOW</span>()) <span class="string">&#x27;monthname&#x27;</span>; <span class="comment"># 获取月的英文名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#将字符串根据指定格式转化为日期，具体格式见下表</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">STR_TO_DATE</span>(<span class="string">&#x27;1999-10-22&#x27;</span>,<span class="string">&#x27;%Y-%m-%d&#x27;</span>) <span class="keyword">output</span>;</span><br><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> employees <span class="keyword">WHERE</span> hiredate=<span class="keyword">STR_TO_DATE</span>(<span class="string">&#x27;4-3 1992&#x27;</span>,<span class="string">&#x27;%c-%d %Y&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">#将日期根据指定格式转化为字符，</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATE_FORMAT</span>(<span class="keyword">NOW</span>(),<span class="string">&#x27;%Y年%m月%d日&#x27;</span>) <span class="keyword">output</span>;</span><br><span class="line"><span class="comment">#查询有奖金的员工名跟入职日期(xx月/xx日 xx年的格式)</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name, <span class="keyword">DATE_FORMAT</span>(hiredate,<span class="string">&#x27;%m月/%d日 %Y年&#x27;</span>) <span class="keyword">FROM</span> employees</span><br><span class="line"><span class="keyword">WHERE</span> commission_pct <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="literal">NULL</span>; </span><br><span class="line"><span class="comment">#计算两个日期之间相差的天数</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATEDIFF</span>(<span class="keyword">MAX</span>(hiredate),<span class="keyword">MIN</span>(hiredate)) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>



<img src="https://gitee.com/bxgitee/noteImage/raw/master/image/image-20200526104150723.png" alt="image-20200526104150723" style="zoom: 50%;" />



<h4 id="单行函数-其他函数"><a href="#单行函数-其他函数" class="headerlink" title="单行函数-其他函数"></a>单行函数-其他函数</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">VERSION</span>();<span class="comment">#当前版本</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DATABASE</span>();<span class="comment">#当前数据库名</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">USER</span>(); <span class="comment">#当前用户名</span></span><br><span class="line"><span class="comment">#返回字符串的加密形式、md5加密形式</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">PASSWORD</span>(<span class="string">&#x27;objk&#x27;</span>),<span class="keyword">MD5</span>(<span class="string">&#x27;ojbk&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">--若exp1为null，返回exp2值，否则返回exp1的值。</span></span><br><span class="line">IFNULL(exp1, exp2)</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 若expr为真，返回1，否则0</span></span><br><span class="line">isnull(expr)</span><br></pre></td></tr></table></figure>



<h4 id="单行函数-流程控制函数"><a href="#单行函数-流程控制函数" class="headerlink" title="单行函数-流程控制函数"></a>单行函数-流程控制函数</h4><p><strong><span style="font-size:25px;"><code>if(condition,expr1,expr2)</code></span></strong> </p>
<p><strong>若条件为真，返回expr1，否则返回expr2</strong>。</p>
<p>eg：</p>
<p><code>SELECT last_name,IF(commission_pct IS NOT NULL,&#39;有奖金&#39;,&#39;没奖金&#39;) 备注 FROM employees;</code> </p>
<h4 id="分组函数"><a href="#分组函数" class="headerlink" title="分组函数"></a>分组函数</h4><p>常见的分组函数有：</p>
<p><strong><code>sum(expr)</code> 求和 </strong></p>
<p><strong><code>avg(expr)</code> 求平均值 </strong></p>
<p><strong><code>max(expr)</code> 求最大值 </strong></p>
<p><strong><code>min(expr)</code> 求最小值 </strong></p>
<p><strong><code>count(expr)</code> 求数量</strong> </p>
<p>其中：</p>
<ul>
<li><strong>分组函数的参数一般为字段名</strong>。</li>
<li>sum、avg一般<strong>只接受数值型参数</strong>，max、min、count<strong>可接受任何类型的参数</strong>。</li>
<li><strong>5个函数对null值忽略</strong>，即对null值不统计、不计算。</li>
<li>可与<code>distinct</code>配合使用，<strong>会对结果先去重，再进行函数计算</strong>。</li>
<li><strong>与分组函数一同查询的字段应有限制（分组函数查询结果只有一个值，而查询字段可能会有多个值），一般要求是<code>group by</code>后的字段</strong>。</li>
</ul>
<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(salary) <span class="string">&#x27;sum&#x27;</span>,<span class="keyword">AVG</span>(salary) <span class="string">&#x27;average&#x27;</span>,<span class="keyword">MIN</span>(salary) <span class="string">&#x27;min&#x27;</span>,<span class="keyword">MAX</span>(salary) <span class="string">&#x27;max&#x27;</span>,<span class="keyword">COUNT</span>(salary) <span class="string">&#x27;count&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(last_name),<span class="keyword">MIN</span>(last_name) <span class="keyword">FROM</span> employees;</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(hiredate),<span class="keyword">MIN</span>(hiredate) <span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">SUM</span>(<span class="keyword">DISTINCT</span> salary) 去重,<span class="keyword">SUM</span>(salary) 不去重 <span class="keyword">FROM</span> employees;<span class="comment">##</span></span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> commission_pct),<span class="keyword">COUNT</span>(commission_pct) <span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>



<p><strong><code>COUNT()</code>函数</strong> </p>
<p>​        在5个函数中，<code>count()</code>函数有些许不同。</p>
<p>​        <strong>可使用<code>count(*)</code>跟<code>count(1)</code>来统计一个表有多少个记录。使用后者相当于在每个记录中添加一个名为1的字段（即新添加一个列），并统计共有多少行</strong>。</p>
<p>tips：myisam引擎下，<code>count(*)</code>效率更高；innodb引擎下，两者效率相差不多。</p>
<h2 id="流程控制"><a href="#流程控制" class="headerlink" title="流程控制"></a>流程控制</h2><h3 id="分支结构"><a href="#分支结构" class="headerlink" title="分支结构"></a>分支结构</h3><h4 id="if函数"><a href="#if函数" class="headerlink" title="if函数"></a>if函数</h4><p>见<code>函数\内置函数</code>第5点。</p>
<h4 id="case-when"><a href="#case-when" class="headerlink" title="case..when"></a><code>case..when</code></h4><p><strong>该语法有两种使用形式，可嵌套在select中（此时整个case-when执行后返回一个值），也可单独使用</strong>。</p>
<p>**第一钟类似Java的<code>swich..case</code>**。具体语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">case 要判断的字段、表达式</span><br><span class="line"></span><br><span class="line">when 常量1 then 要显示的值1或语句1;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">when 常量n then 要显示的值n或语句n;</span><br><span class="line"></span><br><span class="line">else 默认显示</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<p>eg，根据部门id的不同，显示不同的最终工资：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> last_name,salary 原工资,department_id,</span><br><span class="line"><span class="keyword">CASE</span> department_id</span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">30</span> <span class="keyword">THEN</span> salary*<span class="number">1.1</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">40</span> <span class="keyword">THEN</span> salary*<span class="number">1.2</span></span><br><span class="line"><span class="keyword">WHEN</span> <span class="number">50</span> <span class="keyword">THEN</span> salary*<span class="number">1.3</span></span><br><span class="line"><span class="keyword">ELSE</span> salary</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> 最终工资</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br></pre></td></tr></table></figure>



<p><strong>第二种用法类似多层if，</strong>语法如下：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">case </span><br><span class="line"></span><br><span class="line">when condition1 then 要显示的值1或语句1;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">when condition_n then 要显示的值n或语句n;</span><br><span class="line"></span><br><span class="line">else 默认显示</span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>eg：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">--嵌套在select中使用</span></span><br><span class="line"><span class="comment">--根据工资的大小区间分多个工资级别：</span></span><br><span class="line"><span class="keyword">SELECT</span> last_name,salary,</span><br><span class="line"><span class="keyword">CASE</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">20000</span> <span class="keyword">THEN</span> <span class="string">&#x27;A&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">15000</span> <span class="keyword">THEN</span> <span class="string">&#x27;B&#x27;</span></span><br><span class="line"><span class="keyword">WHEN</span> salary&gt;<span class="number">10000</span> <span class="keyword">THEN</span> <span class="string">&#x27;C&#x27;</span></span><br><span class="line"><span class="keyword">ELSE</span> <span class="string">&#x27;D&#x27;</span></span><br><span class="line"><span class="keyword">END</span> <span class="keyword">AS</span> 工资级别</span><br><span class="line"><span class="keyword">FROM</span> employees;</span><br><span class="line"></span><br><span class="line"><span class="comment">--在存储过程中使用</span></span><br><span class="line"><span class="comment">--根据工资显示工资级别</span></span><br><span class="line">DELIMITER $</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">PROCEDURE</span> testcase(<span class="keyword">IN</span> score <span class="built_in">INT</span>)</span><br><span class="line"><span class="keyword">BEGIN</span></span><br><span class="line">	<span class="keyword">CASE</span></span><br><span class="line">	<span class="keyword">WHEN</span> score&gt;=<span class="number">90</span> <span class="keyword">AND</span> score&lt;=<span class="number">100</span> <span class="keyword">THEN</span> <span class="keyword">SELECT</span> <span class="string">&#x27;A&#x27;</span>;</span><br><span class="line">	WHEN score&gt;=80 THEN SELECT &#x27;B&#x27;;</span><br><span class="line">	WHEN score&gt;=60 THEN SELECT &#x27;C&#x27;;</span><br><span class="line">	ELSE <span class="keyword">SELECT</span> <span class="string">&#x27;D&#x27;</span>;</span><br><span class="line">	<span class="keyword">END</span> <span class="keyword">CASE</span>;</span><br><span class="line"><span class="keyword">END</span> $ </span><br><span class="line"></span><br><span class="line"><span class="keyword">CALL</span> testcase(<span class="number">95</span>);</span><br></pre></td></tr></table></figure>



<p>两种case-when的特点：</p>
<ul>
<li><strong>可以作为表达式， 嵌套在其他语句中使用（此时整个CASE-WHEN执行完毕后返回一个值，如第一种用法的例子）</strong>；可以作为独立的语句，但必须放在begin-end中。</li>
<li><strong>如果WHEN中的值满足或条件成立， 则执行对应的THEN后面的语句，并且结束CASE</strong>。如果都不满足， 则执行ELSE中的语句或值。</li>
<li>ELSE可以省略， 如果ELSE省略了， <strong>并且所有WHEN条件都不满足， 则返回NULL</strong>。</li>
</ul>
<h4 id="if结构"><a href="#if结构" class="headerlink" title="if结构"></a>if结构</h4><p><strong>if结构只能使用在begin-end中</strong>。</p>
<p>语法</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">IF search_condition THEN statement_list   </span><br><span class="line">ELSEIF search_condition THEN statement_list</span><br><span class="line">...</span><br><span class="line">[ELSE statement_list;]</span><br><span class="line"><span class="keyword">END</span> <span class="keyword">IF</span>;</span><br></pre></td></tr></table></figure>



<h3 id="循环结构"><a href="#循环结构" class="headerlink" title="循环结构"></a>循环结构</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- while循环</span></span><br><span class="line">[label_name:] while 循环条件 <span class="keyword">do</span></span><br><span class="line">    循环体;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span> [label_name];</span><br><span class="line">- 如果需要在循环内提前终止 while循环，则需要使用标签；标签需要成对出现。</span><br><span class="line">	<span class="comment">-- 退出循环</span></span><br><span class="line">		退出整个循环 leave label_name;</span><br><span class="line">		退出当前循环 iterate label_name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">--loop循环</span></span><br><span class="line">[label_name:] loop</span><br><span class="line">    循环体;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">loop</span> [label_name];</span><br><span class="line">	<span class="comment">--需搭配leave和iterate，否则会死循环</span></span><br><span class="line"></span><br><span class="line"><span class="comment">--repeat</span></span><br><span class="line">[label_name:] repeat</span><br><span class="line">    循环体;</span><br><span class="line">until 结束循环的条件</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">repeat</span> [label_name];</span><br></pre></td></tr></table></figure>


















      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">bxxiao</p>
  <div class="site-description" itemprop="description">nothing</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">37</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">10</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/bxxiao" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;bxxiao" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">bxxiao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  















  

  

</body>
</html>
